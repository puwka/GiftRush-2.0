(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))r(n);new MutationObserver(n=>{for(const o of n)if(o.type==="childList")for(const c of o.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&r(c)}).observe(document,{childList:!0,subtree:!0});function t(n){const o={};return n.integrity&&(o.integrity=n.integrity),n.referrerPolicy&&(o.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?o.credentials="include":n.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function r(n){if(n.ep)return;n.ep=!0;const o=t(n);fetch(n.href,o)}})();function _n(s){return s&&s.__esModule&&Object.prototype.hasOwnProperty.call(s,"default")?s.default:s}function Ws(s){if(Object.prototype.hasOwnProperty.call(s,"__esModule"))return s;var e=s.default;if(typeof e=="function"){var t=function r(){var n=!1;try{n=this instanceof r}catch{}return n?Reflect.construct(e,arguments,this.constructor):e.apply(this,arguments)};t.prototype=e.prototype}else t={};return Object.defineProperty(t,"__esModule",{value:!0}),Object.keys(s).forEach(function(r){var n=Object.getOwnPropertyDescriptor(s,r);Object.defineProperty(t,r,n.get?n:{enumerable:!0,get:function(){return s[r]}})}),t}var rr={exports:{}},wn=rr.exports,us;function bn(){return us||(us=1,function(s){(function(e,t){s.exports?s.exports=t():(e.nacl||(e.nacl={}),e.nacl.util=t())})(wn,function(){var e={};function t(r){if(!/^(?:[A-Za-z0-9+\/]{2}[A-Za-z0-9+\/]{2})*(?:[A-Za-z0-9+\/]{2}==|[A-Za-z0-9+\/]{3}=)?$/.test(r))throw new TypeError("invalid encoding")}return e.decodeUTF8=function(r){if(typeof r!="string")throw new TypeError("expected string");var n,o=unescape(encodeURIComponent(r)),c=new Uint8Array(o.length);for(n=0;n<o.length;n++)c[n]=o.charCodeAt(n);return c},e.encodeUTF8=function(r){var n,o=[];for(n=0;n<r.length;n++)o.push(String.fromCharCode(r[n]));return decodeURIComponent(escape(o.join("")))},typeof atob>"u"?typeof Buffer.from<"u"?(e.encodeBase64=function(r){return Buffer.from(r).toString("base64")},e.decodeBase64=function(r){return t(r),new Uint8Array(Array.prototype.slice.call(Buffer.from(r,"base64"),0))}):(e.encodeBase64=function(r){return new Buffer(r).toString("base64")},e.decodeBase64=function(r){return t(r),new Uint8Array(Array.prototype.slice.call(new Buffer(r,"base64"),0))}):(e.encodeBase64=function(r){var n,o=[],c=r.length;for(n=0;n<c;n++)o.push(String.fromCharCode(r[n]));return btoa(o.join(""))},e.decodeBase64=function(r){t(r);var n,o=atob(r),c=new Uint8Array(o.length);for(n=0;n<o.length;n++)c[n]=o.charCodeAt(n);return c}),e})}(rr)),rr.exports}bn();function xn(s){throw new Error('Could not dynamically require "'+s+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var Er={exports:{}};const En={},Sn=Object.freeze(Object.defineProperty({__proto__:null,default:En},Symbol.toStringTag,{value:"Module"})),kn=Ws(Sn);var ds;function Tn(){return ds||(ds=1,function(s){(function(e){var t=function(a){var f,l=new Float64Array(16);if(a)for(f=0;f<a.length;f++)l[f]=a[f];return l},r=function(){throw new Error("no PRNG")},n=new Uint8Array(16),o=new Uint8Array(32);o[0]=9;var c=t(),d=t([1]),h=t([56129,1]),g=t([30883,4953,19914,30187,55467,16705,2637,112,59544,30585,16505,36039,65139,11119,27886,20995]),v=t([61785,9906,39828,60374,45398,33411,5274,224,53552,61171,33010,6542,64743,22239,55772,9222]),b=t([54554,36645,11616,51542,42930,38181,51040,26924,56412,64982,57905,49316,21502,52590,14035,8553]),T=t([26200,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214]),O=t([41136,18958,6951,50414,58488,44335,6150,12099,55207,15867,153,11085,57099,20417,9344,11139]);function I(a,f,l,i){a[f]=l>>24&255,a[f+1]=l>>16&255,a[f+2]=l>>8&255,a[f+3]=l&255,a[f+4]=i>>24&255,a[f+5]=i>>16&255,a[f+6]=i>>8&255,a[f+7]=i&255}function W(a,f,l,i,u){var y,m=0;for(y=0;y<u;y++)m|=a[f+y]^l[i+y];return(1&m-1>>>8)-1}function D(a,f,l,i){return W(a,f,l,i,16)}function ue(a,f,l,i){return W(a,f,l,i,32)}function _e(a,f,l,i){for(var u=i[0]&255|(i[1]&255)<<8|(i[2]&255)<<16|(i[3]&255)<<24,y=l[0]&255|(l[1]&255)<<8|(l[2]&255)<<16|(l[3]&255)<<24,m=l[4]&255|(l[5]&255)<<8|(l[6]&255)<<16|(l[7]&255)<<24,E=l[8]&255|(l[9]&255)<<8|(l[10]&255)<<16|(l[11]&255)<<24,P=l[12]&255|(l[13]&255)<<8|(l[14]&255)<<16|(l[15]&255)<<24,M=i[4]&255|(i[5]&255)<<8|(i[6]&255)<<16|(i[7]&255)<<24,R=f[0]&255|(f[1]&255)<<8|(f[2]&255)<<16|(f[3]&255)<<24,ce=f[4]&255|(f[5]&255)<<8|(f[6]&255)<<16|(f[7]&255)<<24,U=f[8]&255|(f[9]&255)<<8|(f[10]&255)<<16|(f[11]&255)<<24,z=f[12]&255|(f[13]&255)<<8|(f[14]&255)<<16|(f[15]&255)<<24,K=i[8]&255|(i[9]&255)<<8|(i[10]&255)<<16|(i[11]&255)<<24,V=l[16]&255|(l[17]&255)<<8|(l[18]&255)<<16|(l[19]&255)<<24,Y=l[20]&255|(l[21]&255)<<8|(l[22]&255)<<16|(l[23]&255)<<24,H=l[24]&255|(l[25]&255)<<8|(l[26]&255)<<16|(l[27]&255)<<24,G=l[28]&255|(l[29]&255)<<8|(l[30]&255)<<16|(l[31]&255)<<24,J=i[12]&255|(i[13]&255)<<8|(i[14]&255)<<16|(i[15]&255)<<24,L=u,q=y,$=m,C=E,B=P,j=M,_=R,w=ce,k=U,x=z,S=K,A=V,F=Y,Q=H,ee=G,X=J,p,re=0;re<20;re+=2)p=L+F|0,B^=p<<7|p>>>25,p=B+L|0,k^=p<<9|p>>>23,p=k+B|0,F^=p<<13|p>>>19,p=F+k|0,L^=p<<18|p>>>14,p=j+q|0,x^=p<<7|p>>>25,p=x+j|0,Q^=p<<9|p>>>23,p=Q+x|0,q^=p<<13|p>>>19,p=q+Q|0,j^=p<<18|p>>>14,p=S+_|0,ee^=p<<7|p>>>25,p=ee+S|0,$^=p<<9|p>>>23,p=$+ee|0,_^=p<<13|p>>>19,p=_+$|0,S^=p<<18|p>>>14,p=X+A|0,C^=p<<7|p>>>25,p=C+X|0,w^=p<<9|p>>>23,p=w+C|0,A^=p<<13|p>>>19,p=A+w|0,X^=p<<18|p>>>14,p=L+C|0,q^=p<<7|p>>>25,p=q+L|0,$^=p<<9|p>>>23,p=$+q|0,C^=p<<13|p>>>19,p=C+$|0,L^=p<<18|p>>>14,p=j+B|0,_^=p<<7|p>>>25,p=_+j|0,w^=p<<9|p>>>23,p=w+_|0,B^=p<<13|p>>>19,p=B+w|0,j^=p<<18|p>>>14,p=S+x|0,A^=p<<7|p>>>25,p=A+S|0,k^=p<<9|p>>>23,p=k+A|0,x^=p<<13|p>>>19,p=x+k|0,S^=p<<18|p>>>14,p=X+ee|0,F^=p<<7|p>>>25,p=F+X|0,Q^=p<<9|p>>>23,p=Q+F|0,ee^=p<<13|p>>>19,p=ee+Q|0,X^=p<<18|p>>>14;L=L+u|0,q=q+y|0,$=$+m|0,C=C+E|0,B=B+P|0,j=j+M|0,_=_+R|0,w=w+ce|0,k=k+U|0,x=x+z|0,S=S+K|0,A=A+V|0,F=F+Y|0,Q=Q+H|0,ee=ee+G|0,X=X+J|0,a[0]=L>>>0&255,a[1]=L>>>8&255,a[2]=L>>>16&255,a[3]=L>>>24&255,a[4]=q>>>0&255,a[5]=q>>>8&255,a[6]=q>>>16&255,a[7]=q>>>24&255,a[8]=$>>>0&255,a[9]=$>>>8&255,a[10]=$>>>16&255,a[11]=$>>>24&255,a[12]=C>>>0&255,a[13]=C>>>8&255,a[14]=C>>>16&255,a[15]=C>>>24&255,a[16]=B>>>0&255,a[17]=B>>>8&255,a[18]=B>>>16&255,a[19]=B>>>24&255,a[20]=j>>>0&255,a[21]=j>>>8&255,a[22]=j>>>16&255,a[23]=j>>>24&255,a[24]=_>>>0&255,a[25]=_>>>8&255,a[26]=_>>>16&255,a[27]=_>>>24&255,a[28]=w>>>0&255,a[29]=w>>>8&255,a[30]=w>>>16&255,a[31]=w>>>24&255,a[32]=k>>>0&255,a[33]=k>>>8&255,a[34]=k>>>16&255,a[35]=k>>>24&255,a[36]=x>>>0&255,a[37]=x>>>8&255,a[38]=x>>>16&255,a[39]=x>>>24&255,a[40]=S>>>0&255,a[41]=S>>>8&255,a[42]=S>>>16&255,a[43]=S>>>24&255,a[44]=A>>>0&255,a[45]=A>>>8&255,a[46]=A>>>16&255,a[47]=A>>>24&255,a[48]=F>>>0&255,a[49]=F>>>8&255,a[50]=F>>>16&255,a[51]=F>>>24&255,a[52]=Q>>>0&255,a[53]=Q>>>8&255,a[54]=Q>>>16&255,a[55]=Q>>>24&255,a[56]=ee>>>0&255,a[57]=ee>>>8&255,a[58]=ee>>>16&255,a[59]=ee>>>24&255,a[60]=X>>>0&255,a[61]=X>>>8&255,a[62]=X>>>16&255,a[63]=X>>>24&255}function N(a,f,l,i){for(var u=i[0]&255|(i[1]&255)<<8|(i[2]&255)<<16|(i[3]&255)<<24,y=l[0]&255|(l[1]&255)<<8|(l[2]&255)<<16|(l[3]&255)<<24,m=l[4]&255|(l[5]&255)<<8|(l[6]&255)<<16|(l[7]&255)<<24,E=l[8]&255|(l[9]&255)<<8|(l[10]&255)<<16|(l[11]&255)<<24,P=l[12]&255|(l[13]&255)<<8|(l[14]&255)<<16|(l[15]&255)<<24,M=i[4]&255|(i[5]&255)<<8|(i[6]&255)<<16|(i[7]&255)<<24,R=f[0]&255|(f[1]&255)<<8|(f[2]&255)<<16|(f[3]&255)<<24,ce=f[4]&255|(f[5]&255)<<8|(f[6]&255)<<16|(f[7]&255)<<24,U=f[8]&255|(f[9]&255)<<8|(f[10]&255)<<16|(f[11]&255)<<24,z=f[12]&255|(f[13]&255)<<8|(f[14]&255)<<16|(f[15]&255)<<24,K=i[8]&255|(i[9]&255)<<8|(i[10]&255)<<16|(i[11]&255)<<24,V=l[16]&255|(l[17]&255)<<8|(l[18]&255)<<16|(l[19]&255)<<24,Y=l[20]&255|(l[21]&255)<<8|(l[22]&255)<<16|(l[23]&255)<<24,H=l[24]&255|(l[25]&255)<<8|(l[26]&255)<<16|(l[27]&255)<<24,G=l[28]&255|(l[29]&255)<<8|(l[30]&255)<<16|(l[31]&255)<<24,J=i[12]&255|(i[13]&255)<<8|(i[14]&255)<<16|(i[15]&255)<<24,L=u,q=y,$=m,C=E,B=P,j=M,_=R,w=ce,k=U,x=z,S=K,A=V,F=Y,Q=H,ee=G,X=J,p,re=0;re<20;re+=2)p=L+F|0,B^=p<<7|p>>>25,p=B+L|0,k^=p<<9|p>>>23,p=k+B|0,F^=p<<13|p>>>19,p=F+k|0,L^=p<<18|p>>>14,p=j+q|0,x^=p<<7|p>>>25,p=x+j|0,Q^=p<<9|p>>>23,p=Q+x|0,q^=p<<13|p>>>19,p=q+Q|0,j^=p<<18|p>>>14,p=S+_|0,ee^=p<<7|p>>>25,p=ee+S|0,$^=p<<9|p>>>23,p=$+ee|0,_^=p<<13|p>>>19,p=_+$|0,S^=p<<18|p>>>14,p=X+A|0,C^=p<<7|p>>>25,p=C+X|0,w^=p<<9|p>>>23,p=w+C|0,A^=p<<13|p>>>19,p=A+w|0,X^=p<<18|p>>>14,p=L+C|0,q^=p<<7|p>>>25,p=q+L|0,$^=p<<9|p>>>23,p=$+q|0,C^=p<<13|p>>>19,p=C+$|0,L^=p<<18|p>>>14,p=j+B|0,_^=p<<7|p>>>25,p=_+j|0,w^=p<<9|p>>>23,p=w+_|0,B^=p<<13|p>>>19,p=B+w|0,j^=p<<18|p>>>14,p=S+x|0,A^=p<<7|p>>>25,p=A+S|0,k^=p<<9|p>>>23,p=k+A|0,x^=p<<13|p>>>19,p=x+k|0,S^=p<<18|p>>>14,p=X+ee|0,F^=p<<7|p>>>25,p=F+X|0,Q^=p<<9|p>>>23,p=Q+F|0,ee^=p<<13|p>>>19,p=ee+Q|0,X^=p<<18|p>>>14;a[0]=L>>>0&255,a[1]=L>>>8&255,a[2]=L>>>16&255,a[3]=L>>>24&255,a[4]=j>>>0&255,a[5]=j>>>8&255,a[6]=j>>>16&255,a[7]=j>>>24&255,a[8]=S>>>0&255,a[9]=S>>>8&255,a[10]=S>>>16&255,a[11]=S>>>24&255,a[12]=X>>>0&255,a[13]=X>>>8&255,a[14]=X>>>16&255,a[15]=X>>>24&255,a[16]=_>>>0&255,a[17]=_>>>8&255,a[18]=_>>>16&255,a[19]=_>>>24&255,a[20]=w>>>0&255,a[21]=w>>>8&255,a[22]=w>>>16&255,a[23]=w>>>24&255,a[24]=k>>>0&255,a[25]=k>>>8&255,a[26]=k>>>16&255,a[27]=k>>>24&255,a[28]=x>>>0&255,a[29]=x>>>8&255,a[30]=x>>>16&255,a[31]=x>>>24&255}function se(a,f,l,i){_e(a,f,l,i)}function ve(a,f,l,i){N(a,f,l,i)}var de=new Uint8Array([101,120,112,97,110,100,32,51,50,45,98,121,116,101,32,107]);function Oe(a,f,l,i,u,y,m){var E=new Uint8Array(16),P=new Uint8Array(64),M,R;for(R=0;R<16;R++)E[R]=0;for(R=0;R<8;R++)E[R]=y[R];for(;u>=64;){for(se(P,E,m,de),R=0;R<64;R++)a[f+R]=l[i+R]^P[R];for(M=1,R=8;R<16;R++)M=M+(E[R]&255)|0,E[R]=M&255,M>>>=8;u-=64,f+=64,i+=64}if(u>0)for(se(P,E,m,de),R=0;R<u;R++)a[f+R]=l[i+R]^P[R];return 0}function Yr(a,f,l,i,u){var y=new Uint8Array(16),m=new Uint8Array(64),E,P;for(P=0;P<16;P++)y[P]=0;for(P=0;P<8;P++)y[P]=i[P];for(;l>=64;){for(se(m,y,u,de),P=0;P<64;P++)a[f+P]=m[P];for(E=1,P=8;P<16;P++)E=E+(y[P]&255)|0,y[P]=E&255,E>>>=8;l-=64,f+=64}if(l>0)for(se(m,y,u,de),P=0;P<l;P++)a[f+P]=m[P];return 0}function Vr(a,f,l,i,u){var y=new Uint8Array(32);ve(y,i,u,de);for(var m=new Uint8Array(8),E=0;E<8;E++)m[E]=i[E+16];return Yr(a,f,l,m,y)}function ar(a,f,l,i,u,y,m){var E=new Uint8Array(32);ve(E,y,m,de);for(var P=new Uint8Array(8),M=0;M<8;M++)P[M]=y[M+16];return Oe(a,f,l,i,u,P,E)}var Nt=function(a){this.buffer=new Uint8Array(16),this.r=new Uint16Array(10),this.h=new Uint16Array(10),this.pad=new Uint16Array(8),this.leftover=0,this.fin=0;var f,l,i,u,y,m,E,P;f=a[0]&255|(a[1]&255)<<8,this.r[0]=f&8191,l=a[2]&255|(a[3]&255)<<8,this.r[1]=(f>>>13|l<<3)&8191,i=a[4]&255|(a[5]&255)<<8,this.r[2]=(l>>>10|i<<6)&7939,u=a[6]&255|(a[7]&255)<<8,this.r[3]=(i>>>7|u<<9)&8191,y=a[8]&255|(a[9]&255)<<8,this.r[4]=(u>>>4|y<<12)&255,this.r[5]=y>>>1&8190,m=a[10]&255|(a[11]&255)<<8,this.r[6]=(y>>>14|m<<2)&8191,E=a[12]&255|(a[13]&255)<<8,this.r[7]=(m>>>11|E<<5)&8065,P=a[14]&255|(a[15]&255)<<8,this.r[8]=(E>>>8|P<<8)&8191,this.r[9]=P>>>5&127,this.pad[0]=a[16]&255|(a[17]&255)<<8,this.pad[1]=a[18]&255|(a[19]&255)<<8,this.pad[2]=a[20]&255|(a[21]&255)<<8,this.pad[3]=a[22]&255|(a[23]&255)<<8,this.pad[4]=a[24]&255|(a[25]&255)<<8,this.pad[5]=a[26]&255|(a[27]&255)<<8,this.pad[6]=a[28]&255|(a[29]&255)<<8,this.pad[7]=a[30]&255|(a[31]&255)<<8};Nt.prototype.blocks=function(a,f,l){for(var i=this.fin?0:2048,u,y,m,E,P,M,R,ce,U,z,K,V,Y,H,G,J,L,q,$,C=this.h[0],B=this.h[1],j=this.h[2],_=this.h[3],w=this.h[4],k=this.h[5],x=this.h[6],S=this.h[7],A=this.h[8],F=this.h[9],Q=this.r[0],ee=this.r[1],X=this.r[2],p=this.r[3],re=this.r[4],le=this.r[5],fe=this.r[6],te=this.r[7],oe=this.r[8],ae=this.r[9];l>=16;)u=a[f+0]&255|(a[f+1]&255)<<8,C+=u&8191,y=a[f+2]&255|(a[f+3]&255)<<8,B+=(u>>>13|y<<3)&8191,m=a[f+4]&255|(a[f+5]&255)<<8,j+=(y>>>10|m<<6)&8191,E=a[f+6]&255|(a[f+7]&255)<<8,_+=(m>>>7|E<<9)&8191,P=a[f+8]&255|(a[f+9]&255)<<8,w+=(E>>>4|P<<12)&8191,k+=P>>>1&8191,M=a[f+10]&255|(a[f+11]&255)<<8,x+=(P>>>14|M<<2)&8191,R=a[f+12]&255|(a[f+13]&255)<<8,S+=(M>>>11|R<<5)&8191,ce=a[f+14]&255|(a[f+15]&255)<<8,A+=(R>>>8|ce<<8)&8191,F+=ce>>>5|i,U=0,z=U,z+=C*Q,z+=B*(5*ae),z+=j*(5*oe),z+=_*(5*te),z+=w*(5*fe),U=z>>>13,z&=8191,z+=k*(5*le),z+=x*(5*re),z+=S*(5*p),z+=A*(5*X),z+=F*(5*ee),U+=z>>>13,z&=8191,K=U,K+=C*ee,K+=B*Q,K+=j*(5*ae),K+=_*(5*oe),K+=w*(5*te),U=K>>>13,K&=8191,K+=k*(5*fe),K+=x*(5*le),K+=S*(5*re),K+=A*(5*p),K+=F*(5*X),U+=K>>>13,K&=8191,V=U,V+=C*X,V+=B*ee,V+=j*Q,V+=_*(5*ae),V+=w*(5*oe),U=V>>>13,V&=8191,V+=k*(5*te),V+=x*(5*fe),V+=S*(5*le),V+=A*(5*re),V+=F*(5*p),U+=V>>>13,V&=8191,Y=U,Y+=C*p,Y+=B*X,Y+=j*ee,Y+=_*Q,Y+=w*(5*ae),U=Y>>>13,Y&=8191,Y+=k*(5*oe),Y+=x*(5*te),Y+=S*(5*fe),Y+=A*(5*le),Y+=F*(5*re),U+=Y>>>13,Y&=8191,H=U,H+=C*re,H+=B*p,H+=j*X,H+=_*ee,H+=w*Q,U=H>>>13,H&=8191,H+=k*(5*ae),H+=x*(5*oe),H+=S*(5*te),H+=A*(5*fe),H+=F*(5*le),U+=H>>>13,H&=8191,G=U,G+=C*le,G+=B*re,G+=j*p,G+=_*X,G+=w*ee,U=G>>>13,G&=8191,G+=k*Q,G+=x*(5*ae),G+=S*(5*oe),G+=A*(5*te),G+=F*(5*fe),U+=G>>>13,G&=8191,J=U,J+=C*fe,J+=B*le,J+=j*re,J+=_*p,J+=w*X,U=J>>>13,J&=8191,J+=k*ee,J+=x*Q,J+=S*(5*ae),J+=A*(5*oe),J+=F*(5*te),U+=J>>>13,J&=8191,L=U,L+=C*te,L+=B*fe,L+=j*le,L+=_*re,L+=w*p,U=L>>>13,L&=8191,L+=k*X,L+=x*ee,L+=S*Q,L+=A*(5*ae),L+=F*(5*oe),U+=L>>>13,L&=8191,q=U,q+=C*oe,q+=B*te,q+=j*fe,q+=_*le,q+=w*re,U=q>>>13,q&=8191,q+=k*p,q+=x*X,q+=S*ee,q+=A*Q,q+=F*(5*ae),U+=q>>>13,q&=8191,$=U,$+=C*ae,$+=B*oe,$+=j*te,$+=_*fe,$+=w*le,U=$>>>13,$&=8191,$+=k*re,$+=x*p,$+=S*X,$+=A*ee,$+=F*Q,U+=$>>>13,$&=8191,U=(U<<2)+U|0,U=U+z|0,z=U&8191,U=U>>>13,K+=U,C=z,B=K,j=V,_=Y,w=H,k=G,x=J,S=L,A=q,F=$,f+=16,l-=16;this.h[0]=C,this.h[1]=B,this.h[2]=j,this.h[3]=_,this.h[4]=w,this.h[5]=k,this.h[6]=x,this.h[7]=S,this.h[8]=A,this.h[9]=F},Nt.prototype.finish=function(a,f){var l=new Uint16Array(10),i,u,y,m;if(this.leftover){for(m=this.leftover,this.buffer[m++]=1;m<16;m++)this.buffer[m]=0;this.fin=1,this.blocks(this.buffer,0,16)}for(i=this.h[1]>>>13,this.h[1]&=8191,m=2;m<10;m++)this.h[m]+=i,i=this.h[m]>>>13,this.h[m]&=8191;for(this.h[0]+=i*5,i=this.h[0]>>>13,this.h[0]&=8191,this.h[1]+=i,i=this.h[1]>>>13,this.h[1]&=8191,this.h[2]+=i,l[0]=this.h[0]+5,i=l[0]>>>13,l[0]&=8191,m=1;m<10;m++)l[m]=this.h[m]+i,i=l[m]>>>13,l[m]&=8191;for(l[9]-=8192,u=(i^1)-1,m=0;m<10;m++)l[m]&=u;for(u=~u,m=0;m<10;m++)this.h[m]=this.h[m]&u|l[m];for(this.h[0]=(this.h[0]|this.h[1]<<13)&65535,this.h[1]=(this.h[1]>>>3|this.h[2]<<10)&65535,this.h[2]=(this.h[2]>>>6|this.h[3]<<7)&65535,this.h[3]=(this.h[3]>>>9|this.h[4]<<4)&65535,this.h[4]=(this.h[4]>>>12|this.h[5]<<1|this.h[6]<<14)&65535,this.h[5]=(this.h[6]>>>2|this.h[7]<<11)&65535,this.h[6]=(this.h[7]>>>5|this.h[8]<<8)&65535,this.h[7]=(this.h[8]>>>8|this.h[9]<<5)&65535,y=this.h[0]+this.pad[0],this.h[0]=y&65535,m=1;m<8;m++)y=(this.h[m]+this.pad[m]|0)+(y>>>16)|0,this.h[m]=y&65535;a[f+0]=this.h[0]>>>0&255,a[f+1]=this.h[0]>>>8&255,a[f+2]=this.h[1]>>>0&255,a[f+3]=this.h[1]>>>8&255,a[f+4]=this.h[2]>>>0&255,a[f+5]=this.h[2]>>>8&255,a[f+6]=this.h[3]>>>0&255,a[f+7]=this.h[3]>>>8&255,a[f+8]=this.h[4]>>>0&255,a[f+9]=this.h[4]>>>8&255,a[f+10]=this.h[5]>>>0&255,a[f+11]=this.h[5]>>>8&255,a[f+12]=this.h[6]>>>0&255,a[f+13]=this.h[6]>>>8&255,a[f+14]=this.h[7]>>>0&255,a[f+15]=this.h[7]>>>8&255},Nt.prototype.update=function(a,f,l){var i,u;if(this.leftover){for(u=16-this.leftover,u>l&&(u=l),i=0;i<u;i++)this.buffer[this.leftover+i]=a[f+i];if(l-=u,f+=u,this.leftover+=u,this.leftover<16)return;this.blocks(this.buffer,0,16),this.leftover=0}if(l>=16&&(u=l-l%16,this.blocks(a,f,u),f+=u,l-=u),l){for(i=0;i<l;i++)this.buffer[this.leftover+i]=a[f+i];this.leftover+=l}};function cr(a,f,l,i,u,y){var m=new Nt(y);return m.update(l,i,u),m.finish(a,f),0}function Qr(a,f,l,i,u,y){var m=new Uint8Array(16);return cr(m,0,l,i,u,y),D(a,f,m,0)}function lr(a,f,l,i,u){var y;if(l<32)return-1;for(ar(a,0,f,0,l,i,u),cr(a,16,a,32,l-32,a),y=0;y<16;y++)a[y]=0;return 0}function fr(a,f,l,i,u){var y,m=new Uint8Array(32);if(l<32||(Vr(m,0,32,i,u),Qr(f,16,f,32,l-32,m)!==0))return-1;for(ar(a,0,f,0,l,i,u),y=0;y<32;y++)a[y]=0;return 0}function Ne(a,f){var l;for(l=0;l<16;l++)a[l]=f[l]|0}function ur(a){var f,l,i=1;for(f=0;f<16;f++)l=a[f]+i+65535,i=Math.floor(l/65536),a[f]=l-i*65536;a[0]+=i-1+37*(i-1)}function rt(a,f,l){for(var i,u=~(l-1),y=0;y<16;y++)i=u&(a[y]^f[y]),a[y]^=i,f[y]^=i}function st(a,f){var l,i,u,y=t(),m=t();for(l=0;l<16;l++)m[l]=f[l];for(ur(m),ur(m),ur(m),i=0;i<2;i++){for(y[0]=m[0]-65517,l=1;l<15;l++)y[l]=m[l]-65535-(y[l-1]>>16&1),y[l-1]&=65535;y[15]=m[15]-32767-(y[14]>>16&1),u=y[15]>>16&1,y[14]&=65535,rt(m,y,1-u)}for(l=0;l<16;l++)a[2*l]=m[l]&255,a[2*l+1]=m[l]>>8}function Xr(a,f){var l=new Uint8Array(32),i=new Uint8Array(32);return st(l,a),st(i,f),ue(l,0,i,0)}function Zr(a){var f=new Uint8Array(32);return st(f,a),f[0]&1}function dr(a,f){var l;for(l=0;l<16;l++)a[l]=f[2*l]+(f[2*l+1]<<8);a[15]&=32767}function Ce(a,f,l){for(var i=0;i<16;i++)a[i]=f[i]+l[i]}function Be(a,f,l){for(var i=0;i<16;i++)a[i]=f[i]-l[i]}function ie(a,f,l){var i,u,y=0,m=0,E=0,P=0,M=0,R=0,ce=0,U=0,z=0,K=0,V=0,Y=0,H=0,G=0,J=0,L=0,q=0,$=0,C=0,B=0,j=0,_=0,w=0,k=0,x=0,S=0,A=0,F=0,Q=0,ee=0,X=0,p=l[0],re=l[1],le=l[2],fe=l[3],te=l[4],oe=l[5],ae=l[6],Ee=l[7],he=l[8],we=l[9],be=l[10],xe=l[11],Se=l[12],Pe=l[13],je=l[14],Re=l[15];i=f[0],y+=i*p,m+=i*re,E+=i*le,P+=i*fe,M+=i*te,R+=i*oe,ce+=i*ae,U+=i*Ee,z+=i*he,K+=i*we,V+=i*be,Y+=i*xe,H+=i*Se,G+=i*Pe,J+=i*je,L+=i*Re,i=f[1],m+=i*p,E+=i*re,P+=i*le,M+=i*fe,R+=i*te,ce+=i*oe,U+=i*ae,z+=i*Ee,K+=i*he,V+=i*we,Y+=i*be,H+=i*xe,G+=i*Se,J+=i*Pe,L+=i*je,q+=i*Re,i=f[2],E+=i*p,P+=i*re,M+=i*le,R+=i*fe,ce+=i*te,U+=i*oe,z+=i*ae,K+=i*Ee,V+=i*he,Y+=i*we,H+=i*be,G+=i*xe,J+=i*Se,L+=i*Pe,q+=i*je,$+=i*Re,i=f[3],P+=i*p,M+=i*re,R+=i*le,ce+=i*fe,U+=i*te,z+=i*oe,K+=i*ae,V+=i*Ee,Y+=i*he,H+=i*we,G+=i*be,J+=i*xe,L+=i*Se,q+=i*Pe,$+=i*je,C+=i*Re,i=f[4],M+=i*p,R+=i*re,ce+=i*le,U+=i*fe,z+=i*te,K+=i*oe,V+=i*ae,Y+=i*Ee,H+=i*he,G+=i*we,J+=i*be,L+=i*xe,q+=i*Se,$+=i*Pe,C+=i*je,B+=i*Re,i=f[5],R+=i*p,ce+=i*re,U+=i*le,z+=i*fe,K+=i*te,V+=i*oe,Y+=i*ae,H+=i*Ee,G+=i*he,J+=i*we,L+=i*be,q+=i*xe,$+=i*Se,C+=i*Pe,B+=i*je,j+=i*Re,i=f[6],ce+=i*p,U+=i*re,z+=i*le,K+=i*fe,V+=i*te,Y+=i*oe,H+=i*ae,G+=i*Ee,J+=i*he,L+=i*we,q+=i*be,$+=i*xe,C+=i*Se,B+=i*Pe,j+=i*je,_+=i*Re,i=f[7],U+=i*p,z+=i*re,K+=i*le,V+=i*fe,Y+=i*te,H+=i*oe,G+=i*ae,J+=i*Ee,L+=i*he,q+=i*we,$+=i*be,C+=i*xe,B+=i*Se,j+=i*Pe,_+=i*je,w+=i*Re,i=f[8],z+=i*p,K+=i*re,V+=i*le,Y+=i*fe,H+=i*te,G+=i*oe,J+=i*ae,L+=i*Ee,q+=i*he,$+=i*we,C+=i*be,B+=i*xe,j+=i*Se,_+=i*Pe,w+=i*je,k+=i*Re,i=f[9],K+=i*p,V+=i*re,Y+=i*le,H+=i*fe,G+=i*te,J+=i*oe,L+=i*ae,q+=i*Ee,$+=i*he,C+=i*we,B+=i*be,j+=i*xe,_+=i*Se,w+=i*Pe,k+=i*je,x+=i*Re,i=f[10],V+=i*p,Y+=i*re,H+=i*le,G+=i*fe,J+=i*te,L+=i*oe,q+=i*ae,$+=i*Ee,C+=i*he,B+=i*we,j+=i*be,_+=i*xe,w+=i*Se,k+=i*Pe,x+=i*je,S+=i*Re,i=f[11],Y+=i*p,H+=i*re,G+=i*le,J+=i*fe,L+=i*te,q+=i*oe,$+=i*ae,C+=i*Ee,B+=i*he,j+=i*we,_+=i*be,w+=i*xe,k+=i*Se,x+=i*Pe,S+=i*je,A+=i*Re,i=f[12],H+=i*p,G+=i*re,J+=i*le,L+=i*fe,q+=i*te,$+=i*oe,C+=i*ae,B+=i*Ee,j+=i*he,_+=i*we,w+=i*be,k+=i*xe,x+=i*Se,S+=i*Pe,A+=i*je,F+=i*Re,i=f[13],G+=i*p,J+=i*re,L+=i*le,q+=i*fe,$+=i*te,C+=i*oe,B+=i*ae,j+=i*Ee,_+=i*he,w+=i*we,k+=i*be,x+=i*xe,S+=i*Se,A+=i*Pe,F+=i*je,Q+=i*Re,i=f[14],J+=i*p,L+=i*re,q+=i*le,$+=i*fe,C+=i*te,B+=i*oe,j+=i*ae,_+=i*Ee,w+=i*he,k+=i*we,x+=i*be,S+=i*xe,A+=i*Se,F+=i*Pe,Q+=i*je,ee+=i*Re,i=f[15],L+=i*p,q+=i*re,$+=i*le,C+=i*fe,B+=i*te,j+=i*oe,_+=i*ae,w+=i*Ee,k+=i*he,x+=i*we,S+=i*be,A+=i*xe,F+=i*Se,Q+=i*Pe,ee+=i*je,X+=i*Re,y+=38*q,m+=38*$,E+=38*C,P+=38*B,M+=38*j,R+=38*_,ce+=38*w,U+=38*k,z+=38*x,K+=38*S,V+=38*A,Y+=38*F,H+=38*Q,G+=38*ee,J+=38*X,u=1,i=y+u+65535,u=Math.floor(i/65536),y=i-u*65536,i=m+u+65535,u=Math.floor(i/65536),m=i-u*65536,i=E+u+65535,u=Math.floor(i/65536),E=i-u*65536,i=P+u+65535,u=Math.floor(i/65536),P=i-u*65536,i=M+u+65535,u=Math.floor(i/65536),M=i-u*65536,i=R+u+65535,u=Math.floor(i/65536),R=i-u*65536,i=ce+u+65535,u=Math.floor(i/65536),ce=i-u*65536,i=U+u+65535,u=Math.floor(i/65536),U=i-u*65536,i=z+u+65535,u=Math.floor(i/65536),z=i-u*65536,i=K+u+65535,u=Math.floor(i/65536),K=i-u*65536,i=V+u+65535,u=Math.floor(i/65536),V=i-u*65536,i=Y+u+65535,u=Math.floor(i/65536),Y=i-u*65536,i=H+u+65535,u=Math.floor(i/65536),H=i-u*65536,i=G+u+65535,u=Math.floor(i/65536),G=i-u*65536,i=J+u+65535,u=Math.floor(i/65536),J=i-u*65536,i=L+u+65535,u=Math.floor(i/65536),L=i-u*65536,y+=u-1+37*(u-1),u=1,i=y+u+65535,u=Math.floor(i/65536),y=i-u*65536,i=m+u+65535,u=Math.floor(i/65536),m=i-u*65536,i=E+u+65535,u=Math.floor(i/65536),E=i-u*65536,i=P+u+65535,u=Math.floor(i/65536),P=i-u*65536,i=M+u+65535,u=Math.floor(i/65536),M=i-u*65536,i=R+u+65535,u=Math.floor(i/65536),R=i-u*65536,i=ce+u+65535,u=Math.floor(i/65536),ce=i-u*65536,i=U+u+65535,u=Math.floor(i/65536),U=i-u*65536,i=z+u+65535,u=Math.floor(i/65536),z=i-u*65536,i=K+u+65535,u=Math.floor(i/65536),K=i-u*65536,i=V+u+65535,u=Math.floor(i/65536),V=i-u*65536,i=Y+u+65535,u=Math.floor(i/65536),Y=i-u*65536,i=H+u+65535,u=Math.floor(i/65536),H=i-u*65536,i=G+u+65535,u=Math.floor(i/65536),G=i-u*65536,i=J+u+65535,u=Math.floor(i/65536),J=i-u*65536,i=L+u+65535,u=Math.floor(i/65536),L=i-u*65536,y+=u-1+37*(u-1),a[0]=y,a[1]=m,a[2]=E,a[3]=P,a[4]=M,a[5]=R,a[6]=ce,a[7]=U,a[8]=z,a[9]=K,a[10]=V,a[11]=Y,a[12]=H,a[13]=G,a[14]=J,a[15]=L}function Le(a,f){ie(a,f,f)}function es(a,f){var l=t(),i;for(i=0;i<16;i++)l[i]=f[i];for(i=253;i>=0;i--)Le(l,l),i!==2&&i!==4&&ie(l,l,f);for(i=0;i<16;i++)a[i]=l[i]}function ts(a,f){var l=t(),i;for(i=0;i<16;i++)l[i]=f[i];for(i=250;i>=0;i--)Le(l,l),i!==1&&ie(l,l,f);for(i=0;i<16;i++)a[i]=l[i]}function Ft(a,f,l){var i=new Uint8Array(32),u=new Float64Array(80),y,m,E=t(),P=t(),M=t(),R=t(),ce=t(),U=t();for(m=0;m<31;m++)i[m]=f[m];for(i[31]=f[31]&127|64,i[0]&=248,dr(u,l),m=0;m<16;m++)P[m]=u[m],R[m]=E[m]=M[m]=0;for(E[0]=R[0]=1,m=254;m>=0;--m)y=i[m>>>3]>>>(m&7)&1,rt(E,P,y),rt(M,R,y),Ce(ce,E,M),Be(E,E,M),Ce(M,P,R),Be(P,P,R),Le(R,ce),Le(U,E),ie(E,M,E),ie(M,P,ce),Ce(ce,E,M),Be(E,E,M),Le(P,E),Be(M,R,U),ie(E,M,h),Ce(E,E,R),ie(M,M,E),ie(E,R,U),ie(R,P,u),Le(P,ce),rt(E,P,y),rt(M,R,y);for(m=0;m<16;m++)u[m+16]=E[m],u[m+32]=M[m],u[m+48]=P[m],u[m+64]=R[m];var z=u.subarray(32),K=u.subarray(16);return es(z,z),ie(K,K,z),st(a,K),0}function Wt(a,f){return Ft(a,f,o)}function rs(a,f){return r(f,32),Wt(a,f)}function zt(a,f,l){var i=new Uint8Array(32);return Ft(i,l,f),ve(a,n,i,de)}var ss=lr,dn=fr;function hn(a,f,l,i,u,y){var m=new Uint8Array(32);return zt(m,u,y),ss(a,f,l,i,m)}function pn(a,f,l,i,u,y){var m=new Uint8Array(32);return zt(m,u,y),dn(a,f,l,i,m)}var ns=[1116352408,3609767458,1899447441,602891725,3049323471,3964484399,3921009573,2173295548,961987163,4081628472,1508970993,3053834265,2453635748,2937671579,2870763221,3664609560,3624381080,2734883394,310598401,1164996542,607225278,1323610764,1426881987,3590304994,1925078388,4068182383,2162078206,991336113,2614888103,633803317,3248222580,3479774868,3835390401,2666613458,4022224774,944711139,264347078,2341262773,604807628,2007800933,770255983,1495990901,1249150122,1856431235,1555081692,3175218132,1996064986,2198950837,2554220882,3999719339,2821834349,766784016,2952996808,2566594879,3210313671,3203337956,3336571891,1034457026,3584528711,2466948901,113926993,3758326383,338241895,168717936,666307205,1188179964,773529912,1546045734,1294757372,1522805485,1396182291,2643833823,1695183700,2343527390,1986661051,1014477480,2177026350,1206759142,2456956037,344077627,2730485921,1290863460,2820302411,3158454273,3259730800,3505952657,3345764771,106217008,3516065817,3606008344,3600352804,1432725776,4094571909,1467031594,275423344,851169720,430227734,3100823752,506948616,1363258195,659060556,3750685593,883997877,3785050280,958139571,3318307427,1322822218,3812723403,1537002063,2003034995,1747873779,3602036899,1955562222,1575990012,2024104815,1125592928,2227730452,2716904306,2361852424,442776044,2428436474,593698344,2756734187,3733110249,3204031479,2999351573,3329325298,3815920427,3391569614,3928383900,3515267271,566280711,3940187606,3454069534,4118630271,4000239992,116418474,1914138554,174292421,2731055270,289380356,3203993006,460393269,320620315,685471733,587496836,852142971,1086792851,1017036298,365543100,1126000580,2618297676,1288033470,3409855158,1501505948,4234509866,1607167915,987167468,1816402316,1246189591];function is(a,f,l,i){for(var u=new Int32Array(16),y=new Int32Array(16),m,E,P,M,R,ce,U,z,K,V,Y,H,G,J,L,q,$,C,B,j,_,w,k,x,S,A,F=a[0],Q=a[1],ee=a[2],X=a[3],p=a[4],re=a[5],le=a[6],fe=a[7],te=f[0],oe=f[1],ae=f[2],Ee=f[3],he=f[4],we=f[5],be=f[6],xe=f[7],Se=0;i>=128;){for(B=0;B<16;B++)j=8*B+Se,u[B]=l[j+0]<<24|l[j+1]<<16|l[j+2]<<8|l[j+3],y[B]=l[j+4]<<24|l[j+5]<<16|l[j+6]<<8|l[j+7];for(B=0;B<80;B++)if(m=F,E=Q,P=ee,M=X,R=p,ce=re,U=le,z=fe,K=te,V=oe,Y=ae,H=Ee,G=he,J=we,L=be,q=xe,_=fe,w=xe,k=w&65535,x=w>>>16,S=_&65535,A=_>>>16,_=(p>>>14|he<<18)^(p>>>18|he<<14)^(he>>>9|p<<23),w=(he>>>14|p<<18)^(he>>>18|p<<14)^(p>>>9|he<<23),k+=w&65535,x+=w>>>16,S+=_&65535,A+=_>>>16,_=p&re^~p&le,w=he&we^~he&be,k+=w&65535,x+=w>>>16,S+=_&65535,A+=_>>>16,_=ns[B*2],w=ns[B*2+1],k+=w&65535,x+=w>>>16,S+=_&65535,A+=_>>>16,_=u[B%16],w=y[B%16],k+=w&65535,x+=w>>>16,S+=_&65535,A+=_>>>16,x+=k>>>16,S+=x>>>16,A+=S>>>16,$=S&65535|A<<16,C=k&65535|x<<16,_=$,w=C,k=w&65535,x=w>>>16,S=_&65535,A=_>>>16,_=(F>>>28|te<<4)^(te>>>2|F<<30)^(te>>>7|F<<25),w=(te>>>28|F<<4)^(F>>>2|te<<30)^(F>>>7|te<<25),k+=w&65535,x+=w>>>16,S+=_&65535,A+=_>>>16,_=F&Q^F&ee^Q&ee,w=te&oe^te&ae^oe&ae,k+=w&65535,x+=w>>>16,S+=_&65535,A+=_>>>16,x+=k>>>16,S+=x>>>16,A+=S>>>16,z=S&65535|A<<16,q=k&65535|x<<16,_=M,w=H,k=w&65535,x=w>>>16,S=_&65535,A=_>>>16,_=$,w=C,k+=w&65535,x+=w>>>16,S+=_&65535,A+=_>>>16,x+=k>>>16,S+=x>>>16,A+=S>>>16,M=S&65535|A<<16,H=k&65535|x<<16,Q=m,ee=E,X=P,p=M,re=R,le=ce,fe=U,F=z,oe=K,ae=V,Ee=Y,he=H,we=G,be=J,xe=L,te=q,B%16===15)for(j=0;j<16;j++)_=u[j],w=y[j],k=w&65535,x=w>>>16,S=_&65535,A=_>>>16,_=u[(j+9)%16],w=y[(j+9)%16],k+=w&65535,x+=w>>>16,S+=_&65535,A+=_>>>16,$=u[(j+1)%16],C=y[(j+1)%16],_=($>>>1|C<<31)^($>>>8|C<<24)^$>>>7,w=(C>>>1|$<<31)^(C>>>8|$<<24)^(C>>>7|$<<25),k+=w&65535,x+=w>>>16,S+=_&65535,A+=_>>>16,$=u[(j+14)%16],C=y[(j+14)%16],_=($>>>19|C<<13)^(C>>>29|$<<3)^$>>>6,w=(C>>>19|$<<13)^($>>>29|C<<3)^(C>>>6|$<<26),k+=w&65535,x+=w>>>16,S+=_&65535,A+=_>>>16,x+=k>>>16,S+=x>>>16,A+=S>>>16,u[j]=S&65535|A<<16,y[j]=k&65535|x<<16;_=F,w=te,k=w&65535,x=w>>>16,S=_&65535,A=_>>>16,_=a[0],w=f[0],k+=w&65535,x+=w>>>16,S+=_&65535,A+=_>>>16,x+=k>>>16,S+=x>>>16,A+=S>>>16,a[0]=F=S&65535|A<<16,f[0]=te=k&65535|x<<16,_=Q,w=oe,k=w&65535,x=w>>>16,S=_&65535,A=_>>>16,_=a[1],w=f[1],k+=w&65535,x+=w>>>16,S+=_&65535,A+=_>>>16,x+=k>>>16,S+=x>>>16,A+=S>>>16,a[1]=Q=S&65535|A<<16,f[1]=oe=k&65535|x<<16,_=ee,w=ae,k=w&65535,x=w>>>16,S=_&65535,A=_>>>16,_=a[2],w=f[2],k+=w&65535,x+=w>>>16,S+=_&65535,A+=_>>>16,x+=k>>>16,S+=x>>>16,A+=S>>>16,a[2]=ee=S&65535|A<<16,f[2]=ae=k&65535|x<<16,_=X,w=Ee,k=w&65535,x=w>>>16,S=_&65535,A=_>>>16,_=a[3],w=f[3],k+=w&65535,x+=w>>>16,S+=_&65535,A+=_>>>16,x+=k>>>16,S+=x>>>16,A+=S>>>16,a[3]=X=S&65535|A<<16,f[3]=Ee=k&65535|x<<16,_=p,w=he,k=w&65535,x=w>>>16,S=_&65535,A=_>>>16,_=a[4],w=f[4],k+=w&65535,x+=w>>>16,S+=_&65535,A+=_>>>16,x+=k>>>16,S+=x>>>16,A+=S>>>16,a[4]=p=S&65535|A<<16,f[4]=he=k&65535|x<<16,_=re,w=we,k=w&65535,x=w>>>16,S=_&65535,A=_>>>16,_=a[5],w=f[5],k+=w&65535,x+=w>>>16,S+=_&65535,A+=_>>>16,x+=k>>>16,S+=x>>>16,A+=S>>>16,a[5]=re=S&65535|A<<16,f[5]=we=k&65535|x<<16,_=le,w=be,k=w&65535,x=w>>>16,S=_&65535,A=_>>>16,_=a[6],w=f[6],k+=w&65535,x+=w>>>16,S+=_&65535,A+=_>>>16,x+=k>>>16,S+=x>>>16,A+=S>>>16,a[6]=le=S&65535|A<<16,f[6]=be=k&65535|x<<16,_=fe,w=xe,k=w&65535,x=w>>>16,S=_&65535,A=_>>>16,_=a[7],w=f[7],k+=w&65535,x+=w>>>16,S+=_&65535,A+=_>>>16,x+=k>>>16,S+=x>>>16,A+=S>>>16,a[7]=fe=S&65535|A<<16,f[7]=xe=k&65535|x<<16,Se+=128,i-=128}return i}function Ve(a,f,l){var i=new Int32Array(8),u=new Int32Array(8),y=new Uint8Array(256),m,E=l;for(i[0]=1779033703,i[1]=3144134277,i[2]=1013904242,i[3]=2773480762,i[4]=1359893119,i[5]=2600822924,i[6]=528734635,i[7]=1541459225,u[0]=4089235720,u[1]=2227873595,u[2]=4271175723,u[3]=1595750129,u[4]=2917565137,u[5]=725511199,u[6]=4215389547,u[7]=327033209,is(i,u,f,l),l%=128,m=0;m<l;m++)y[m]=f[E-l+m];for(y[l]=128,l=256-128*(l<112?1:0),y[l-9]=0,I(y,l-8,E/536870912|0,E<<3),is(i,u,y,l),m=0;m<8;m++)I(a,8*m,i[m],u[m]);return 0}function Kt(a,f){var l=t(),i=t(),u=t(),y=t(),m=t(),E=t(),P=t(),M=t(),R=t();Be(l,a[1],a[0]),Be(R,f[1],f[0]),ie(l,l,R),Ce(i,a[0],a[1]),Ce(R,f[0],f[1]),ie(i,i,R),ie(u,a[3],f[3]),ie(u,u,v),ie(y,a[2],f[2]),Ce(y,y,y),Be(m,i,l),Be(E,y,u),Ce(P,y,u),Ce(M,i,l),ie(a[0],m,E),ie(a[1],M,P),ie(a[2],P,E),ie(a[3],m,M)}function os(a,f,l){var i;for(i=0;i<4;i++)rt(a[i],f[i],l)}function hr(a,f){var l=t(),i=t(),u=t();es(u,f[2]),ie(l,f[0],u),ie(i,f[1],u),st(a,i),a[31]^=Zr(l)<<7}function pr(a,f,l){var i,u;for(Ne(a[0],c),Ne(a[1],d),Ne(a[2],d),Ne(a[3],c),u=255;u>=0;--u)i=l[u/8|0]>>(u&7)&1,os(a,f,i),Kt(f,a),Kt(a,a),os(a,f,i)}function Ht(a,f){var l=[t(),t(),t(),t()];Ne(l[0],b),Ne(l[1],T),Ne(l[2],d),ie(l[3],b,T),pr(a,l,f)}function gr(a,f,l){var i=new Uint8Array(64),u=[t(),t(),t(),t()],y;for(l||r(f,32),Ve(i,f,32),i[0]&=248,i[31]&=127,i[31]|=64,Ht(u,i),hr(a,u),y=0;y<32;y++)f[y+32]=a[y];return 0}var Jt=new Float64Array([237,211,245,92,26,99,18,88,214,156,247,162,222,249,222,20,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,16]);function vr(a,f){var l,i,u,y;for(i=63;i>=32;--i){for(l=0,u=i-32,y=i-12;u<y;++u)f[u]+=l-16*f[i]*Jt[u-(i-32)],l=Math.floor((f[u]+128)/256),f[u]-=l*256;f[u]+=l,f[i]=0}for(l=0,u=0;u<32;u++)f[u]+=l-(f[31]>>4)*Jt[u],l=f[u]>>8,f[u]&=255;for(u=0;u<32;u++)f[u]-=l*Jt[u];for(i=0;i<32;i++)f[i+1]+=f[i]>>8,a[i]=f[i]&255}function yr(a){var f=new Float64Array(64),l;for(l=0;l<64;l++)f[l]=a[l];for(l=0;l<64;l++)a[l]=0;vr(a,f)}function as(a,f,l,i){var u=new Uint8Array(64),y=new Uint8Array(64),m=new Uint8Array(64),E,P,M=new Float64Array(64),R=[t(),t(),t(),t()];Ve(u,i,32),u[0]&=248,u[31]&=127,u[31]|=64;var ce=l+64;for(E=0;E<l;E++)a[64+E]=f[E];for(E=0;E<32;E++)a[32+E]=u[32+E];for(Ve(m,a.subarray(32),l+32),yr(m),Ht(R,m),hr(a,R),E=32;E<64;E++)a[E]=i[E];for(Ve(y,a,l+64),yr(y),E=0;E<64;E++)M[E]=0;for(E=0;E<32;E++)M[E]=m[E];for(E=0;E<32;E++)for(P=0;P<32;P++)M[E+P]+=y[E]*u[P];return vr(a.subarray(32),M),ce}function gn(a,f){var l=t(),i=t(),u=t(),y=t(),m=t(),E=t(),P=t();return Ne(a[2],d),dr(a[1],f),Le(u,a[1]),ie(y,u,g),Be(u,u,a[2]),Ce(y,a[2],y),Le(m,y),Le(E,m),ie(P,E,m),ie(l,P,u),ie(l,l,y),ts(l,l),ie(l,l,u),ie(l,l,y),ie(l,l,y),ie(a[0],l,y),Le(i,a[0]),ie(i,i,y),Xr(i,u)&&ie(a[0],a[0],O),Le(i,a[0]),ie(i,i,y),Xr(i,u)?-1:(Zr(a[0])===f[31]>>7&&Be(a[0],c,a[0]),ie(a[3],a[0],a[1]),0)}function mr(a,f,l,i){var u,y=new Uint8Array(32),m=new Uint8Array(64),E=[t(),t(),t(),t()],P=[t(),t(),t(),t()];if(l<64||gn(P,i))return-1;for(u=0;u<l;u++)a[u]=f[u];for(u=0;u<32;u++)a[u+32]=i[u];if(Ve(m,a,l),yr(m),pr(E,P,m),Ht(P,f.subarray(32)),Kt(E,P),hr(y,E),l-=64,ue(f,0,y,0)){for(u=0;u<l;u++)a[u]=0;return-1}for(u=0;u<l;u++)a[u]=f[u+64];return l}var _r=32,Gt=24,wt=32,nt=16,bt=32,Yt=32,xt=32,Et=32,wr=32,cs=Gt,vn=wt,yn=nt,Fe=64,Qe=32,it=64,br=32,xr=64;e.lowlevel={crypto_core_hsalsa20:ve,crypto_stream_xor:ar,crypto_stream:Vr,crypto_stream_salsa20_xor:Oe,crypto_stream_salsa20:Yr,crypto_onetimeauth:cr,crypto_onetimeauth_verify:Qr,crypto_verify_16:D,crypto_verify_32:ue,crypto_secretbox:lr,crypto_secretbox_open:fr,crypto_scalarmult:Ft,crypto_scalarmult_base:Wt,crypto_box_beforenm:zt,crypto_box_afternm:ss,crypto_box:hn,crypto_box_open:pn,crypto_box_keypair:rs,crypto_hash:Ve,crypto_sign:as,crypto_sign_keypair:gr,crypto_sign_open:mr,crypto_secretbox_KEYBYTES:_r,crypto_secretbox_NONCEBYTES:Gt,crypto_secretbox_ZEROBYTES:wt,crypto_secretbox_BOXZEROBYTES:nt,crypto_scalarmult_BYTES:bt,crypto_scalarmult_SCALARBYTES:Yt,crypto_box_PUBLICKEYBYTES:xt,crypto_box_SECRETKEYBYTES:Et,crypto_box_BEFORENMBYTES:wr,crypto_box_NONCEBYTES:cs,crypto_box_ZEROBYTES:vn,crypto_box_BOXZEROBYTES:yn,crypto_sign_BYTES:Fe,crypto_sign_PUBLICKEYBYTES:Qe,crypto_sign_SECRETKEYBYTES:it,crypto_sign_SEEDBYTES:br,crypto_hash_BYTES:xr,gf:t,D:g,L:Jt,pack25519:st,unpack25519:dr,M:ie,A:Ce,S:Le,Z:Be,pow2523:ts,add:Kt,set25519:Ne,modL:vr,scalarmult:pr,scalarbase:Ht};function ls(a,f){if(a.length!==_r)throw new Error("bad key size");if(f.length!==Gt)throw new Error("bad nonce size")}function mn(a,f){if(a.length!==xt)throw new Error("bad public key size");if(f.length!==Et)throw new Error("bad secret key size")}function Ue(){for(var a=0;a<arguments.length;a++)if(!(arguments[a]instanceof Uint8Array))throw new TypeError("unexpected type, use Uint8Array")}function fs(a){for(var f=0;f<a.length;f++)a[f]=0}e.randomBytes=function(a){var f=new Uint8Array(a);return r(f,a),f},e.secretbox=function(a,f,l){Ue(a,f,l),ls(l,f);for(var i=new Uint8Array(wt+a.length),u=new Uint8Array(i.length),y=0;y<a.length;y++)i[y+wt]=a[y];return lr(u,i,i.length,f,l),u.subarray(nt)},e.secretbox.open=function(a,f,l){Ue(a,f,l),ls(l,f);for(var i=new Uint8Array(nt+a.length),u=new Uint8Array(i.length),y=0;y<a.length;y++)i[y+nt]=a[y];return i.length<32||fr(u,i,i.length,f,l)!==0?null:u.subarray(wt)},e.secretbox.keyLength=_r,e.secretbox.nonceLength=Gt,e.secretbox.overheadLength=nt,e.scalarMult=function(a,f){if(Ue(a,f),a.length!==Yt)throw new Error("bad n size");if(f.length!==bt)throw new Error("bad p size");var l=new Uint8Array(bt);return Ft(l,a,f),l},e.scalarMult.base=function(a){if(Ue(a),a.length!==Yt)throw new Error("bad n size");var f=new Uint8Array(bt);return Wt(f,a),f},e.scalarMult.scalarLength=Yt,e.scalarMult.groupElementLength=bt,e.box=function(a,f,l,i){var u=e.box.before(l,i);return e.secretbox(a,f,u)},e.box.before=function(a,f){Ue(a,f),mn(a,f);var l=new Uint8Array(wr);return zt(l,a,f),l},e.box.after=e.secretbox,e.box.open=function(a,f,l,i){var u=e.box.before(l,i);return e.secretbox.open(a,f,u)},e.box.open.after=e.secretbox.open,e.box.keyPair=function(){var a=new Uint8Array(xt),f=new Uint8Array(Et);return rs(a,f),{publicKey:a,secretKey:f}},e.box.keyPair.fromSecretKey=function(a){if(Ue(a),a.length!==Et)throw new Error("bad secret key size");var f=new Uint8Array(xt);return Wt(f,a),{publicKey:f,secretKey:new Uint8Array(a)}},e.box.publicKeyLength=xt,e.box.secretKeyLength=Et,e.box.sharedKeyLength=wr,e.box.nonceLength=cs,e.box.overheadLength=e.secretbox.overheadLength,e.sign=function(a,f){if(Ue(a,f),f.length!==it)throw new Error("bad secret key size");var l=new Uint8Array(Fe+a.length);return as(l,a,a.length,f),l},e.sign.open=function(a,f){if(Ue(a,f),f.length!==Qe)throw new Error("bad public key size");var l=new Uint8Array(a.length),i=mr(l,a,a.length,f);if(i<0)return null;for(var u=new Uint8Array(i),y=0;y<u.length;y++)u[y]=l[y];return u},e.sign.detached=function(a,f){for(var l=e.sign(a,f),i=new Uint8Array(Fe),u=0;u<i.length;u++)i[u]=l[u];return i},e.sign.detached.verify=function(a,f,l){if(Ue(a,f,l),f.length!==Fe)throw new Error("bad signature size");if(l.length!==Qe)throw new Error("bad public key size");var i=new Uint8Array(Fe+a.length),u=new Uint8Array(Fe+a.length),y;for(y=0;y<Fe;y++)i[y]=f[y];for(y=0;y<a.length;y++)i[y+Fe]=a[y];return mr(u,i,i.length,l)>=0},e.sign.keyPair=function(){var a=new Uint8Array(Qe),f=new Uint8Array(it);return gr(a,f),{publicKey:a,secretKey:f}},e.sign.keyPair.fromSecretKey=function(a){if(Ue(a),a.length!==it)throw new Error("bad secret key size");for(var f=new Uint8Array(Qe),l=0;l<f.length;l++)f[l]=a[32+l];return{publicKey:f,secretKey:new Uint8Array(a)}},e.sign.keyPair.fromSeed=function(a){if(Ue(a),a.length!==br)throw new Error("bad seed size");for(var f=new Uint8Array(Qe),l=new Uint8Array(it),i=0;i<32;i++)l[i]=a[i];return gr(f,l,!0),{publicKey:f,secretKey:l}},e.sign.publicKeyLength=Qe,e.sign.secretKeyLength=it,e.sign.seedLength=br,e.sign.signatureLength=Fe,e.hash=function(a){Ue(a);var f=new Uint8Array(xr);return Ve(f,a,a.length),f},e.hash.hashLength=xr,e.verify=function(a,f){return Ue(a,f),a.length===0||f.length===0||a.length!==f.length?!1:W(a,0,f,0,a.length)===0},e.setPRNG=function(a){r=a},function(){var a=typeof self<"u"?self.crypto||self.msCrypto:null;if(a&&a.getRandomValues){var f=65536;e.setPRNG(function(l,i){var u,y=new Uint8Array(i);for(u=0;u<i;u+=f)a.getRandomValues(y.subarray(u,u+Math.min(i-u,f)));for(u=0;u<i;u++)l[u]=y[u];fs(y)})}else typeof xn<"u"&&(a=kn,a&&a.randomBytes&&e.setPRNG(function(l,i){var u,y=a.randomBytes(i);for(u=0;u<i;u++)l[u]=y[u];fs(y)}))}()})(s.exports?s.exports:self.nacl=self.nacl||{})}(Er)),Er.exports}Tn();var He;(function(s){s[s.UNKNOWN_ERROR=0]="UNKNOWN_ERROR",s[s.BAD_REQUEST_ERROR=1]="BAD_REQUEST_ERROR",s[s.MANIFEST_NOT_FOUND_ERROR=2]="MANIFEST_NOT_FOUND_ERROR",s[s.MANIFEST_CONTENT_ERROR=3]="MANIFEST_CONTENT_ERROR",s[s.UNKNOWN_APP_ERROR=100]="UNKNOWN_APP_ERROR",s[s.USER_REJECTS_ERROR=300]="USER_REJECTS_ERROR",s[s.METHOD_NOT_SUPPORTED=400]="METHOD_NOT_SUPPORTED"})(He||(He={}));var hs;(function(s){s[s.UNKNOWN_ERROR=0]="UNKNOWN_ERROR",s[s.METHOD_NOT_SUPPORTED=400]="METHOD_NOT_SUPPORTED"})(hs||(hs={}));var vt;(function(s){s[s.UNKNOWN_ERROR=0]="UNKNOWN_ERROR",s[s.BAD_REQUEST_ERROR=1]="BAD_REQUEST_ERROR",s[s.UNKNOWN_APP_ERROR=100]="UNKNOWN_APP_ERROR",s[s.USER_REJECTS_ERROR=300]="USER_REJECTS_ERROR",s[s.METHOD_NOT_SUPPORTED=400]="METHOD_NOT_SUPPORTED"})(vt||(vt={}));var yt;(function(s){s[s.UNKNOWN_ERROR=0]="UNKNOWN_ERROR",s[s.BAD_REQUEST_ERROR=1]="BAD_REQUEST_ERROR",s[s.UNKNOWN_APP_ERROR=100]="UNKNOWN_APP_ERROR",s[s.USER_REJECTS_ERROR=300]="USER_REJECTS_ERROR",s[s.METHOD_NOT_SUPPORTED=400]="METHOD_NOT_SUPPORTED"})(yt||(yt={}));var ps;(function(s){s[s.UNKNOWN_ERROR=0]="UNKNOWN_ERROR",s[s.BAD_REQUEST_ERROR=1]="BAD_REQUEST_ERROR",s[s.UNKNOWN_APP_ERROR=100]="UNKNOWN_APP_ERROR",s[s.METHOD_NOT_SUPPORTED=400]="METHOD_NOT_SUPPORTED"})(ps||(ps={}));var gs;(function(s){s.MAINNET="-239",s.TESTNET="-3"})(gs||(gs={}));class qe extends Error{constructor(e,t){super(e,t),this.message=`${qe.prefix} ${this.constructor.name}${this.info?": "+this.info:""}${e?`
`+e:""}`,Object.setPrototypeOf(this,qe.prototype)}get info(){return""}}qe.prefix="[TON_CONNECT_SDK_ERROR]";class Nr extends qe{get info(){return"Passed `tonconnect-manifest.json` contains errors. Check format of your manifest. See more https://github.com/ton-connect/docs/blob/main/requests-responses.md#app-manifest"}constructor(...e){super(...e),Object.setPrototypeOf(this,Nr.prototype)}}class Fr extends qe{get info(){return"Manifest not found. Make sure you added `tonconnect-manifest.json` to the root of your app or passed correct manifestUrl. See more https://github.com/ton-connect/docs/blob/main/requests-responses.md#app-manifest"}constructor(...e){super(...e),Object.setPrototypeOf(this,Fr.prototype)}}class Lt extends qe{get info(){return"User rejects the action in the wallet."}constructor(...e){super(...e),Object.setPrototypeOf(this,Lt.prototype)}}class Ct extends qe{get info(){return"Request to the wallet contains errors."}constructor(...e){super(...e),Object.setPrototypeOf(this,Ct.prototype)}}class Bt extends qe{get info(){return"App tries to send rpc request to the injected wallet while not connected."}constructor(...e){super(...e),Object.setPrototypeOf(this,Bt.prototype)}}class Mt extends qe{constructor(...e){super(...e),Object.setPrototypeOf(this,Mt.prototype)}}He.UNKNOWN_ERROR+"",He.USER_REJECTS_ERROR+"",He.BAD_REQUEST_ERROR+"",He.UNKNOWN_APP_ERROR+"",He.MANIFEST_NOT_FOUND_ERROR+"",He.MANIFEST_CONTENT_ERROR+"";vt.UNKNOWN_ERROR+"",vt.USER_REJECTS_ERROR+"",vt.BAD_REQUEST_ERROR+"",vt.UNKNOWN_APP_ERROR+"";yt.UNKNOWN_ERROR+"",yt.USER_REJECTS_ERROR+"",yt.BAD_REQUEST_ERROR+"",yt.UNKNOWN_APP_ERROR+"";for(let s=0;s<=255;s++){let e=s.toString(16);e.length<2&&(e="0"+e)}const An="modulepreload",On=function(s){return"/"+s},vs={},Dt=function(e,t,r){let n=Promise.resolve();if(t&&t.length>0){let g=function(v){return Promise.all(v.map(b=>Promise.resolve(b).then(T=>({status:"fulfilled",value:T}),T=>({status:"rejected",reason:T}))))};var c=g;document.getElementsByTagName("link");const d=document.querySelector("meta[property=csp-nonce]"),h=d?.nonce||d?.getAttribute("nonce");n=g(t.map(v=>{if(v=On(v),v in vs)return;vs[v]=!0;const b=v.endsWith(".css"),T=b?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${v}"]${T}`))return;const O=document.createElement("link");if(O.rel=b?"stylesheet":An,b||(O.as="script"),O.crossOrigin="",O.href=v,h&&O.setAttribute("nonce",h),document.head.appendChild(O),b)return new Promise((I,W)=>{O.addEventListener("load",I),O.addEventListener("error",()=>W(new Error(`Unable to preload CSS for ${v}`)))})}))}function o(d){const h=new Event("vite:preloadError",{cancelable:!0});if(h.payload=d,window.dispatchEvent(h),!h.defaultPrevented)throw d}return n.then(d=>{for(const h of d||[])h.status==="rejected"&&o(h.reason);return e().catch(o)})},Pn=s=>{let e;return s?e=s:typeof fetch>"u"?e=(...t)=>Dt(async()=>{const{default:r}=await Promise.resolve().then(()=>_t);return{default:r}},void 0).then(({default:r})=>r(...t)):e=fetch,(...t)=>e(...t)};class Wr extends Error{constructor(e,t="FunctionsError",r){super(e),this.name=t,this.context=r}}class jn extends Wr{constructor(e){super("Failed to send a request to the Edge Function","FunctionsFetchError",e)}}class Rn extends Wr{constructor(e){super("Relay Error invoking the Edge Function","FunctionsRelayError",e)}}class $n extends Wr{constructor(e){super("Edge Function returned a non-2xx status code","FunctionsHttpError",e)}}var $r;(function(s){s.Any="any",s.ApNortheast1="ap-northeast-1",s.ApNortheast2="ap-northeast-2",s.ApSouth1="ap-south-1",s.ApSoutheast1="ap-southeast-1",s.ApSoutheast2="ap-southeast-2",s.CaCentral1="ca-central-1",s.EuCentral1="eu-central-1",s.EuWest1="eu-west-1",s.EuWest2="eu-west-2",s.EuWest3="eu-west-3",s.SaEast1="sa-east-1",s.UsEast1="us-east-1",s.UsWest1="us-west-1",s.UsWest2="us-west-2"})($r||($r={}));var In=function(s,e,t,r){function n(o){return o instanceof t?o:new t(function(c){c(o)})}return new(t||(t=Promise))(function(o,c){function d(v){try{g(r.next(v))}catch(b){c(b)}}function h(v){try{g(r.throw(v))}catch(b){c(b)}}function g(v){v.done?o(v.value):n(v.value).then(d,h)}g((r=r.apply(s,e||[])).next())})};class Un{constructor(e,{headers:t={},customFetch:r,region:n=$r.Any}={}){this.url=e,this.headers=t,this.region=n,this.fetch=Pn(r)}setAuth(e){this.headers.Authorization=`Bearer ${e}`}invoke(e,t={}){var r;return In(this,void 0,void 0,function*(){try{const{headers:n,method:o,body:c}=t;let d={},{region:h}=t;h||(h=this.region),h&&h!=="any"&&(d["x-region"]=h);let g;c&&(n&&!Object.prototype.hasOwnProperty.call(n,"Content-Type")||!n)&&(typeof Blob<"u"&&c instanceof Blob||c instanceof ArrayBuffer?(d["Content-Type"]="application/octet-stream",g=c):typeof c=="string"?(d["Content-Type"]="text/plain",g=c):typeof FormData<"u"&&c instanceof FormData?g=c:(d["Content-Type"]="application/json",g=JSON.stringify(c)));const v=yield this.fetch(`${this.url}/${e}`,{method:o||"POST",headers:Object.assign(Object.assign(Object.assign({},d),this.headers),n),body:g}).catch(I=>{throw new jn(I)}),b=v.headers.get("x-relay-error");if(b&&b==="true")throw new Rn(v);if(!v.ok)throw new $n(v);let T=((r=v.headers.get("Content-Type"))!==null&&r!==void 0?r:"text/plain").split(";")[0].trim(),O;return T==="application/json"?O=yield v.json():T==="application/octet-stream"?O=yield v.blob():T==="text/event-stream"?O=v:T==="multipart/form-data"?O=yield v.formData():O=yield v.text(),{data:O,error:null}}catch(n){return{data:null,error:n}}})}}var ke={},ot={},at={},ct={},lt={},ft={},Ln=function(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("unable to locate global object")},mt=Ln();const Cn=mt.fetch,zs=mt.fetch.bind(mt),Ks=mt.Headers,Bn=mt.Request,Mn=mt.Response,_t=Object.freeze(Object.defineProperty({__proto__:null,Headers:Ks,Request:Bn,Response:Mn,default:zs,fetch:Cn},Symbol.toStringTag,{value:"Module"})),Dn=Ws(_t);var Vt={},ys;function Hs(){if(ys)return Vt;ys=1,Object.defineProperty(Vt,"__esModule",{value:!0});class s extends Error{constructor(t){super(t.message),this.name="PostgrestError",this.details=t.details,this.hint=t.hint,this.code=t.code}}return Vt.default=s,Vt}var ms;function Js(){if(ms)return ft;ms=1;var s=ft&&ft.__importDefault||function(n){return n&&n.__esModule?n:{default:n}};Object.defineProperty(ft,"__esModule",{value:!0});const e=s(Dn),t=s(Hs());class r{constructor(o){this.shouldThrowOnError=!1,this.method=o.method,this.url=o.url,this.headers=o.headers,this.schema=o.schema,this.body=o.body,this.shouldThrowOnError=o.shouldThrowOnError,this.signal=o.signal,this.isMaybeSingle=o.isMaybeSingle,o.fetch?this.fetch=o.fetch:typeof fetch>"u"?this.fetch=e.default:this.fetch=fetch}throwOnError(){return this.shouldThrowOnError=!0,this}setHeader(o,c){return this.headers=Object.assign({},this.headers),this.headers[o]=c,this}then(o,c){this.schema===void 0||(["GET","HEAD"].includes(this.method)?this.headers["Accept-Profile"]=this.schema:this.headers["Content-Profile"]=this.schema),this.method!=="GET"&&this.method!=="HEAD"&&(this.headers["Content-Type"]="application/json");const d=this.fetch;let h=d(this.url.toString(),{method:this.method,headers:this.headers,body:JSON.stringify(this.body),signal:this.signal}).then(async g=>{var v,b,T;let O=null,I=null,W=null,D=g.status,ue=g.statusText;if(g.ok){if(this.method!=="HEAD"){const ve=await g.text();ve===""||(this.headers.Accept==="text/csv"||this.headers.Accept&&this.headers.Accept.includes("application/vnd.pgrst.plan+text")?I=ve:I=JSON.parse(ve))}const N=(v=this.headers.Prefer)===null||v===void 0?void 0:v.match(/count=(exact|planned|estimated)/),se=(b=g.headers.get("content-range"))===null||b===void 0?void 0:b.split("/");N&&se&&se.length>1&&(W=parseInt(se[1])),this.isMaybeSingle&&this.method==="GET"&&Array.isArray(I)&&(I.length>1?(O={code:"PGRST116",details:`Results contain ${I.length} rows, application/vnd.pgrst.object+json requires 1 row`,hint:null,message:"JSON object requested, multiple (or no) rows returned"},I=null,W=null,D=406,ue="Not Acceptable"):I.length===1?I=I[0]:I=null)}else{const N=await g.text();try{O=JSON.parse(N),Array.isArray(O)&&g.status===404&&(I=[],O=null,D=200,ue="OK")}catch{g.status===404&&N===""?(D=204,ue="No Content"):O={message:N}}if(O&&this.isMaybeSingle&&(!((T=O?.details)===null||T===void 0)&&T.includes("0 rows"))&&(O=null,D=200,ue="OK"),O&&this.shouldThrowOnError)throw new t.default(O)}return{error:O,data:I,count:W,status:D,statusText:ue}});return this.shouldThrowOnError||(h=h.catch(g=>{var v,b,T;return{error:{message:`${(v=g?.name)!==null&&v!==void 0?v:"FetchError"}: ${g?.message}`,details:`${(b=g?.stack)!==null&&b!==void 0?b:""}`,hint:"",code:`${(T=g?.code)!==null&&T!==void 0?T:""}`},data:null,count:null,status:0,statusText:""}})),h.then(o,c)}returns(){return this}overrideTypes(){return this}}return ft.default=r,ft}var _s;function Gs(){if(_s)return lt;_s=1;var s=lt&&lt.__importDefault||function(r){return r&&r.__esModule?r:{default:r}};Object.defineProperty(lt,"__esModule",{value:!0});const e=s(Js());class t extends e.default{select(n){let o=!1;const c=(n??"*").split("").map(d=>/\s/.test(d)&&!o?"":(d==='"'&&(o=!o),d)).join("");return this.url.searchParams.set("select",c),this.headers.Prefer&&(this.headers.Prefer+=","),this.headers.Prefer+="return=representation",this}order(n,{ascending:o=!0,nullsFirst:c,foreignTable:d,referencedTable:h=d}={}){const g=h?`${h}.order`:"order",v=this.url.searchParams.get(g);return this.url.searchParams.set(g,`${v?`${v},`:""}${n}.${o?"asc":"desc"}${c===void 0?"":c?".nullsfirst":".nullslast"}`),this}limit(n,{foreignTable:o,referencedTable:c=o}={}){const d=typeof c>"u"?"limit":`${c}.limit`;return this.url.searchParams.set(d,`${n}`),this}range(n,o,{foreignTable:c,referencedTable:d=c}={}){const h=typeof d>"u"?"offset":`${d}.offset`,g=typeof d>"u"?"limit":`${d}.limit`;return this.url.searchParams.set(h,`${n}`),this.url.searchParams.set(g,`${o-n+1}`),this}abortSignal(n){return this.signal=n,this}single(){return this.headers.Accept="application/vnd.pgrst.object+json",this}maybeSingle(){return this.method==="GET"?this.headers.Accept="application/json":this.headers.Accept="application/vnd.pgrst.object+json",this.isMaybeSingle=!0,this}csv(){return this.headers.Accept="text/csv",this}geojson(){return this.headers.Accept="application/geo+json",this}explain({analyze:n=!1,verbose:o=!1,settings:c=!1,buffers:d=!1,wal:h=!1,format:g="text"}={}){var v;const b=[n?"analyze":null,o?"verbose":null,c?"settings":null,d?"buffers":null,h?"wal":null].filter(Boolean).join("|"),T=(v=this.headers.Accept)!==null&&v!==void 0?v:"application/json";return this.headers.Accept=`application/vnd.pgrst.plan+${g}; for="${T}"; options=${b};`,g==="json"?this:this}rollback(){var n;return((n=this.headers.Prefer)!==null&&n!==void 0?n:"").trim().length>0?this.headers.Prefer+=",tx=rollback":this.headers.Prefer="tx=rollback",this}returns(){return this}}return lt.default=t,lt}var ws;function zr(){if(ws)return ct;ws=1;var s=ct&&ct.__importDefault||function(r){return r&&r.__esModule?r:{default:r}};Object.defineProperty(ct,"__esModule",{value:!0});const e=s(Gs());class t extends e.default{eq(n,o){return this.url.searchParams.append(n,`eq.${o}`),this}neq(n,o){return this.url.searchParams.append(n,`neq.${o}`),this}gt(n,o){return this.url.searchParams.append(n,`gt.${o}`),this}gte(n,o){return this.url.searchParams.append(n,`gte.${o}`),this}lt(n,o){return this.url.searchParams.append(n,`lt.${o}`),this}lte(n,o){return this.url.searchParams.append(n,`lte.${o}`),this}like(n,o){return this.url.searchParams.append(n,`like.${o}`),this}likeAllOf(n,o){return this.url.searchParams.append(n,`like(all).{${o.join(",")}}`),this}likeAnyOf(n,o){return this.url.searchParams.append(n,`like(any).{${o.join(",")}}`),this}ilike(n,o){return this.url.searchParams.append(n,`ilike.${o}`),this}ilikeAllOf(n,o){return this.url.searchParams.append(n,`ilike(all).{${o.join(",")}}`),this}ilikeAnyOf(n,o){return this.url.searchParams.append(n,`ilike(any).{${o.join(",")}}`),this}is(n,o){return this.url.searchParams.append(n,`is.${o}`),this}in(n,o){const c=Array.from(new Set(o)).map(d=>typeof d=="string"&&new RegExp("[,()]").test(d)?`"${d}"`:`${d}`).join(",");return this.url.searchParams.append(n,`in.(${c})`),this}contains(n,o){return typeof o=="string"?this.url.searchParams.append(n,`cs.${o}`):Array.isArray(o)?this.url.searchParams.append(n,`cs.{${o.join(",")}}`):this.url.searchParams.append(n,`cs.${JSON.stringify(o)}`),this}containedBy(n,o){return typeof o=="string"?this.url.searchParams.append(n,`cd.${o}`):Array.isArray(o)?this.url.searchParams.append(n,`cd.{${o.join(",")}}`):this.url.searchParams.append(n,`cd.${JSON.stringify(o)}`),this}rangeGt(n,o){return this.url.searchParams.append(n,`sr.${o}`),this}rangeGte(n,o){return this.url.searchParams.append(n,`nxl.${o}`),this}rangeLt(n,o){return this.url.searchParams.append(n,`sl.${o}`),this}rangeLte(n,o){return this.url.searchParams.append(n,`nxr.${o}`),this}rangeAdjacent(n,o){return this.url.searchParams.append(n,`adj.${o}`),this}overlaps(n,o){return typeof o=="string"?this.url.searchParams.append(n,`ov.${o}`):this.url.searchParams.append(n,`ov.{${o.join(",")}}`),this}textSearch(n,o,{config:c,type:d}={}){let h="";d==="plain"?h="pl":d==="phrase"?h="ph":d==="websearch"&&(h="w");const g=c===void 0?"":`(${c})`;return this.url.searchParams.append(n,`${h}fts${g}.${o}`),this}match(n){return Object.entries(n).forEach(([o,c])=>{this.url.searchParams.append(o,`eq.${c}`)}),this}not(n,o,c){return this.url.searchParams.append(n,`not.${o}.${c}`),this}or(n,{foreignTable:o,referencedTable:c=o}={}){const d=c?`${c}.or`:"or";return this.url.searchParams.append(d,`(${n})`),this}filter(n,o,c){return this.url.searchParams.append(n,`${o}.${c}`),this}}return ct.default=t,ct}var bs;function Ys(){if(bs)return at;bs=1;var s=at&&at.__importDefault||function(r){return r&&r.__esModule?r:{default:r}};Object.defineProperty(at,"__esModule",{value:!0});const e=s(zr());class t{constructor(n,{headers:o={},schema:c,fetch:d}){this.url=n,this.headers=o,this.schema=c,this.fetch=d}select(n,{head:o=!1,count:c}={}){const d=o?"HEAD":"GET";let h=!1;const g=(n??"*").split("").map(v=>/\s/.test(v)&&!h?"":(v==='"'&&(h=!h),v)).join("");return this.url.searchParams.set("select",g),c&&(this.headers.Prefer=`count=${c}`),new e.default({method:d,url:this.url,headers:this.headers,schema:this.schema,fetch:this.fetch,allowEmpty:!1})}insert(n,{count:o,defaultToNull:c=!0}={}){const d="POST",h=[];if(this.headers.Prefer&&h.push(this.headers.Prefer),o&&h.push(`count=${o}`),c||h.push("missing=default"),this.headers.Prefer=h.join(","),Array.isArray(n)){const g=n.reduce((v,b)=>v.concat(Object.keys(b)),[]);if(g.length>0){const v=[...new Set(g)].map(b=>`"${b}"`);this.url.searchParams.set("columns",v.join(","))}}return new e.default({method:d,url:this.url,headers:this.headers,schema:this.schema,body:n,fetch:this.fetch,allowEmpty:!1})}upsert(n,{onConflict:o,ignoreDuplicates:c=!1,count:d,defaultToNull:h=!0}={}){const g="POST",v=[`resolution=${c?"ignore":"merge"}-duplicates`];if(o!==void 0&&this.url.searchParams.set("on_conflict",o),this.headers.Prefer&&v.push(this.headers.Prefer),d&&v.push(`count=${d}`),h||v.push("missing=default"),this.headers.Prefer=v.join(","),Array.isArray(n)){const b=n.reduce((T,O)=>T.concat(Object.keys(O)),[]);if(b.length>0){const T=[...new Set(b)].map(O=>`"${O}"`);this.url.searchParams.set("columns",T.join(","))}}return new e.default({method:g,url:this.url,headers:this.headers,schema:this.schema,body:n,fetch:this.fetch,allowEmpty:!1})}update(n,{count:o}={}){const c="PATCH",d=[];return this.headers.Prefer&&d.push(this.headers.Prefer),o&&d.push(`count=${o}`),this.headers.Prefer=d.join(","),new e.default({method:c,url:this.url,headers:this.headers,schema:this.schema,body:n,fetch:this.fetch,allowEmpty:!1})}delete({count:n}={}){const o="DELETE",c=[];return n&&c.push(`count=${n}`),this.headers.Prefer&&c.unshift(this.headers.Prefer),this.headers.Prefer=c.join(","),new e.default({method:o,url:this.url,headers:this.headers,schema:this.schema,fetch:this.fetch,allowEmpty:!1})}}return at.default=t,at}var St={},kt={},xs;function qn(){return xs||(xs=1,Object.defineProperty(kt,"__esModule",{value:!0}),kt.version=void 0,kt.version="0.0.0-automated"),kt}var Es;function Nn(){if(Es)return St;Es=1,Object.defineProperty(St,"__esModule",{value:!0}),St.DEFAULT_HEADERS=void 0;const s=qn();return St.DEFAULT_HEADERS={"X-Client-Info":`postgrest-js/${s.version}`},St}var Ss;function Fn(){if(Ss)return ot;Ss=1;var s=ot&&ot.__importDefault||function(o){return o&&o.__esModule?o:{default:o}};Object.defineProperty(ot,"__esModule",{value:!0});const e=s(Ys()),t=s(zr()),r=Nn();class n{constructor(c,{headers:d={},schema:h,fetch:g}={}){this.url=c,this.headers=Object.assign(Object.assign({},r.DEFAULT_HEADERS),d),this.schemaName=h,this.fetch=g}from(c){const d=new URL(`${this.url}/${c}`);return new e.default(d,{headers:Object.assign({},this.headers),schema:this.schemaName,fetch:this.fetch})}schema(c){return new n(this.url,{headers:this.headers,schema:c,fetch:this.fetch})}rpc(c,d={},{head:h=!1,get:g=!1,count:v}={}){let b;const T=new URL(`${this.url}/rpc/${c}`);let O;h||g?(b=h?"HEAD":"GET",Object.entries(d).filter(([W,D])=>D!==void 0).map(([W,D])=>[W,Array.isArray(D)?`{${D.join(",")}}`:`${D}`]).forEach(([W,D])=>{T.searchParams.append(W,D)})):(b="POST",O=d);const I=Object.assign({},this.headers);return v&&(I.Prefer=`count=${v}`),new t.default({method:b,url:T,headers:I,schema:this.schemaName,body:O,fetch:this.fetch,allowEmpty:!1})}}return ot.default=n,ot}var ks;function Wn(){if(ks)return ke;ks=1;var s=ke&&ke.__importDefault||function(d){return d&&d.__esModule?d:{default:d}};Object.defineProperty(ke,"__esModule",{value:!0}),ke.PostgrestError=ke.PostgrestBuilder=ke.PostgrestTransformBuilder=ke.PostgrestFilterBuilder=ke.PostgrestQueryBuilder=ke.PostgrestClient=void 0;const e=s(Fn());ke.PostgrestClient=e.default;const t=s(Ys());ke.PostgrestQueryBuilder=t.default;const r=s(zr());ke.PostgrestFilterBuilder=r.default;const n=s(Gs());ke.PostgrestTransformBuilder=n.default;const o=s(Js());ke.PostgrestBuilder=o.default;const c=s(Hs());return ke.PostgrestError=c.default,ke.default={PostgrestClient:e.default,PostgrestQueryBuilder:t.default,PostgrestFilterBuilder:r.default,PostgrestTransformBuilder:n.default,PostgrestBuilder:o.default,PostgrestError:c.default},ke}var zn=Wn();const Kn=_n(zn),{PostgrestClient:Hn,PostgrestQueryBuilder:aa,PostgrestFilterBuilder:ca,PostgrestTransformBuilder:la,PostgrestBuilder:fa,PostgrestError:ua}=Kn;function Jn(){if(typeof WebSocket<"u")return WebSocket;if(typeof global.WebSocket<"u")return global.WebSocket;if(typeof window.WebSocket<"u")return window.WebSocket;if(typeof self.WebSocket<"u")return self.WebSocket;throw new Error("`WebSocket` is not supported in this environment")}const Gn=Jn(),Yn="2.11.15",Vn=`realtime-js/${Yn}`,Qn="1.0.0",Vs=1e4,Xn=1e3;var At;(function(s){s[s.connecting=0]="connecting",s[s.open=1]="open",s[s.closing=2]="closing",s[s.closed=3]="closed"})(At||(At={}));var $e;(function(s){s.closed="closed",s.errored="errored",s.joined="joined",s.joining="joining",s.leaving="leaving"})($e||($e={}));var De;(function(s){s.close="phx_close",s.error="phx_error",s.join="phx_join",s.reply="phx_reply",s.leave="phx_leave",s.access_token="access_token"})(De||(De={}));var Ir;(function(s){s.websocket="websocket"})(Ir||(Ir={}));var et;(function(s){s.Connecting="connecting",s.Open="open",s.Closing="closing",s.Closed="closed"})(et||(et={}));class Zn{constructor(){this.HEADER_LENGTH=1}decode(e,t){return e.constructor===ArrayBuffer?t(this._binaryDecode(e)):t(typeof e=="string"?JSON.parse(e):{})}_binaryDecode(e){const t=new DataView(e),r=new TextDecoder;return this._decodeBroadcast(e,t,r)}_decodeBroadcast(e,t,r){const n=t.getUint8(1),o=t.getUint8(2);let c=this.HEADER_LENGTH+2;const d=r.decode(e.slice(c,c+n));c=c+n;const h=r.decode(e.slice(c,c+o));c=c+o;const g=JSON.parse(r.decode(e.slice(c,e.byteLength)));return{ref:null,topic:d,event:h,payload:g}}}class Qs{constructor(e,t){this.callback=e,this.timerCalc=t,this.timer=void 0,this.tries=0,this.callback=e,this.timerCalc=t}reset(){this.tries=0,clearTimeout(this.timer)}scheduleTimeout(){clearTimeout(this.timer),this.timer=setTimeout(()=>{this.tries=this.tries+1,this.callback()},this.timerCalc(this.tries+1))}}var ye;(function(s){s.abstime="abstime",s.bool="bool",s.date="date",s.daterange="daterange",s.float4="float4",s.float8="float8",s.int2="int2",s.int4="int4",s.int4range="int4range",s.int8="int8",s.int8range="int8range",s.json="json",s.jsonb="jsonb",s.money="money",s.numeric="numeric",s.oid="oid",s.reltime="reltime",s.text="text",s.time="time",s.timestamp="timestamp",s.timestamptz="timestamptz",s.timetz="timetz",s.tsrange="tsrange",s.tstzrange="tstzrange"})(ye||(ye={}));const Ts=(s,e,t={})=>{var r;const n=(r=t.skipTypes)!==null&&r!==void 0?r:[];return Object.keys(e).reduce((o,c)=>(o[c]=ei(c,s,e,n),o),{})},ei=(s,e,t,r)=>{const n=e.find(d=>d.name===s),o=n?.type,c=t[s];return o&&!r.includes(o)?Xs(o,c):Ur(c)},Xs=(s,e)=>{if(s.charAt(0)==="_"){const t=s.slice(1,s.length);return ni(e,t)}switch(s){case ye.bool:return ti(e);case ye.float4:case ye.float8:case ye.int2:case ye.int4:case ye.int8:case ye.numeric:case ye.oid:return ri(e);case ye.json:case ye.jsonb:return si(e);case ye.timestamp:return ii(e);case ye.abstime:case ye.date:case ye.daterange:case ye.int4range:case ye.int8range:case ye.money:case ye.reltime:case ye.text:case ye.time:case ye.timestamptz:case ye.timetz:case ye.tsrange:case ye.tstzrange:return Ur(e);default:return Ur(e)}},Ur=s=>s,ti=s=>{switch(s){case"t":return!0;case"f":return!1;default:return s}},ri=s=>{if(typeof s=="string"){const e=parseFloat(s);if(!Number.isNaN(e))return e}return s},si=s=>{if(typeof s=="string")try{return JSON.parse(s)}catch(e){return console.log(`JSON parse error: ${e}`),s}return s},ni=(s,e)=>{if(typeof s!="string")return s;const t=s.length-1,r=s[t];if(s[0]==="{"&&r==="}"){let o;const c=s.slice(1,t);try{o=JSON.parse("["+c+"]")}catch{o=c?c.split(","):[]}return o.map(d=>Xs(e,d))}return s},ii=s=>typeof s=="string"?s.replace(" ","T"):s,Zs=s=>{let e=s;return e=e.replace(/^ws/i,"http"),e=e.replace(/(\/socket\/websocket|\/socket|\/websocket)\/?$/i,""),e.replace(/\/+$/,"")};class Sr{constructor(e,t,r={},n=Vs){this.channel=e,this.event=t,this.payload=r,this.timeout=n,this.sent=!1,this.timeoutTimer=void 0,this.ref="",this.receivedResp=null,this.recHooks=[],this.refEvent=null}resend(e){this.timeout=e,this._cancelRefEvent(),this.ref="",this.refEvent=null,this.receivedResp=null,this.sent=!1,this.send()}send(){this._hasReceived("timeout")||(this.startTimeout(),this.sent=!0,this.channel.socket.push({topic:this.channel.topic,event:this.event,payload:this.payload,ref:this.ref,join_ref:this.channel._joinRef()}))}updatePayload(e){this.payload=Object.assign(Object.assign({},this.payload),e)}receive(e,t){var r;return this._hasReceived(e)&&t((r=this.receivedResp)===null||r===void 0?void 0:r.response),this.recHooks.push({status:e,callback:t}),this}startTimeout(){if(this.timeoutTimer)return;this.ref=this.channel.socket._makeRef(),this.refEvent=this.channel._replyEventName(this.ref);const e=t=>{this._cancelRefEvent(),this._cancelTimeout(),this.receivedResp=t,this._matchReceive(t)};this.channel._on(this.refEvent,{},e),this.timeoutTimer=setTimeout(()=>{this.trigger("timeout",{})},this.timeout)}trigger(e,t){this.refEvent&&this.channel._trigger(this.refEvent,{status:e,response:t})}destroy(){this._cancelRefEvent(),this._cancelTimeout()}_cancelRefEvent(){this.refEvent&&this.channel._off(this.refEvent,{})}_cancelTimeout(){clearTimeout(this.timeoutTimer),this.timeoutTimer=void 0}_matchReceive({status:e,response:t}){this.recHooks.filter(r=>r.status===e).forEach(r=>r.callback(t))}_hasReceived(e){return this.receivedResp&&this.receivedResp.status===e}}var As;(function(s){s.SYNC="sync",s.JOIN="join",s.LEAVE="leave"})(As||(As={}));class Ot{constructor(e,t){this.channel=e,this.state={},this.pendingDiffs=[],this.joinRef=null,this.caller={onJoin:()=>{},onLeave:()=>{},onSync:()=>{}};const r=t?.events||{state:"presence_state",diff:"presence_diff"};this.channel._on(r.state,{},n=>{const{onJoin:o,onLeave:c,onSync:d}=this.caller;this.joinRef=this.channel._joinRef(),this.state=Ot.syncState(this.state,n,o,c),this.pendingDiffs.forEach(h=>{this.state=Ot.syncDiff(this.state,h,o,c)}),this.pendingDiffs=[],d()}),this.channel._on(r.diff,{},n=>{const{onJoin:o,onLeave:c,onSync:d}=this.caller;this.inPendingSyncState()?this.pendingDiffs.push(n):(this.state=Ot.syncDiff(this.state,n,o,c),d())}),this.onJoin((n,o,c)=>{this.channel._trigger("presence",{event:"join",key:n,currentPresences:o,newPresences:c})}),this.onLeave((n,o,c)=>{this.channel._trigger("presence",{event:"leave",key:n,currentPresences:o,leftPresences:c})}),this.onSync(()=>{this.channel._trigger("presence",{event:"sync"})})}static syncState(e,t,r,n){const o=this.cloneDeep(e),c=this.transformState(t),d={},h={};return this.map(o,(g,v)=>{c[g]||(h[g]=v)}),this.map(c,(g,v)=>{const b=o[g];if(b){const T=v.map(D=>D.presence_ref),O=b.map(D=>D.presence_ref),I=v.filter(D=>O.indexOf(D.presence_ref)<0),W=b.filter(D=>T.indexOf(D.presence_ref)<0);I.length>0&&(d[g]=I),W.length>0&&(h[g]=W)}else d[g]=v}),this.syncDiff(o,{joins:d,leaves:h},r,n)}static syncDiff(e,t,r,n){const{joins:o,leaves:c}={joins:this.transformState(t.joins),leaves:this.transformState(t.leaves)};return r||(r=()=>{}),n||(n=()=>{}),this.map(o,(d,h)=>{var g;const v=(g=e[d])!==null&&g!==void 0?g:[];if(e[d]=this.cloneDeep(h),v.length>0){const b=e[d].map(O=>O.presence_ref),T=v.filter(O=>b.indexOf(O.presence_ref)<0);e[d].unshift(...T)}r(d,v,h)}),this.map(c,(d,h)=>{let g=e[d];if(!g)return;const v=h.map(b=>b.presence_ref);g=g.filter(b=>v.indexOf(b.presence_ref)<0),e[d]=g,n(d,g,h),g.length===0&&delete e[d]}),e}static map(e,t){return Object.getOwnPropertyNames(e).map(r=>t(r,e[r]))}static transformState(e){return e=this.cloneDeep(e),Object.getOwnPropertyNames(e).reduce((t,r)=>{const n=e[r];return"metas"in n?t[r]=n.metas.map(o=>(o.presence_ref=o.phx_ref,delete o.phx_ref,delete o.phx_ref_prev,o)):t[r]=n,t},{})}static cloneDeep(e){return JSON.parse(JSON.stringify(e))}onJoin(e){this.caller.onJoin=e}onLeave(e){this.caller.onLeave=e}onSync(e){this.caller.onSync=e}inPendingSyncState(){return!this.joinRef||this.joinRef!==this.channel._joinRef()}}var Os;(function(s){s.ALL="*",s.INSERT="INSERT",s.UPDATE="UPDATE",s.DELETE="DELETE"})(Os||(Os={}));var Ps;(function(s){s.BROADCAST="broadcast",s.PRESENCE="presence",s.POSTGRES_CHANGES="postgres_changes",s.SYSTEM="system"})(Ps||(Ps={}));var ze;(function(s){s.SUBSCRIBED="SUBSCRIBED",s.TIMED_OUT="TIMED_OUT",s.CLOSED="CLOSED",s.CHANNEL_ERROR="CHANNEL_ERROR"})(ze||(ze={}));class Kr{constructor(e,t={config:{}},r){this.topic=e,this.params=t,this.socket=r,this.bindings={},this.state=$e.closed,this.joinedOnce=!1,this.pushBuffer=[],this.subTopic=e.replace(/^realtime:/i,""),this.params.config=Object.assign({broadcast:{ack:!1,self:!1},presence:{key:""},private:!1},t.config),this.timeout=this.socket.timeout,this.joinPush=new Sr(this,De.join,this.params,this.timeout),this.rejoinTimer=new Qs(()=>this._rejoinUntilConnected(),this.socket.reconnectAfterMs),this.joinPush.receive("ok",()=>{this.state=$e.joined,this.rejoinTimer.reset(),this.pushBuffer.forEach(n=>n.send()),this.pushBuffer=[]}),this._onClose(()=>{this.rejoinTimer.reset(),this.socket.log("channel",`close ${this.topic} ${this._joinRef()}`),this.state=$e.closed,this.socket._remove(this)}),this._onError(n=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,n),this.state=$e.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("timeout",()=>{this._isJoining()&&(this.socket.log("channel",`timeout ${this.topic}`,this.joinPush.timeout),this.state=$e.errored,this.rejoinTimer.scheduleTimeout())}),this._on(De.reply,{},(n,o)=>{this._trigger(this._replyEventName(o),n)}),this.presence=new Ot(this),this.broadcastEndpointURL=Zs(this.socket.endPoint)+"/api/broadcast",this.private=this.params.config.private||!1}subscribe(e,t=this.timeout){var r,n;if(this.socket.isConnected()||this.socket.connect(),this.state==$e.closed){const{config:{broadcast:o,presence:c,private:d}}=this.params;this._onError(v=>e?.(ze.CHANNEL_ERROR,v)),this._onClose(()=>e?.(ze.CLOSED));const h={},g={broadcast:o,presence:c,postgres_changes:(n=(r=this.bindings.postgres_changes)===null||r===void 0?void 0:r.map(v=>v.filter))!==null&&n!==void 0?n:[],private:d};this.socket.accessTokenValue&&(h.access_token=this.socket.accessTokenValue),this.updateJoinPayload(Object.assign({config:g},h)),this.joinedOnce=!0,this._rejoin(t),this.joinPush.receive("ok",async({postgres_changes:v})=>{var b;if(this.socket.setAuth(),v===void 0){e?.(ze.SUBSCRIBED);return}else{const T=this.bindings.postgres_changes,O=(b=T?.length)!==null&&b!==void 0?b:0,I=[];for(let W=0;W<O;W++){const D=T[W],{filter:{event:ue,schema:_e,table:N,filter:se}}=D,ve=v&&v[W];if(ve&&ve.event===ue&&ve.schema===_e&&ve.table===N&&ve.filter===se)I.push(Object.assign(Object.assign({},D),{id:ve.id}));else{this.unsubscribe(),this.state=$e.errored,e?.(ze.CHANNEL_ERROR,new Error("mismatch between server and client bindings for postgres changes"));return}}this.bindings.postgres_changes=I,e&&e(ze.SUBSCRIBED);return}}).receive("error",v=>{this.state=$e.errored,e?.(ze.CHANNEL_ERROR,new Error(JSON.stringify(Object.values(v).join(", ")||"error")))}).receive("timeout",()=>{e?.(ze.TIMED_OUT)})}return this}presenceState(){return this.presence.state}async track(e,t={}){return await this.send({type:"presence",event:"track",payload:e},t.timeout||this.timeout)}async untrack(e={}){return await this.send({type:"presence",event:"untrack"},e)}on(e,t,r){return this._on(e,t,r)}async send(e,t={}){var r,n;if(!this._canPush()&&e.type==="broadcast"){const{event:o,payload:c}=e,h={method:"POST",headers:{Authorization:this.socket.accessTokenValue?`Bearer ${this.socket.accessTokenValue}`:"",apikey:this.socket.apiKey?this.socket.apiKey:"","Content-Type":"application/json"},body:JSON.stringify({messages:[{topic:this.subTopic,event:o,payload:c,private:this.private}]})};try{const g=await this._fetchWithTimeout(this.broadcastEndpointURL,h,(r=t.timeout)!==null&&r!==void 0?r:this.timeout);return await((n=g.body)===null||n===void 0?void 0:n.cancel()),g.ok?"ok":"error"}catch(g){return g.name==="AbortError"?"timed out":"error"}}else return new Promise(o=>{var c,d,h;const g=this._push(e.type,e,t.timeout||this.timeout);e.type==="broadcast"&&!(!((h=(d=(c=this.params)===null||c===void 0?void 0:c.config)===null||d===void 0?void 0:d.broadcast)===null||h===void 0)&&h.ack)&&o("ok"),g.receive("ok",()=>o("ok")),g.receive("error",()=>o("error")),g.receive("timeout",()=>o("timed out"))})}updateJoinPayload(e){this.joinPush.updatePayload(e)}unsubscribe(e=this.timeout){this.state=$e.leaving;const t=()=>{this.socket.log("channel",`leave ${this.topic}`),this._trigger(De.close,"leave",this._joinRef())};this.joinPush.destroy();let r=null;return new Promise(n=>{r=new Sr(this,De.leave,{},e),r.receive("ok",()=>{t(),n("ok")}).receive("timeout",()=>{t(),n("timed out")}).receive("error",()=>{n("error")}),r.send(),this._canPush()||r.trigger("ok",{})}).finally(()=>{r?.destroy()})}teardown(){this.pushBuffer.forEach(e=>e.destroy()),this.rejoinTimer&&clearTimeout(this.rejoinTimer.timer),this.joinPush.destroy()}async _fetchWithTimeout(e,t,r){const n=new AbortController,o=setTimeout(()=>n.abort(),r),c=await this.socket.fetch(e,Object.assign(Object.assign({},t),{signal:n.signal}));return clearTimeout(o),c}_push(e,t,r=this.timeout){if(!this.joinedOnce)throw`tried to push '${e}' to '${this.topic}' before joining. Use channel.subscribe() before pushing events`;let n=new Sr(this,e,t,r);return this._canPush()?n.send():(n.startTimeout(),this.pushBuffer.push(n)),n}_onMessage(e,t,r){return t}_isMember(e){return this.topic===e}_joinRef(){return this.joinPush.ref}_trigger(e,t,r){var n,o;const c=e.toLocaleLowerCase(),{close:d,error:h,leave:g,join:v}=De;if(r&&[d,h,g,v].indexOf(c)>=0&&r!==this._joinRef())return;let T=this._onMessage(c,t,r);if(t&&!T)throw"channel onMessage callbacks must return the payload, modified or unmodified";["insert","update","delete"].includes(c)?(n=this.bindings.postgres_changes)===null||n===void 0||n.filter(O=>{var I,W,D;return((I=O.filter)===null||I===void 0?void 0:I.event)==="*"||((D=(W=O.filter)===null||W===void 0?void 0:W.event)===null||D===void 0?void 0:D.toLocaleLowerCase())===c}).map(O=>O.callback(T,r)):(o=this.bindings[c])===null||o===void 0||o.filter(O=>{var I,W,D,ue,_e,N;if(["broadcast","presence","postgres_changes"].includes(c))if("id"in O){const se=O.id,ve=(I=O.filter)===null||I===void 0?void 0:I.event;return se&&((W=t.ids)===null||W===void 0?void 0:W.includes(se))&&(ve==="*"||ve?.toLocaleLowerCase()===((D=t.data)===null||D===void 0?void 0:D.type.toLocaleLowerCase()))}else{const se=(_e=(ue=O?.filter)===null||ue===void 0?void 0:ue.event)===null||_e===void 0?void 0:_e.toLocaleLowerCase();return se==="*"||se===((N=t?.event)===null||N===void 0?void 0:N.toLocaleLowerCase())}else return O.type.toLocaleLowerCase()===c}).map(O=>{if(typeof T=="object"&&"ids"in T){const I=T.data,{schema:W,table:D,commit_timestamp:ue,type:_e,errors:N}=I;T=Object.assign(Object.assign({},{schema:W,table:D,commit_timestamp:ue,eventType:_e,new:{},old:{},errors:N}),this._getPayloadRecords(I))}O.callback(T,r)})}_isClosed(){return this.state===$e.closed}_isJoined(){return this.state===$e.joined}_isJoining(){return this.state===$e.joining}_isLeaving(){return this.state===$e.leaving}_replyEventName(e){return`chan_reply_${e}`}_on(e,t,r){const n=e.toLocaleLowerCase(),o={type:n,filter:t,callback:r};return this.bindings[n]?this.bindings[n].push(o):this.bindings[n]=[o],this}_off(e,t){const r=e.toLocaleLowerCase();return this.bindings[r]=this.bindings[r].filter(n=>{var o;return!(((o=n.type)===null||o===void 0?void 0:o.toLocaleLowerCase())===r&&Kr.isEqual(n.filter,t))}),this}static isEqual(e,t){if(Object.keys(e).length!==Object.keys(t).length)return!1;for(const r in e)if(e[r]!==t[r])return!1;return!0}_rejoinUntilConnected(){this.rejoinTimer.scheduleTimeout(),this.socket.isConnected()&&this._rejoin()}_onClose(e){this._on(De.close,{},e)}_onError(e){this._on(De.error,{},t=>e(t))}_canPush(){return this.socket.isConnected()&&this._isJoined()}_rejoin(e=this.timeout){this._isLeaving()||(this.socket._leaveOpenTopic(this.topic),this.state=$e.joining,this.joinPush.resend(e))}_getPayloadRecords(e){const t={new:{},old:{}};return(e.type==="INSERT"||e.type==="UPDATE")&&(t.new=Ts(e.columns,e.record)),(e.type==="UPDATE"||e.type==="DELETE")&&(t.old=Ts(e.columns,e.old_record)),t}}const js=()=>{},oi=`
  addEventListener("message", (e) => {
    if (e.data.event === "start") {
      setInterval(() => postMessage({ event: "keepAlive" }), e.data.interval);
    }
  });`;class ai{constructor(e,t){var r;this.accessTokenValue=null,this.apiKey=null,this.channels=new Array,this.endPoint="",this.httpEndpoint="",this.headers={},this.params={},this.timeout=Vs,this.heartbeatIntervalMs=25e3,this.heartbeatTimer=void 0,this.pendingHeartbeatRef=null,this.heartbeatCallback=js,this.ref=0,this.logger=js,this.conn=null,this.sendBuffer=[],this.serializer=new Zn,this.stateChangeCallbacks={open:[],close:[],error:[],message:[]},this.accessToken=null,this._resolveFetch=o=>{let c;return o?c=o:typeof fetch>"u"?c=(...d)=>Dt(async()=>{const{default:h}=await Promise.resolve().then(()=>_t);return{default:h}},void 0).then(({default:h})=>h(...d)):c=fetch,(...d)=>c(...d)},this.endPoint=`${e}/${Ir.websocket}`,this.httpEndpoint=Zs(e),t?.transport?this.transport=t.transport:this.transport=null,t?.params&&(this.params=t.params),t?.timeout&&(this.timeout=t.timeout),t?.logger&&(this.logger=t.logger),(t?.logLevel||t?.log_level)&&(this.logLevel=t.logLevel||t.log_level,this.params=Object.assign(Object.assign({},this.params),{log_level:this.logLevel})),t?.heartbeatIntervalMs&&(this.heartbeatIntervalMs=t.heartbeatIntervalMs);const n=(r=t?.params)===null||r===void 0?void 0:r.apikey;if(n&&(this.accessTokenValue=n,this.apiKey=n),this.reconnectAfterMs=t?.reconnectAfterMs?t.reconnectAfterMs:o=>[1e3,2e3,5e3,1e4][o-1]||1e4,this.encode=t?.encode?t.encode:(o,c)=>c(JSON.stringify(o)),this.decode=t?.decode?t.decode:this.serializer.decode.bind(this.serializer),this.reconnectTimer=new Qs(async()=>{this.disconnect(),this.connect()},this.reconnectAfterMs),this.fetch=this._resolveFetch(t?.fetch),t?.worker){if(typeof window<"u"&&!window.Worker)throw new Error("Web Worker is not supported");this.worker=t?.worker||!1,this.workerUrl=t?.workerUrl}this.accessToken=t?.accessToken||null}connect(){if(!this.conn){if(this.transport||(this.transport=Gn),!this.transport)throw new Error("No transport provided");this.conn=new this.transport(this.endpointURL()),this.setupConnection()}}endpointURL(){return this._appendParams(this.endPoint,Object.assign({},this.params,{vsn:Qn}))}disconnect(e,t){this.conn&&(this.conn.onclose=function(){},e?this.conn.close(e,t??""):this.conn.close(),this.conn=null,this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.reconnectTimer.reset(),this.channels.forEach(r=>r.teardown()))}getChannels(){return this.channels}async removeChannel(e){const t=await e.unsubscribe();return this.channels.length===0&&this.disconnect(),t}async removeAllChannels(){const e=await Promise.all(this.channels.map(t=>t.unsubscribe()));return this.channels=[],this.disconnect(),e}log(e,t,r){this.logger(e,t,r)}connectionState(){switch(this.conn&&this.conn.readyState){case At.connecting:return et.Connecting;case At.open:return et.Open;case At.closing:return et.Closing;default:return et.Closed}}isConnected(){return this.connectionState()===et.Open}channel(e,t={config:{}}){const r=`realtime:${e}`,n=this.getChannels().find(o=>o.topic===r);if(n)return n;{const o=new Kr(`realtime:${e}`,t,this);return this.channels.push(o),o}}push(e){const{topic:t,event:r,payload:n,ref:o}=e,c=()=>{this.encode(e,d=>{var h;(h=this.conn)===null||h===void 0||h.send(d)})};this.log("push",`${t} ${r} (${o})`,n),this.isConnected()?c():this.sendBuffer.push(c)}async setAuth(e=null){let t=e||this.accessToken&&await this.accessToken()||this.accessTokenValue;this.accessTokenValue!=t&&(this.accessTokenValue=t,this.channels.forEach(r=>{const n={access_token:t,version:Vn};t&&r.updateJoinPayload(n),r.joinedOnce&&r._isJoined()&&r._push(De.access_token,{access_token:t})}))}async sendHeartbeat(){var e;if(!this.isConnected()){this.heartbeatCallback("disconnected");return}if(this.pendingHeartbeatRef){this.pendingHeartbeatRef=null,this.log("transport","heartbeat timeout. Attempting to re-establish connection"),this.heartbeatCallback("timeout"),(e=this.conn)===null||e===void 0||e.close(Xn,"hearbeat timeout");return}this.pendingHeartbeatRef=this._makeRef(),this.push({topic:"phoenix",event:"heartbeat",payload:{},ref:this.pendingHeartbeatRef}),this.heartbeatCallback("sent"),await this.setAuth()}onHeartbeat(e){this.heartbeatCallback=e}flushSendBuffer(){this.isConnected()&&this.sendBuffer.length>0&&(this.sendBuffer.forEach(e=>e()),this.sendBuffer=[])}_makeRef(){let e=this.ref+1;return e===this.ref?this.ref=0:this.ref=e,this.ref.toString()}_leaveOpenTopic(e){let t=this.channels.find(r=>r.topic===e&&(r._isJoined()||r._isJoining()));t&&(this.log("transport",`leaving duplicate topic "${e}"`),t.unsubscribe())}_remove(e){this.channels=this.channels.filter(t=>t.topic!==e.topic)}setupConnection(){this.conn&&(this.conn.binaryType="arraybuffer",this.conn.onopen=()=>this._onConnOpen(),this.conn.onerror=e=>this._onConnError(e),this.conn.onmessage=e=>this._onConnMessage(e),this.conn.onclose=e=>this._onConnClose(e))}_onConnMessage(e){this.decode(e.data,t=>{let{topic:r,event:n,payload:o,ref:c}=t;r==="phoenix"&&n==="phx_reply"&&this.heartbeatCallback(t.payload.status=="ok"?"ok":"error"),c&&c===this.pendingHeartbeatRef&&(this.pendingHeartbeatRef=null),this.log("receive",`${o.status||""} ${r} ${n} ${c&&"("+c+")"||""}`,o),Array.from(this.channels).filter(d=>d._isMember(r)).forEach(d=>d._trigger(n,o,c)),this.stateChangeCallbacks.message.forEach(d=>d(t))})}_onConnOpen(){this.log("transport",`connected to ${this.endpointURL()}`),this.flushSendBuffer(),this.reconnectTimer.reset(),this.worker?this.workerRef||this._startWorkerHeartbeat():this._startHeartbeat(),this.stateChangeCallbacks.open.forEach(e=>e())}_startHeartbeat(){this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.heartbeatTimer=setInterval(()=>this.sendHeartbeat(),this.heartbeatIntervalMs)}_startWorkerHeartbeat(){this.workerUrl?this.log("worker",`starting worker for from ${this.workerUrl}`):this.log("worker","starting default worker");const e=this._workerObjectUrl(this.workerUrl);this.workerRef=new Worker(e),this.workerRef.onerror=t=>{this.log("worker","worker error",t.message),this.workerRef.terminate()},this.workerRef.onmessage=t=>{t.data.event==="keepAlive"&&this.sendHeartbeat()},this.workerRef.postMessage({event:"start",interval:this.heartbeatIntervalMs})}_onConnClose(e){this.log("transport","close",e),this._triggerChanError(),this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.reconnectTimer.scheduleTimeout(),this.stateChangeCallbacks.close.forEach(t=>t(e))}_onConnError(e){this.log("transport",`${e}`),this._triggerChanError(),this.stateChangeCallbacks.error.forEach(t=>t(e))}_triggerChanError(){this.channels.forEach(e=>e._trigger(De.error))}_appendParams(e,t){if(Object.keys(t).length===0)return e;const r=e.match(/\?/)?"&":"?",n=new URLSearchParams(t);return`${e}${r}${n}`}_workerObjectUrl(e){let t;if(e)t=e;else{const r=new Blob([oi],{type:"application/javascript"});t=URL.createObjectURL(r)}return t}}class Hr extends Error{constructor(e){super(e),this.__isStorageError=!0,this.name="StorageError"}}function Te(s){return typeof s=="object"&&s!==null&&"__isStorageError"in s}class ci extends Hr{constructor(e,t){super(e),this.name="StorageApiError",this.status=t}toJSON(){return{name:this.name,message:this.message,status:this.status}}}class Lr extends Hr{constructor(e,t){super(e),this.name="StorageUnknownError",this.originalError=t}}var li=function(s,e,t,r){function n(o){return o instanceof t?o:new t(function(c){c(o)})}return new(t||(t=Promise))(function(o,c){function d(v){try{g(r.next(v))}catch(b){c(b)}}function h(v){try{g(r.throw(v))}catch(b){c(b)}}function g(v){v.done?o(v.value):n(v.value).then(d,h)}g((r=r.apply(s,e||[])).next())})};const en=s=>{let e;return s?e=s:typeof fetch>"u"?e=(...t)=>Dt(async()=>{const{default:r}=await Promise.resolve().then(()=>_t);return{default:r}},void 0).then(({default:r})=>r(...t)):e=fetch,(...t)=>e(...t)},fi=()=>li(void 0,void 0,void 0,function*(){return typeof Response>"u"?(yield Dt(()=>Promise.resolve().then(()=>_t),void 0)).Response:Response}),Cr=s=>{if(Array.isArray(s))return s.map(t=>Cr(t));if(typeof s=="function"||s!==Object(s))return s;const e={};return Object.entries(s).forEach(([t,r])=>{const n=t.replace(/([-_][a-z])/gi,o=>o.toUpperCase().replace(/[-_]/g,""));e[n]=Cr(r)}),e};var tt=function(s,e,t,r){function n(o){return o instanceof t?o:new t(function(c){c(o)})}return new(t||(t=Promise))(function(o,c){function d(v){try{g(r.next(v))}catch(b){c(b)}}function h(v){try{g(r.throw(v))}catch(b){c(b)}}function g(v){v.done?o(v.value):n(v.value).then(d,h)}g((r=r.apply(s,e||[])).next())})};const kr=s=>s.msg||s.message||s.error_description||s.error||JSON.stringify(s),ui=(s,e,t)=>tt(void 0,void 0,void 0,function*(){const r=yield fi();s instanceof r&&!t?.noResolveJson?s.json().then(n=>{e(new ci(kr(n),s.status||500))}).catch(n=>{e(new Lr(kr(n),n))}):e(new Lr(kr(s),s))}),di=(s,e,t,r)=>{const n={method:s,headers:e?.headers||{}};return s==="GET"?n:(n.headers=Object.assign({"Content-Type":"application/json"},e?.headers),r&&(n.body=JSON.stringify(r)),Object.assign(Object.assign({},n),t))};function qt(s,e,t,r,n,o){return tt(this,void 0,void 0,function*(){return new Promise((c,d)=>{s(t,di(e,r,n,o)).then(h=>{if(!h.ok)throw h;return r?.noResolveJson?h:h.json()}).then(h=>c(h)).catch(h=>ui(h,d,r))})})}function sr(s,e,t,r){return tt(this,void 0,void 0,function*(){return qt(s,"GET",e,t,r)})}function Je(s,e,t,r,n){return tt(this,void 0,void 0,function*(){return qt(s,"POST",e,r,n,t)})}function hi(s,e,t,r,n){return tt(this,void 0,void 0,function*(){return qt(s,"PUT",e,r,n,t)})}function pi(s,e,t,r){return tt(this,void 0,void 0,function*(){return qt(s,"HEAD",e,Object.assign(Object.assign({},t),{noResolveJson:!0}),r)})}function tn(s,e,t,r,n){return tt(this,void 0,void 0,function*(){return qt(s,"DELETE",e,r,n,t)})}var Ie=function(s,e,t,r){function n(o){return o instanceof t?o:new t(function(c){c(o)})}return new(t||(t=Promise))(function(o,c){function d(v){try{g(r.next(v))}catch(b){c(b)}}function h(v){try{g(r.throw(v))}catch(b){c(b)}}function g(v){v.done?o(v.value):n(v.value).then(d,h)}g((r=r.apply(s,e||[])).next())})};const gi={limit:100,offset:0,sortBy:{column:"name",order:"asc"}},Rs={cacheControl:"3600",contentType:"text/plain;charset=UTF-8",upsert:!1};class vi{constructor(e,t={},r,n){this.url=e,this.headers=t,this.bucketId=r,this.fetch=en(n)}uploadOrUpdate(e,t,r,n){return Ie(this,void 0,void 0,function*(){try{let o;const c=Object.assign(Object.assign({},Rs),n);let d=Object.assign(Object.assign({},this.headers),e==="POST"&&{"x-upsert":String(c.upsert)});const h=c.metadata;typeof Blob<"u"&&r instanceof Blob?(o=new FormData,o.append("cacheControl",c.cacheControl),h&&o.append("metadata",this.encodeMetadata(h)),o.append("",r)):typeof FormData<"u"&&r instanceof FormData?(o=r,o.append("cacheControl",c.cacheControl),h&&o.append("metadata",this.encodeMetadata(h))):(o=r,d["cache-control"]=`max-age=${c.cacheControl}`,d["content-type"]=c.contentType,h&&(d["x-metadata"]=this.toBase64(this.encodeMetadata(h)))),n?.headers&&(d=Object.assign(Object.assign({},d),n.headers));const g=this._removeEmptyFolders(t),v=this._getFinalPath(g),b=yield this.fetch(`${this.url}/object/${v}`,Object.assign({method:e,body:o,headers:d},c?.duplex?{duplex:c.duplex}:{})),T=yield b.json();return b.ok?{data:{path:g,id:T.Id,fullPath:T.Key},error:null}:{data:null,error:T}}catch(o){if(Te(o))return{data:null,error:o};throw o}})}upload(e,t,r){return Ie(this,void 0,void 0,function*(){return this.uploadOrUpdate("POST",e,t,r)})}uploadToSignedUrl(e,t,r,n){return Ie(this,void 0,void 0,function*(){const o=this._removeEmptyFolders(e),c=this._getFinalPath(o),d=new URL(this.url+`/object/upload/sign/${c}`);d.searchParams.set("token",t);try{let h;const g=Object.assign({upsert:Rs.upsert},n),v=Object.assign(Object.assign({},this.headers),{"x-upsert":String(g.upsert)});typeof Blob<"u"&&r instanceof Blob?(h=new FormData,h.append("cacheControl",g.cacheControl),h.append("",r)):typeof FormData<"u"&&r instanceof FormData?(h=r,h.append("cacheControl",g.cacheControl)):(h=r,v["cache-control"]=`max-age=${g.cacheControl}`,v["content-type"]=g.contentType);const b=yield this.fetch(d.toString(),{method:"PUT",body:h,headers:v}),T=yield b.json();return b.ok?{data:{path:o,fullPath:T.Key},error:null}:{data:null,error:T}}catch(h){if(Te(h))return{data:null,error:h};throw h}})}createSignedUploadUrl(e,t){return Ie(this,void 0,void 0,function*(){try{let r=this._getFinalPath(e);const n=Object.assign({},this.headers);t?.upsert&&(n["x-upsert"]="true");const o=yield Je(this.fetch,`${this.url}/object/upload/sign/${r}`,{},{headers:n}),c=new URL(this.url+o.url),d=c.searchParams.get("token");if(!d)throw new Hr("No token returned by API");return{data:{signedUrl:c.toString(),path:e,token:d},error:null}}catch(r){if(Te(r))return{data:null,error:r};throw r}})}update(e,t,r){return Ie(this,void 0,void 0,function*(){return this.uploadOrUpdate("PUT",e,t,r)})}move(e,t,r){return Ie(this,void 0,void 0,function*(){try{return{data:yield Je(this.fetch,`${this.url}/object/move`,{bucketId:this.bucketId,sourceKey:e,destinationKey:t,destinationBucket:r?.destinationBucket},{headers:this.headers}),error:null}}catch(n){if(Te(n))return{data:null,error:n};throw n}})}copy(e,t,r){return Ie(this,void 0,void 0,function*(){try{return{data:{path:(yield Je(this.fetch,`${this.url}/object/copy`,{bucketId:this.bucketId,sourceKey:e,destinationKey:t,destinationBucket:r?.destinationBucket},{headers:this.headers})).Key},error:null}}catch(n){if(Te(n))return{data:null,error:n};throw n}})}createSignedUrl(e,t,r){return Ie(this,void 0,void 0,function*(){try{let n=this._getFinalPath(e),o=yield Je(this.fetch,`${this.url}/object/sign/${n}`,Object.assign({expiresIn:t},r?.transform?{transform:r.transform}:{}),{headers:this.headers});const c=r?.download?`&download=${r.download===!0?"":r.download}`:"";return o={signedUrl:encodeURI(`${this.url}${o.signedURL}${c}`)},{data:o,error:null}}catch(n){if(Te(n))return{data:null,error:n};throw n}})}createSignedUrls(e,t,r){return Ie(this,void 0,void 0,function*(){try{const n=yield Je(this.fetch,`${this.url}/object/sign/${this.bucketId}`,{expiresIn:t,paths:e},{headers:this.headers}),o=r?.download?`&download=${r.download===!0?"":r.download}`:"";return{data:n.map(c=>Object.assign(Object.assign({},c),{signedUrl:c.signedURL?encodeURI(`${this.url}${c.signedURL}${o}`):null})),error:null}}catch(n){if(Te(n))return{data:null,error:n};throw n}})}download(e,t){return Ie(this,void 0,void 0,function*(){const n=typeof t?.transform<"u"?"render/image/authenticated":"object",o=this.transformOptsToQueryString(t?.transform||{}),c=o?`?${o}`:"";try{const d=this._getFinalPath(e);return{data:yield(yield sr(this.fetch,`${this.url}/${n}/${d}${c}`,{headers:this.headers,noResolveJson:!0})).blob(),error:null}}catch(d){if(Te(d))return{data:null,error:d};throw d}})}info(e){return Ie(this,void 0,void 0,function*(){const t=this._getFinalPath(e);try{const r=yield sr(this.fetch,`${this.url}/object/info/${t}`,{headers:this.headers});return{data:Cr(r),error:null}}catch(r){if(Te(r))return{data:null,error:r};throw r}})}exists(e){return Ie(this,void 0,void 0,function*(){const t=this._getFinalPath(e);try{return yield pi(this.fetch,`${this.url}/object/${t}`,{headers:this.headers}),{data:!0,error:null}}catch(r){if(Te(r)&&r instanceof Lr){const n=r.originalError;if([400,404].includes(n?.status))return{data:!1,error:r}}throw r}})}getPublicUrl(e,t){const r=this._getFinalPath(e),n=[],o=t?.download?`download=${t.download===!0?"":t.download}`:"";o!==""&&n.push(o);const d=typeof t?.transform<"u"?"render/image":"object",h=this.transformOptsToQueryString(t?.transform||{});h!==""&&n.push(h);let g=n.join("&");return g!==""&&(g=`?${g}`),{data:{publicUrl:encodeURI(`${this.url}/${d}/public/${r}${g}`)}}}remove(e){return Ie(this,void 0,void 0,function*(){try{return{data:yield tn(this.fetch,`${this.url}/object/${this.bucketId}`,{prefixes:e},{headers:this.headers}),error:null}}catch(t){if(Te(t))return{data:null,error:t};throw t}})}list(e,t,r){return Ie(this,void 0,void 0,function*(){try{const n=Object.assign(Object.assign(Object.assign({},gi),t),{prefix:e||""});return{data:yield Je(this.fetch,`${this.url}/object/list/${this.bucketId}`,n,{headers:this.headers},r),error:null}}catch(n){if(Te(n))return{data:null,error:n};throw n}})}encodeMetadata(e){return JSON.stringify(e)}toBase64(e){return typeof Buffer<"u"?Buffer.from(e).toString("base64"):btoa(e)}_getFinalPath(e){return`${this.bucketId}/${e}`}_removeEmptyFolders(e){return e.replace(/^\/|\/$/g,"").replace(/\/+/g,"/")}transformOptsToQueryString(e){const t=[];return e.width&&t.push(`width=${e.width}`),e.height&&t.push(`height=${e.height}`),e.resize&&t.push(`resize=${e.resize}`),e.format&&t.push(`format=${e.format}`),e.quality&&t.push(`quality=${e.quality}`),t.join("&")}}const yi="2.7.1",mi={"X-Client-Info":`storage-js/${yi}`};var ut=function(s,e,t,r){function n(o){return o instanceof t?o:new t(function(c){c(o)})}return new(t||(t=Promise))(function(o,c){function d(v){try{g(r.next(v))}catch(b){c(b)}}function h(v){try{g(r.throw(v))}catch(b){c(b)}}function g(v){v.done?o(v.value):n(v.value).then(d,h)}g((r=r.apply(s,e||[])).next())})};class _i{constructor(e,t={},r){this.url=e,this.headers=Object.assign(Object.assign({},mi),t),this.fetch=en(r)}listBuckets(){return ut(this,void 0,void 0,function*(){try{return{data:yield sr(this.fetch,`${this.url}/bucket`,{headers:this.headers}),error:null}}catch(e){if(Te(e))return{data:null,error:e};throw e}})}getBucket(e){return ut(this,void 0,void 0,function*(){try{return{data:yield sr(this.fetch,`${this.url}/bucket/${e}`,{headers:this.headers}),error:null}}catch(t){if(Te(t))return{data:null,error:t};throw t}})}createBucket(e,t={public:!1}){return ut(this,void 0,void 0,function*(){try{return{data:yield Je(this.fetch,`${this.url}/bucket`,{id:e,name:e,public:t.public,file_size_limit:t.fileSizeLimit,allowed_mime_types:t.allowedMimeTypes},{headers:this.headers}),error:null}}catch(r){if(Te(r))return{data:null,error:r};throw r}})}updateBucket(e,t){return ut(this,void 0,void 0,function*(){try{return{data:yield hi(this.fetch,`${this.url}/bucket/${e}`,{id:e,name:e,public:t.public,file_size_limit:t.fileSizeLimit,allowed_mime_types:t.allowedMimeTypes},{headers:this.headers}),error:null}}catch(r){if(Te(r))return{data:null,error:r};throw r}})}emptyBucket(e){return ut(this,void 0,void 0,function*(){try{return{data:yield Je(this.fetch,`${this.url}/bucket/${e}/empty`,{},{headers:this.headers}),error:null}}catch(t){if(Te(t))return{data:null,error:t};throw t}})}deleteBucket(e){return ut(this,void 0,void 0,function*(){try{return{data:yield tn(this.fetch,`${this.url}/bucket/${e}`,{},{headers:this.headers}),error:null}}catch(t){if(Te(t))return{data:null,error:t};throw t}})}}class wi extends _i{constructor(e,t={},r){super(e,t,r)}from(e){return new vi(this.url,this.headers,e,this.fetch)}}const bi="2.50.2";let Tt="";typeof Deno<"u"?Tt="deno":typeof document<"u"?Tt="web":typeof navigator<"u"&&navigator.product==="ReactNative"?Tt="react-native":Tt="node";const xi={"X-Client-Info":`supabase-js-${Tt}/${bi}`},Ei={headers:xi},Si={schema:"public"},ki={autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,flowType:"implicit"},Ti={};var Ai=function(s,e,t,r){function n(o){return o instanceof t?o:new t(function(c){c(o)})}return new(t||(t=Promise))(function(o,c){function d(v){try{g(r.next(v))}catch(b){c(b)}}function h(v){try{g(r.throw(v))}catch(b){c(b)}}function g(v){v.done?o(v.value):n(v.value).then(d,h)}g((r=r.apply(s,e||[])).next())})};const Oi=s=>{let e;return s?e=s:typeof fetch>"u"?e=zs:e=fetch,(...t)=>e(...t)},Pi=()=>typeof Headers>"u"?Ks:Headers,ji=(s,e,t)=>{const r=Oi(t),n=Pi();return(o,c)=>Ai(void 0,void 0,void 0,function*(){var d;const h=(d=yield e())!==null&&d!==void 0?d:s;let g=new n(c?.headers);return g.has("apikey")||g.set("apikey",s),g.has("Authorization")||g.set("Authorization",`Bearer ${h}`),r(o,Object.assign(Object.assign({},c),{headers:g}))})};var Ri=function(s,e,t,r){function n(o){return o instanceof t?o:new t(function(c){c(o)})}return new(t||(t=Promise))(function(o,c){function d(v){try{g(r.next(v))}catch(b){c(b)}}function h(v){try{g(r.throw(v))}catch(b){c(b)}}function g(v){v.done?o(v.value):n(v.value).then(d,h)}g((r=r.apply(s,e||[])).next())})};function $i(s){return s.endsWith("/")?s:s+"/"}function Ii(s,e){var t,r;const{db:n,auth:o,realtime:c,global:d}=s,{db:h,auth:g,realtime:v,global:b}=e,T={db:Object.assign(Object.assign({},h),n),auth:Object.assign(Object.assign({},g),o),realtime:Object.assign(Object.assign({},v),c),global:Object.assign(Object.assign(Object.assign({},b),d),{headers:Object.assign(Object.assign({},(t=b?.headers)!==null&&t!==void 0?t:{}),(r=d?.headers)!==null&&r!==void 0?r:{})}),accessToken:()=>Ri(this,void 0,void 0,function*(){return""})};return s.accessToken?T.accessToken=s.accessToken:delete T.accessToken,T}const rn="2.70.0",gt=30*1e3,Br=3,Tr=Br*gt,Ui="http://localhost:9999",Li="supabase.auth.token",Ci={"X-Client-Info":`gotrue-js/${rn}`},Mr="X-Supabase-Api-Version",sn={"2024-01-01":{timestamp:Date.parse("2024-01-01T00:00:00.0Z"),name:"2024-01-01"}},Bi=/^([a-z0-9_-]{4})*($|[a-z0-9_-]{3}$|[a-z0-9_-]{2}$)$/i,Mi=6e5;class Jr extends Error{constructor(e,t,r){super(e),this.__isAuthError=!0,this.name="AuthError",this.status=t,this.code=r}}function Z(s){return typeof s=="object"&&s!==null&&"__isAuthError"in s}class Di extends Jr{constructor(e,t,r){super(e,t,r),this.name="AuthApiError",this.status=t,this.code=r}}function qi(s){return Z(s)&&s.name==="AuthApiError"}class nn extends Jr{constructor(e,t){super(e),this.name="AuthUnknownError",this.originalError=t}}class Ye extends Jr{constructor(e,t,r,n){super(e,r,n),this.name=t,this.status=r}}class Ke extends Ye{constructor(){super("Auth session missing!","AuthSessionMissingError",400,void 0)}}function Ni(s){return Z(s)&&s.name==="AuthSessionMissingError"}class Qt extends Ye{constructor(){super("Auth session or user missing","AuthInvalidTokenResponseError",500,void 0)}}class Xt extends Ye{constructor(e){super(e,"AuthInvalidCredentialsError",400,void 0)}}class Zt extends Ye{constructor(e,t=null){super(e,"AuthImplicitGrantRedirectError",500,void 0),this.details=null,this.details=t}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}function Fi(s){return Z(s)&&s.name==="AuthImplicitGrantRedirectError"}class $s extends Ye{constructor(e,t=null){super(e,"AuthPKCEGrantCodeExchangeError",500,void 0),this.details=null,this.details=t}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}class Dr extends Ye{constructor(e,t){super(e,"AuthRetryableFetchError",t,void 0)}}function Ar(s){return Z(s)&&s.name==="AuthRetryableFetchError"}class Is extends Ye{constructor(e,t,r){super(e,"AuthWeakPasswordError",t,"weak_password"),this.reasons=r}}class Pt extends Ye{constructor(e){super(e,"AuthInvalidJwtError",400,"invalid_jwt")}}const nr="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_".split(""),Us=` 	
\r=`.split(""),Wi=(()=>{const s=new Array(128);for(let e=0;e<s.length;e+=1)s[e]=-1;for(let e=0;e<Us.length;e+=1)s[Us[e].charCodeAt(0)]=-2;for(let e=0;e<nr.length;e+=1)s[nr[e].charCodeAt(0)]=e;return s})();function Ls(s,e,t){if(s!==null)for(e.queue=e.queue<<8|s,e.queuedBits+=8;e.queuedBits>=6;){const r=e.queue>>e.queuedBits-6&63;t(nr[r]),e.queuedBits-=6}else if(e.queuedBits>0)for(e.queue=e.queue<<6-e.queuedBits,e.queuedBits=6;e.queuedBits>=6;){const r=e.queue>>e.queuedBits-6&63;t(nr[r]),e.queuedBits-=6}}function on(s,e,t){const r=Wi[s];if(r>-1)for(e.queue=e.queue<<6|r,e.queuedBits+=6;e.queuedBits>=8;)t(e.queue>>e.queuedBits-8&255),e.queuedBits-=8;else{if(r===-2)return;throw new Error(`Invalid Base64-URL character "${String.fromCharCode(s)}"`)}}function Cs(s){const e=[],t=c=>{e.push(String.fromCodePoint(c))},r={utf8seq:0,codepoint:0},n={queue:0,queuedBits:0},o=c=>{Hi(c,r,t)};for(let c=0;c<s.length;c+=1)on(s.charCodeAt(c),n,o);return e.join("")}function zi(s,e){if(s<=127){e(s);return}else if(s<=2047){e(192|s>>6),e(128|s&63);return}else if(s<=65535){e(224|s>>12),e(128|s>>6&63),e(128|s&63);return}else if(s<=1114111){e(240|s>>18),e(128|s>>12&63),e(128|s>>6&63),e(128|s&63);return}throw new Error(`Unrecognized Unicode codepoint: ${s.toString(16)}`)}function Ki(s,e){for(let t=0;t<s.length;t+=1){let r=s.charCodeAt(t);if(r>55295&&r<=56319){const n=(r-55296)*1024&65535;r=(s.charCodeAt(t+1)-56320&65535|n)+65536,t+=1}zi(r,e)}}function Hi(s,e,t){if(e.utf8seq===0){if(s<=127){t(s);return}for(let r=1;r<6;r+=1)if((s>>7-r&1)===0){e.utf8seq=r;break}if(e.utf8seq===2)e.codepoint=s&31;else if(e.utf8seq===3)e.codepoint=s&15;else if(e.utf8seq===4)e.codepoint=s&7;else throw new Error("Invalid UTF-8 sequence");e.utf8seq-=1}else if(e.utf8seq>0){if(s<=127)throw new Error("Invalid UTF-8 sequence");e.codepoint=e.codepoint<<6|s&63,e.utf8seq-=1,e.utf8seq===0&&t(e.codepoint)}}function Ji(s){const e=[],t={queue:0,queuedBits:0},r=n=>{e.push(n)};for(let n=0;n<s.length;n+=1)on(s.charCodeAt(n),t,r);return new Uint8Array(e)}function Gi(s){const e=[];return Ki(s,t=>e.push(t)),new Uint8Array(e)}function Yi(s){const e=[],t={queue:0,queuedBits:0},r=n=>{e.push(n)};return s.forEach(n=>Ls(n,t,r)),Ls(null,t,r),e.join("")}function Vi(s){return Math.round(Date.now()/1e3)+s}function Qi(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(s){const e=Math.random()*16|0;return(s=="x"?e:e&3|8).toString(16)})}const Me=()=>typeof window<"u"&&typeof document<"u",Xe={tested:!1,writable:!1},jt=()=>{if(!Me())return!1;try{if(typeof globalThis.localStorage!="object")return!1}catch{return!1}if(Xe.tested)return Xe.writable;const s=`lswt-${Math.random()}${Math.random()}`;try{globalThis.localStorage.setItem(s,s),globalThis.localStorage.removeItem(s),Xe.tested=!0,Xe.writable=!0}catch{Xe.tested=!0,Xe.writable=!1}return Xe.writable};function Xi(s){const e={},t=new URL(s);if(t.hash&&t.hash[0]==="#")try{new URLSearchParams(t.hash.substring(1)).forEach((n,o)=>{e[o]=n})}catch{}return t.searchParams.forEach((r,n)=>{e[n]=r}),e}const an=s=>{let e;return s?e=s:typeof fetch>"u"?e=(...t)=>Dt(async()=>{const{default:r}=await Promise.resolve().then(()=>_t);return{default:r}},void 0).then(({default:r})=>r(...t)):e=fetch,(...t)=>e(...t)},Zi=s=>typeof s=="object"&&s!==null&&"status"in s&&"ok"in s&&"json"in s&&typeof s.json=="function",cn=async(s,e,t)=>{await s.setItem(e,JSON.stringify(t))},er=async(s,e)=>{const t=await s.getItem(e);if(!t)return null;try{return JSON.parse(t)}catch{return t}},tr=async(s,e)=>{await s.removeItem(e)};class ir{constructor(){this.promise=new ir.promiseConstructor((e,t)=>{this.resolve=e,this.reject=t})}}ir.promiseConstructor=Promise;function Or(s){const e=s.split(".");if(e.length!==3)throw new Pt("Invalid JWT structure");for(let r=0;r<e.length;r++)if(!Bi.test(e[r]))throw new Pt("JWT not in base64url format");return{header:JSON.parse(Cs(e[0])),payload:JSON.parse(Cs(e[1])),signature:Ji(e[2]),raw:{header:e[0],payload:e[1]}}}async function eo(s){return await new Promise(e=>{setTimeout(()=>e(null),s)})}function to(s,e){return new Promise((r,n)=>{(async()=>{for(let o=0;o<1/0;o++)try{const c=await s(o);if(!e(o,null,c)){r(c);return}}catch(c){if(!e(o,c)){n(c);return}}})()})}function ro(s){return("0"+s.toString(16)).substr(-2)}function so(){const e=new Uint32Array(56);if(typeof crypto>"u"){const t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-._~",r=t.length;let n="";for(let o=0;o<56;o++)n+=t.charAt(Math.floor(Math.random()*r));return n}return crypto.getRandomValues(e),Array.from(e,ro).join("")}async function no(s){const t=new TextEncoder().encode(s),r=await crypto.subtle.digest("SHA-256",t),n=new Uint8Array(r);return Array.from(n).map(o=>String.fromCharCode(o)).join("")}async function io(s){if(!(typeof crypto<"u"&&typeof crypto.subtle<"u"&&typeof TextEncoder<"u"))return console.warn("WebCrypto API is not supported. Code challenge method will default to use plain instead of sha256."),s;const t=await no(s);return btoa(t).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}async function dt(s,e,t=!1){const r=so();let n=r;t&&(n+="/PASSWORD_RECOVERY"),await cn(s,`${e}-code-verifier`,n);const o=await io(r);return[o,r===o?"plain":"s256"]}const oo=/^2[0-9]{3}-(0[1-9]|1[0-2])-(0[1-9]|1[0-9]|2[0-9]|3[0-1])$/i;function ao(s){const e=s.headers.get(Mr);if(!e||!e.match(oo))return null;try{return new Date(`${e}T00:00:00.0Z`)}catch{return null}}function co(s){if(!s)throw new Error("Missing exp claim");const e=Math.floor(Date.now()/1e3);if(s<=e)throw new Error("JWT has expired")}function lo(s){switch(s){case"RS256":return{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}};case"ES256":return{name:"ECDSA",namedCurve:"P-256",hash:{name:"SHA-256"}};default:throw new Error("Invalid alg claim")}}const fo=/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/;function ht(s){if(!fo.test(s))throw new Error("@supabase/auth-js: Expected parameter to be UUID but is not")}var uo=function(s,e){var t={};for(var r in s)Object.prototype.hasOwnProperty.call(s,r)&&e.indexOf(r)<0&&(t[r]=s[r]);if(s!=null&&typeof Object.getOwnPropertySymbols=="function")for(var n=0,r=Object.getOwnPropertySymbols(s);n<r.length;n++)e.indexOf(r[n])<0&&Object.prototype.propertyIsEnumerable.call(s,r[n])&&(t[r[n]]=s[r[n]]);return t};const Ze=s=>s.msg||s.message||s.error_description||s.error||JSON.stringify(s),ho=[502,503,504];async function Bs(s){var e;if(!Zi(s))throw new Dr(Ze(s),0);if(ho.includes(s.status))throw new Dr(Ze(s),s.status);let t;try{t=await s.json()}catch(o){throw new nn(Ze(o),o)}let r;const n=ao(s);if(n&&n.getTime()>=sn["2024-01-01"].timestamp&&typeof t=="object"&&t&&typeof t.code=="string"?r=t.code:typeof t=="object"&&t&&typeof t.error_code=="string"&&(r=t.error_code),r){if(r==="weak_password")throw new Is(Ze(t),s.status,((e=t.weak_password)===null||e===void 0?void 0:e.reasons)||[]);if(r==="session_not_found")throw new Ke}else if(typeof t=="object"&&t&&typeof t.weak_password=="object"&&t.weak_password&&Array.isArray(t.weak_password.reasons)&&t.weak_password.reasons.length&&t.weak_password.reasons.reduce((o,c)=>o&&typeof c=="string",!0))throw new Is(Ze(t),s.status,t.weak_password.reasons);throw new Di(Ze(t),s.status||500,r)}const po=(s,e,t,r)=>{const n={method:s,headers:e?.headers||{}};return s==="GET"?n:(n.headers=Object.assign({"Content-Type":"application/json;charset=UTF-8"},e?.headers),n.body=JSON.stringify(r),Object.assign(Object.assign({},n),t))};async function ne(s,e,t,r){var n;const o=Object.assign({},r?.headers);o[Mr]||(o[Mr]=sn["2024-01-01"].name),r?.jwt&&(o.Authorization=`Bearer ${r.jwt}`);const c=(n=r?.query)!==null&&n!==void 0?n:{};r?.redirectTo&&(c.redirect_to=r.redirectTo);const d=Object.keys(c).length?"?"+new URLSearchParams(c).toString():"",h=await go(s,e,t+d,{headers:o,noResolveJson:r?.noResolveJson},{},r?.body);return r?.xform?r?.xform(h):{data:Object.assign({},h),error:null}}async function go(s,e,t,r,n,o){const c=po(e,r,n,o);let d;try{d=await s(t,Object.assign({},c))}catch(h){throw console.error(h),new Dr(Ze(h),0)}if(d.ok||await Bs(d),r?.noResolveJson)return d;try{return await d.json()}catch(h){await Bs(h)}}function We(s){var e;let t=null;_o(s)&&(t=Object.assign({},s),s.expires_at||(t.expires_at=Vi(s.expires_in)));const r=(e=s.user)!==null&&e!==void 0?e:s;return{data:{session:t,user:r},error:null}}function Ms(s){const e=We(s);return!e.error&&s.weak_password&&typeof s.weak_password=="object"&&Array.isArray(s.weak_password.reasons)&&s.weak_password.reasons.length&&s.weak_password.message&&typeof s.weak_password.message=="string"&&s.weak_password.reasons.reduce((t,r)=>t&&typeof r=="string",!0)&&(e.data.weak_password=s.weak_password),e}function Ge(s){var e;return{data:{user:(e=s.user)!==null&&e!==void 0?e:s},error:null}}function vo(s){return{data:s,error:null}}function yo(s){const{action_link:e,email_otp:t,hashed_token:r,redirect_to:n,verification_type:o}=s,c=uo(s,["action_link","email_otp","hashed_token","redirect_to","verification_type"]),d={action_link:e,email_otp:t,hashed_token:r,redirect_to:n,verification_type:o},h=Object.assign({},c);return{data:{properties:d,user:h},error:null}}function mo(s){return s}function _o(s){return s.access_token&&s.refresh_token&&s.expires_in}const Pr=["global","local","others"];var wo=function(s,e){var t={};for(var r in s)Object.prototype.hasOwnProperty.call(s,r)&&e.indexOf(r)<0&&(t[r]=s[r]);if(s!=null&&typeof Object.getOwnPropertySymbols=="function")for(var n=0,r=Object.getOwnPropertySymbols(s);n<r.length;n++)e.indexOf(r[n])<0&&Object.prototype.propertyIsEnumerable.call(s,r[n])&&(t[r[n]]=s[r[n]]);return t};class bo{constructor({url:e="",headers:t={},fetch:r}){this.url=e,this.headers=t,this.fetch=an(r),this.mfa={listFactors:this._listFactors.bind(this),deleteFactor:this._deleteFactor.bind(this)}}async signOut(e,t=Pr[0]){if(Pr.indexOf(t)<0)throw new Error(`@supabase/auth-js: Parameter scope must be one of ${Pr.join(", ")}`);try{return await ne(this.fetch,"POST",`${this.url}/logout?scope=${t}`,{headers:this.headers,jwt:e,noResolveJson:!0}),{data:null,error:null}}catch(r){if(Z(r))return{data:null,error:r};throw r}}async inviteUserByEmail(e,t={}){try{return await ne(this.fetch,"POST",`${this.url}/invite`,{body:{email:e,data:t.data},headers:this.headers,redirectTo:t.redirectTo,xform:Ge})}catch(r){if(Z(r))return{data:{user:null},error:r};throw r}}async generateLink(e){try{const{options:t}=e,r=wo(e,["options"]),n=Object.assign(Object.assign({},r),t);return"newEmail"in r&&(n.new_email=r?.newEmail,delete n.newEmail),await ne(this.fetch,"POST",`${this.url}/admin/generate_link`,{body:n,headers:this.headers,xform:yo,redirectTo:t?.redirectTo})}catch(t){if(Z(t))return{data:{properties:null,user:null},error:t};throw t}}async createUser(e){try{return await ne(this.fetch,"POST",`${this.url}/admin/users`,{body:e,headers:this.headers,xform:Ge})}catch(t){if(Z(t))return{data:{user:null},error:t};throw t}}async listUsers(e){var t,r,n,o,c,d,h;try{const g={nextPage:null,lastPage:0,total:0},v=await ne(this.fetch,"GET",`${this.url}/admin/users`,{headers:this.headers,noResolveJson:!0,query:{page:(r=(t=e?.page)===null||t===void 0?void 0:t.toString())!==null&&r!==void 0?r:"",per_page:(o=(n=e?.perPage)===null||n===void 0?void 0:n.toString())!==null&&o!==void 0?o:""},xform:mo});if(v.error)throw v.error;const b=await v.json(),T=(c=v.headers.get("x-total-count"))!==null&&c!==void 0?c:0,O=(h=(d=v.headers.get("link"))===null||d===void 0?void 0:d.split(","))!==null&&h!==void 0?h:[];return O.length>0&&(O.forEach(I=>{const W=parseInt(I.split(";")[0].split("=")[1].substring(0,1)),D=JSON.parse(I.split(";")[1].split("=")[1]);g[`${D}Page`]=W}),g.total=parseInt(T)),{data:Object.assign(Object.assign({},b),g),error:null}}catch(g){if(Z(g))return{data:{users:[]},error:g};throw g}}async getUserById(e){ht(e);try{return await ne(this.fetch,"GET",`${this.url}/admin/users/${e}`,{headers:this.headers,xform:Ge})}catch(t){if(Z(t))return{data:{user:null},error:t};throw t}}async updateUserById(e,t){ht(e);try{return await ne(this.fetch,"PUT",`${this.url}/admin/users/${e}`,{body:t,headers:this.headers,xform:Ge})}catch(r){if(Z(r))return{data:{user:null},error:r};throw r}}async deleteUser(e,t=!1){ht(e);try{return await ne(this.fetch,"DELETE",`${this.url}/admin/users/${e}`,{headers:this.headers,body:{should_soft_delete:t},xform:Ge})}catch(r){if(Z(r))return{data:{user:null},error:r};throw r}}async _listFactors(e){ht(e.userId);try{const{data:t,error:r}=await ne(this.fetch,"GET",`${this.url}/admin/users/${e.userId}/factors`,{headers:this.headers,xform:n=>({data:{factors:n},error:null})});return{data:t,error:r}}catch(t){if(Z(t))return{data:null,error:t};throw t}}async _deleteFactor(e){ht(e.userId),ht(e.id);try{return{data:await ne(this.fetch,"DELETE",`${this.url}/admin/users/${e.userId}/factors/${e.id}`,{headers:this.headers}),error:null}}catch(t){if(Z(t))return{data:null,error:t};throw t}}}const xo={getItem:s=>jt()?globalThis.localStorage.getItem(s):null,setItem:(s,e)=>{jt()&&globalThis.localStorage.setItem(s,e)},removeItem:s=>{jt()&&globalThis.localStorage.removeItem(s)}};function Ds(s={}){return{getItem:e=>s[e]||null,setItem:(e,t)=>{s[e]=t},removeItem:e=>{delete s[e]}}}function Eo(){if(typeof globalThis!="object")try{Object.defineProperty(Object.prototype,"__magic__",{get:function(){return this},configurable:!0}),__magic__.globalThis=__magic__,delete Object.prototype.__magic__}catch{typeof self<"u"&&(self.globalThis=self)}}const pt={debug:!!(globalThis&&jt()&&globalThis.localStorage&&globalThis.localStorage.getItem("supabase.gotrue-js.locks.debug")==="true")};class ln extends Error{constructor(e){super(e),this.isAcquireTimeout=!0}}class So extends ln{}async function ko(s,e,t){pt.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquire lock",s,e);const r=new globalThis.AbortController;return e>0&&setTimeout(()=>{r.abort(),pt.debug&&console.log("@supabase/gotrue-js: navigatorLock acquire timed out",s)},e),await Promise.resolve().then(()=>globalThis.navigator.locks.request(s,e===0?{mode:"exclusive",ifAvailable:!0}:{mode:"exclusive",signal:r.signal},async n=>{if(n){pt.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquired",s,n.name);try{return await t()}finally{pt.debug&&console.log("@supabase/gotrue-js: navigatorLock: released",s,n.name)}}else{if(e===0)throw pt.debug&&console.log("@supabase/gotrue-js: navigatorLock: not immediately available",s),new So(`Acquiring an exclusive Navigator LockManager lock "${s}" immediately failed`);if(pt.debug)try{const o=await globalThis.navigator.locks.query();console.log("@supabase/gotrue-js: Navigator LockManager state",JSON.stringify(o,null,"  "))}catch(o){console.warn("@supabase/gotrue-js: Error when querying Navigator LockManager state",o)}return console.warn("@supabase/gotrue-js: Navigator LockManager returned a null lock when using #request without ifAvailable set to true, it appears this browser is not following the LockManager spec https://developer.mozilla.org/en-US/docs/Web/API/LockManager/request"),await t()}}))}Eo();const To={url:Ui,storageKey:Li,autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,headers:Ci,flowType:"implicit",debug:!1,hasCustomAuthorizationHeader:!1};async function qs(s,e,t){return await t()}class $t{constructor(e){var t,r;this.memoryStorage=null,this.stateChangeEmitters=new Map,this.autoRefreshTicker=null,this.visibilityChangedCallback=null,this.refreshingDeferred=null,this.initializePromise=null,this.detectSessionInUrl=!0,this.hasCustomAuthorizationHeader=!1,this.suppressGetSessionWarning=!1,this.lockAcquired=!1,this.pendingInLock=[],this.broadcastChannel=null,this.logger=console.log,this.instanceID=$t.nextInstanceID,$t.nextInstanceID+=1,this.instanceID>0&&Me()&&console.warn("Multiple GoTrueClient instances detected in the same browser context. It is not an error, but this should be avoided as it may produce undefined behavior when used concurrently under the same storage key.");const n=Object.assign(Object.assign({},To),e);if(this.logDebugMessages=!!n.debug,typeof n.debug=="function"&&(this.logger=n.debug),this.persistSession=n.persistSession,this.storageKey=n.storageKey,this.autoRefreshToken=n.autoRefreshToken,this.admin=new bo({url:n.url,headers:n.headers,fetch:n.fetch}),this.url=n.url,this.headers=n.headers,this.fetch=an(n.fetch),this.lock=n.lock||qs,this.detectSessionInUrl=n.detectSessionInUrl,this.flowType=n.flowType,this.hasCustomAuthorizationHeader=n.hasCustomAuthorizationHeader,n.lock?this.lock=n.lock:Me()&&(!((t=globalThis?.navigator)===null||t===void 0)&&t.locks)?this.lock=ko:this.lock=qs,this.jwks={keys:[]},this.jwks_cached_at=Number.MIN_SAFE_INTEGER,this.mfa={verify:this._verify.bind(this),enroll:this._enroll.bind(this),unenroll:this._unenroll.bind(this),challenge:this._challenge.bind(this),listFactors:this._listFactors.bind(this),challengeAndVerify:this._challengeAndVerify.bind(this),getAuthenticatorAssuranceLevel:this._getAuthenticatorAssuranceLevel.bind(this)},this.persistSession?n.storage?this.storage=n.storage:jt()?this.storage=xo:(this.memoryStorage={},this.storage=Ds(this.memoryStorage)):(this.memoryStorage={},this.storage=Ds(this.memoryStorage)),Me()&&globalThis.BroadcastChannel&&this.persistSession&&this.storageKey){try{this.broadcastChannel=new globalThis.BroadcastChannel(this.storageKey)}catch(o){console.error("Failed to create a new BroadcastChannel, multi-tab state changes will not be available",o)}(r=this.broadcastChannel)===null||r===void 0||r.addEventListener("message",async o=>{this._debug("received broadcast notification from other tab or client",o),await this._notifyAllSubscribers(o.data.event,o.data.session,!1)})}this.initialize()}_debug(...e){return this.logDebugMessages&&this.logger(`GoTrueClient@${this.instanceID} (${rn}) ${new Date().toISOString()}`,...e),this}async initialize(){return this.initializePromise?await this.initializePromise:(this.initializePromise=(async()=>await this._acquireLock(-1,async()=>await this._initialize()))(),await this.initializePromise)}async _initialize(){var e;try{const t=Xi(window.location.href);let r="none";if(this._isImplicitGrantCallback(t)?r="implicit":await this._isPKCECallback(t)&&(r="pkce"),Me()&&this.detectSessionInUrl&&r!=="none"){const{data:n,error:o}=await this._getSessionFromURL(t,r);if(o){if(this._debug("#_initialize()","error detecting session from URL",o),Fi(o)){const h=(e=o.details)===null||e===void 0?void 0:e.code;if(h==="identity_already_exists"||h==="identity_not_found"||h==="single_identity_not_deletable")return{error:o}}return await this._removeSession(),{error:o}}const{session:c,redirectType:d}=n;return this._debug("#_initialize()","detected session in URL",c,"redirect type",d),await this._saveSession(c),setTimeout(async()=>{d==="recovery"?await this._notifyAllSubscribers("PASSWORD_RECOVERY",c):await this._notifyAllSubscribers("SIGNED_IN",c)},0),{error:null}}return await this._recoverAndRefresh(),{error:null}}catch(t){return Z(t)?{error:t}:{error:new nn("Unexpected error during initialization",t)}}finally{await this._handleVisibilityChange(),this._debug("#_initialize()","end")}}async signInAnonymously(e){var t,r,n;try{const o=await ne(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{data:(r=(t=e?.options)===null||t===void 0?void 0:t.data)!==null&&r!==void 0?r:{},gotrue_meta_security:{captcha_token:(n=e?.options)===null||n===void 0?void 0:n.captchaToken}},xform:We}),{data:c,error:d}=o;if(d||!c)return{data:{user:null,session:null},error:d};const h=c.session,g=c.user;return c.session&&(await this._saveSession(c.session),await this._notifyAllSubscribers("SIGNED_IN",h)),{data:{user:g,session:h},error:null}}catch(o){if(Z(o))return{data:{user:null,session:null},error:o};throw o}}async signUp(e){var t,r,n;try{let o;if("email"in e){const{email:v,password:b,options:T}=e;let O=null,I=null;this.flowType==="pkce"&&([O,I]=await dt(this.storage,this.storageKey)),o=await ne(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,redirectTo:T?.emailRedirectTo,body:{email:v,password:b,data:(t=T?.data)!==null&&t!==void 0?t:{},gotrue_meta_security:{captcha_token:T?.captchaToken},code_challenge:O,code_challenge_method:I},xform:We})}else if("phone"in e){const{phone:v,password:b,options:T}=e;o=await ne(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{phone:v,password:b,data:(r=T?.data)!==null&&r!==void 0?r:{},channel:(n=T?.channel)!==null&&n!==void 0?n:"sms",gotrue_meta_security:{captcha_token:T?.captchaToken}},xform:We})}else throw new Xt("You must provide either an email or phone number and a password");const{data:c,error:d}=o;if(d||!c)return{data:{user:null,session:null},error:d};const h=c.session,g=c.user;return c.session&&(await this._saveSession(c.session),await this._notifyAllSubscribers("SIGNED_IN",h)),{data:{user:g,session:h},error:null}}catch(o){if(Z(o))return{data:{user:null,session:null},error:o};throw o}}async signInWithPassword(e){try{let t;if("email"in e){const{email:o,password:c,options:d}=e;t=await ne(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{email:o,password:c,gotrue_meta_security:{captcha_token:d?.captchaToken}},xform:Ms})}else if("phone"in e){const{phone:o,password:c,options:d}=e;t=await ne(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{phone:o,password:c,gotrue_meta_security:{captcha_token:d?.captchaToken}},xform:Ms})}else throw new Xt("You must provide either an email or phone number and a password");const{data:r,error:n}=t;return n?{data:{user:null,session:null},error:n}:!r||!r.session||!r.user?{data:{user:null,session:null},error:new Qt}:(r.session&&(await this._saveSession(r.session),await this._notifyAllSubscribers("SIGNED_IN",r.session)),{data:Object.assign({user:r.user,session:r.session},r.weak_password?{weakPassword:r.weak_password}:null),error:n})}catch(t){if(Z(t))return{data:{user:null,session:null},error:t};throw t}}async signInWithOAuth(e){var t,r,n,o;return await this._handleProviderSignIn(e.provider,{redirectTo:(t=e.options)===null||t===void 0?void 0:t.redirectTo,scopes:(r=e.options)===null||r===void 0?void 0:r.scopes,queryParams:(n=e.options)===null||n===void 0?void 0:n.queryParams,skipBrowserRedirect:(o=e.options)===null||o===void 0?void 0:o.skipBrowserRedirect})}async exchangeCodeForSession(e){return await this.initializePromise,this._acquireLock(-1,async()=>this._exchangeCodeForSession(e))}async signInWithWeb3(e){const{chain:t}=e;if(t==="solana")return await this.signInWithSolana(e);throw new Error(`@supabase/auth-js: Unsupported chain "${t}"`)}async signInWithSolana(e){var t,r,n,o,c,d,h,g,v,b,T,O;let I,W;if("message"in e)I=e.message,W=e.signature;else{const{chain:D,wallet:ue,statement:_e,options:N}=e;let se;if(Me())if(typeof ue=="object")se=ue;else{const de=window;if("solana"in de&&typeof de.solana=="object"&&("signIn"in de.solana&&typeof de.solana.signIn=="function"||"signMessage"in de.solana&&typeof de.solana.signMessage=="function"))se=de.solana;else throw new Error("@supabase/auth-js: No compatible Solana wallet interface on the window object (window.solana) detected. Make sure the user already has a wallet installed and connected for this app. Prefer passing the wallet interface object directly to signInWithWeb3({ chain: 'solana', wallet: resolvedUserWallet }) instead.")}else{if(typeof ue!="object"||!N?.url)throw new Error("@supabase/auth-js: Both wallet and url must be specified in non-browser environments.");se=ue}const ve=new URL((t=N?.url)!==null&&t!==void 0?t:window.location.href);if("signIn"in se&&se.signIn){const de=await se.signIn(Object.assign(Object.assign(Object.assign({issuedAt:new Date().toISOString()},N?.signInWithSolana),{version:"1",domain:ve.host,uri:ve.href}),_e?{statement:_e}:null));let Oe;if(Array.isArray(de)&&de[0]&&typeof de[0]=="object")Oe=de[0];else if(de&&typeof de=="object"&&"signedMessage"in de&&"signature"in de)Oe=de;else throw new Error("@supabase/auth-js: Wallet method signIn() returned unrecognized value");if("signedMessage"in Oe&&"signature"in Oe&&(typeof Oe.signedMessage=="string"||Oe.signedMessage instanceof Uint8Array)&&Oe.signature instanceof Uint8Array)I=typeof Oe.signedMessage=="string"?Oe.signedMessage:new TextDecoder().decode(Oe.signedMessage),W=Oe.signature;else throw new Error("@supabase/auth-js: Wallet method signIn() API returned object without signedMessage and signature fields")}else{if(!("signMessage"in se)||typeof se.signMessage!="function"||!("publicKey"in se)||typeof se!="object"||!se.publicKey||!("toBase58"in se.publicKey)||typeof se.publicKey.toBase58!="function")throw new Error("@supabase/auth-js: Wallet does not have a compatible signMessage() and publicKey.toBase58() API");I=[`${ve.host} wants you to sign in with your Solana account:`,se.publicKey.toBase58(),..._e?["",_e,""]:[""],"Version: 1",`URI: ${ve.href}`,`Issued At: ${(n=(r=N?.signInWithSolana)===null||r===void 0?void 0:r.issuedAt)!==null&&n!==void 0?n:new Date().toISOString()}`,...!((o=N?.signInWithSolana)===null||o===void 0)&&o.notBefore?[`Not Before: ${N.signInWithSolana.notBefore}`]:[],...!((c=N?.signInWithSolana)===null||c===void 0)&&c.expirationTime?[`Expiration Time: ${N.signInWithSolana.expirationTime}`]:[],...!((d=N?.signInWithSolana)===null||d===void 0)&&d.chainId?[`Chain ID: ${N.signInWithSolana.chainId}`]:[],...!((h=N?.signInWithSolana)===null||h===void 0)&&h.nonce?[`Nonce: ${N.signInWithSolana.nonce}`]:[],...!((g=N?.signInWithSolana)===null||g===void 0)&&g.requestId?[`Request ID: ${N.signInWithSolana.requestId}`]:[],...!((b=(v=N?.signInWithSolana)===null||v===void 0?void 0:v.resources)===null||b===void 0)&&b.length?["Resources",...N.signInWithSolana.resources.map(Oe=>`- ${Oe}`)]:[]].join(`
`);const de=await se.signMessage(new TextEncoder().encode(I),"utf8");if(!de||!(de instanceof Uint8Array))throw new Error("@supabase/auth-js: Wallet signMessage() API returned an recognized value");W=de}}try{const{data:D,error:ue}=await ne(this.fetch,"POST",`${this.url}/token?grant_type=web3`,{headers:this.headers,body:Object.assign({chain:"solana",message:I,signature:Yi(W)},!((T=e.options)===null||T===void 0)&&T.captchaToken?{gotrue_meta_security:{captcha_token:(O=e.options)===null||O===void 0?void 0:O.captchaToken}}:null),xform:We});if(ue)throw ue;return!D||!D.session||!D.user?{data:{user:null,session:null},error:new Qt}:(D.session&&(await this._saveSession(D.session),await this._notifyAllSubscribers("SIGNED_IN",D.session)),{data:Object.assign({},D),error:ue})}catch(D){if(Z(D))return{data:{user:null,session:null},error:D};throw D}}async _exchangeCodeForSession(e){const t=await er(this.storage,`${this.storageKey}-code-verifier`),[r,n]=(t??"").split("/");try{const{data:o,error:c}=await ne(this.fetch,"POST",`${this.url}/token?grant_type=pkce`,{headers:this.headers,body:{auth_code:e,code_verifier:r},xform:We});if(await tr(this.storage,`${this.storageKey}-code-verifier`),c)throw c;return!o||!o.session||!o.user?{data:{user:null,session:null,redirectType:null},error:new Qt}:(o.session&&(await this._saveSession(o.session),await this._notifyAllSubscribers("SIGNED_IN",o.session)),{data:Object.assign(Object.assign({},o),{redirectType:n??null}),error:c})}catch(o){if(Z(o))return{data:{user:null,session:null,redirectType:null},error:o};throw o}}async signInWithIdToken(e){try{const{options:t,provider:r,token:n,access_token:o,nonce:c}=e,d=await ne(this.fetch,"POST",`${this.url}/token?grant_type=id_token`,{headers:this.headers,body:{provider:r,id_token:n,access_token:o,nonce:c,gotrue_meta_security:{captcha_token:t?.captchaToken}},xform:We}),{data:h,error:g}=d;return g?{data:{user:null,session:null},error:g}:!h||!h.session||!h.user?{data:{user:null,session:null},error:new Qt}:(h.session&&(await this._saveSession(h.session),await this._notifyAllSubscribers("SIGNED_IN",h.session)),{data:h,error:g})}catch(t){if(Z(t))return{data:{user:null,session:null},error:t};throw t}}async signInWithOtp(e){var t,r,n,o,c;try{if("email"in e){const{email:d,options:h}=e;let g=null,v=null;this.flowType==="pkce"&&([g,v]=await dt(this.storage,this.storageKey));const{error:b}=await ne(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{email:d,data:(t=h?.data)!==null&&t!==void 0?t:{},create_user:(r=h?.shouldCreateUser)!==null&&r!==void 0?r:!0,gotrue_meta_security:{captcha_token:h?.captchaToken},code_challenge:g,code_challenge_method:v},redirectTo:h?.emailRedirectTo});return{data:{user:null,session:null},error:b}}if("phone"in e){const{phone:d,options:h}=e,{data:g,error:v}=await ne(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{phone:d,data:(n=h?.data)!==null&&n!==void 0?n:{},create_user:(o=h?.shouldCreateUser)!==null&&o!==void 0?o:!0,gotrue_meta_security:{captcha_token:h?.captchaToken},channel:(c=h?.channel)!==null&&c!==void 0?c:"sms"}});return{data:{user:null,session:null,messageId:g?.message_id},error:v}}throw new Xt("You must provide either an email or phone number.")}catch(d){if(Z(d))return{data:{user:null,session:null},error:d};throw d}}async verifyOtp(e){var t,r;try{let n,o;"options"in e&&(n=(t=e.options)===null||t===void 0?void 0:t.redirectTo,o=(r=e.options)===null||r===void 0?void 0:r.captchaToken);const{data:c,error:d}=await ne(this.fetch,"POST",`${this.url}/verify`,{headers:this.headers,body:Object.assign(Object.assign({},e),{gotrue_meta_security:{captcha_token:o}}),redirectTo:n,xform:We});if(d)throw d;if(!c)throw new Error("An error occurred on token verification.");const h=c.session,g=c.user;return h?.access_token&&(await this._saveSession(h),await this._notifyAllSubscribers(e.type=="recovery"?"PASSWORD_RECOVERY":"SIGNED_IN",h)),{data:{user:g,session:h},error:null}}catch(n){if(Z(n))return{data:{user:null,session:null},error:n};throw n}}async signInWithSSO(e){var t,r,n;try{let o=null,c=null;return this.flowType==="pkce"&&([o,c]=await dt(this.storage,this.storageKey)),await ne(this.fetch,"POST",`${this.url}/sso`,{body:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},"providerId"in e?{provider_id:e.providerId}:null),"domain"in e?{domain:e.domain}:null),{redirect_to:(r=(t=e.options)===null||t===void 0?void 0:t.redirectTo)!==null&&r!==void 0?r:void 0}),!((n=e?.options)===null||n===void 0)&&n.captchaToken?{gotrue_meta_security:{captcha_token:e.options.captchaToken}}:null),{skip_http_redirect:!0,code_challenge:o,code_challenge_method:c}),headers:this.headers,xform:vo})}catch(o){if(Z(o))return{data:null,error:o};throw o}}async reauthenticate(){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._reauthenticate())}async _reauthenticate(){try{return await this._useSession(async e=>{const{data:{session:t},error:r}=e;if(r)throw r;if(!t)throw new Ke;const{error:n}=await ne(this.fetch,"GET",`${this.url}/reauthenticate`,{headers:this.headers,jwt:t.access_token});return{data:{user:null,session:null},error:n}})}catch(e){if(Z(e))return{data:{user:null,session:null},error:e};throw e}}async resend(e){try{const t=`${this.url}/resend`;if("email"in e){const{email:r,type:n,options:o}=e,{error:c}=await ne(this.fetch,"POST",t,{headers:this.headers,body:{email:r,type:n,gotrue_meta_security:{captcha_token:o?.captchaToken}},redirectTo:o?.emailRedirectTo});return{data:{user:null,session:null},error:c}}else if("phone"in e){const{phone:r,type:n,options:o}=e,{data:c,error:d}=await ne(this.fetch,"POST",t,{headers:this.headers,body:{phone:r,type:n,gotrue_meta_security:{captcha_token:o?.captchaToken}}});return{data:{user:null,session:null,messageId:c?.message_id},error:d}}throw new Xt("You must provide either an email or phone number and a type")}catch(t){if(Z(t))return{data:{user:null,session:null},error:t};throw t}}async getSession(){return await this.initializePromise,await this._acquireLock(-1,async()=>this._useSession(async t=>t))}async _acquireLock(e,t){this._debug("#_acquireLock","begin",e);try{if(this.lockAcquired){const r=this.pendingInLock.length?this.pendingInLock[this.pendingInLock.length-1]:Promise.resolve(),n=(async()=>(await r,await t()))();return this.pendingInLock.push((async()=>{try{await n}catch{}})()),n}return await this.lock(`lock:${this.storageKey}`,e,async()=>{this._debug("#_acquireLock","lock acquired for storage key",this.storageKey);try{this.lockAcquired=!0;const r=t();for(this.pendingInLock.push((async()=>{try{await r}catch{}})()),await r;this.pendingInLock.length;){const n=[...this.pendingInLock];await Promise.all(n),this.pendingInLock.splice(0,n.length)}return await r}finally{this._debug("#_acquireLock","lock released for storage key",this.storageKey),this.lockAcquired=!1}})}finally{this._debug("#_acquireLock","end")}}async _useSession(e){this._debug("#_useSession","begin");try{const t=await this.__loadSession();return await e(t)}finally{this._debug("#_useSession","end")}}async __loadSession(){this._debug("#__loadSession()","begin"),this.lockAcquired||this._debug("#__loadSession()","used outside of an acquired lock!",new Error().stack);try{let e=null;const t=await er(this.storage,this.storageKey);if(this._debug("#getSession()","session from storage",t),t!==null&&(this._isValidSession(t)?e=t:(this._debug("#getSession()","session from storage is not valid"),await this._removeSession())),!e)return{data:{session:null},error:null};const r=e.expires_at?e.expires_at*1e3-Date.now()<Tr:!1;if(this._debug("#__loadSession()",`session has${r?"":" not"} expired`,"expires_at",e.expires_at),!r){if(this.storage.isServer){let c=this.suppressGetSessionWarning;e=new Proxy(e,{get:(h,g,v)=>(!c&&g==="user"&&(console.warn("Using the user object as returned from supabase.auth.getSession() or from some supabase.auth.onAuthStateChange() events could be insecure! This value comes directly from the storage medium (usually cookies on the server) and may not be authentic. Use supabase.auth.getUser() instead which authenticates the data by contacting the Supabase Auth server."),c=!0,this.suppressGetSessionWarning=!0),Reflect.get(h,g,v))})}return{data:{session:e},error:null}}const{session:n,error:o}=await this._callRefreshToken(e.refresh_token);return o?{data:{session:null},error:o}:{data:{session:n},error:null}}finally{this._debug("#__loadSession()","end")}}async getUser(e){return e?await this._getUser(e):(await this.initializePromise,await this._acquireLock(-1,async()=>await this._getUser()))}async _getUser(e){try{return e?await ne(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:e,xform:Ge}):await this._useSession(async t=>{var r,n,o;const{data:c,error:d}=t;if(d)throw d;return!(!((r=c.session)===null||r===void 0)&&r.access_token)&&!this.hasCustomAuthorizationHeader?{data:{user:null},error:new Ke}:await ne(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:(o=(n=c.session)===null||n===void 0?void 0:n.access_token)!==null&&o!==void 0?o:void 0,xform:Ge})})}catch(t){if(Z(t))return Ni(t)&&(await this._removeSession(),await tr(this.storage,`${this.storageKey}-code-verifier`)),{data:{user:null},error:t};throw t}}async updateUser(e,t={}){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._updateUser(e,t))}async _updateUser(e,t={}){try{return await this._useSession(async r=>{const{data:n,error:o}=r;if(o)throw o;if(!n.session)throw new Ke;const c=n.session;let d=null,h=null;this.flowType==="pkce"&&e.email!=null&&([d,h]=await dt(this.storage,this.storageKey));const{data:g,error:v}=await ne(this.fetch,"PUT",`${this.url}/user`,{headers:this.headers,redirectTo:t?.emailRedirectTo,body:Object.assign(Object.assign({},e),{code_challenge:d,code_challenge_method:h}),jwt:c.access_token,xform:Ge});if(v)throw v;return c.user=g.user,await this._saveSession(c),await this._notifyAllSubscribers("USER_UPDATED",c),{data:{user:c.user},error:null}})}catch(r){if(Z(r))return{data:{user:null},error:r};throw r}}async setSession(e){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._setSession(e))}async _setSession(e){try{if(!e.access_token||!e.refresh_token)throw new Ke;const t=Date.now()/1e3;let r=t,n=!0,o=null;const{payload:c}=Or(e.access_token);if(c.exp&&(r=c.exp,n=r<=t),n){const{session:d,error:h}=await this._callRefreshToken(e.refresh_token);if(h)return{data:{user:null,session:null},error:h};if(!d)return{data:{user:null,session:null},error:null};o=d}else{const{data:d,error:h}=await this._getUser(e.access_token);if(h)throw h;o={access_token:e.access_token,refresh_token:e.refresh_token,user:d.user,token_type:"bearer",expires_in:r-t,expires_at:r},await this._saveSession(o),await this._notifyAllSubscribers("SIGNED_IN",o)}return{data:{user:o.user,session:o},error:null}}catch(t){if(Z(t))return{data:{session:null,user:null},error:t};throw t}}async refreshSession(e){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._refreshSession(e))}async _refreshSession(e){try{return await this._useSession(async t=>{var r;if(!e){const{data:c,error:d}=t;if(d)throw d;e=(r=c.session)!==null&&r!==void 0?r:void 0}if(!e?.refresh_token)throw new Ke;const{session:n,error:o}=await this._callRefreshToken(e.refresh_token);return o?{data:{user:null,session:null},error:o}:n?{data:{user:n.user,session:n},error:null}:{data:{user:null,session:null},error:null}})}catch(t){if(Z(t))return{data:{user:null,session:null},error:t};throw t}}async _getSessionFromURL(e,t){try{if(!Me())throw new Zt("No browser detected.");if(e.error||e.error_description||e.error_code)throw new Zt(e.error_description||"Error in URL with unspecified error_description",{error:e.error||"unspecified_error",code:e.error_code||"unspecified_code"});switch(t){case"implicit":if(this.flowType==="pkce")throw new $s("Not a valid PKCE flow url.");break;case"pkce":if(this.flowType==="implicit")throw new Zt("Not a valid implicit grant flow url.");break;default:}if(t==="pkce"){if(this._debug("#_initialize()","begin","is PKCE flow",!0),!e.code)throw new $s("No code detected.");const{data:_e,error:N}=await this._exchangeCodeForSession(e.code);if(N)throw N;const se=new URL(window.location.href);return se.searchParams.delete("code"),window.history.replaceState(window.history.state,"",se.toString()),{data:{session:_e.session,redirectType:null},error:null}}const{provider_token:r,provider_refresh_token:n,access_token:o,refresh_token:c,expires_in:d,expires_at:h,token_type:g}=e;if(!o||!d||!c||!g)throw new Zt("No session defined in URL");const v=Math.round(Date.now()/1e3),b=parseInt(d);let T=v+b;h&&(T=parseInt(h));const O=T-v;O*1e3<=gt&&console.warn(`@supabase/gotrue-js: Session as retrieved from URL expires in ${O}s, should have been closer to ${b}s`);const I=T-b;v-I>=120?console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued over 120s ago, URL could be stale",I,T,v):v-I<0&&console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued in the future? Check the device clock for skew",I,T,v);const{data:W,error:D}=await this._getUser(o);if(D)throw D;const ue={provider_token:r,provider_refresh_token:n,access_token:o,expires_in:b,expires_at:T,refresh_token:c,token_type:g,user:W.user};return window.location.hash="",this._debug("#_getSessionFromURL()","clearing window.location.hash"),{data:{session:ue,redirectType:e.type},error:null}}catch(r){if(Z(r))return{data:{session:null,redirectType:null},error:r};throw r}}_isImplicitGrantCallback(e){return!!(e.access_token||e.error_description)}async _isPKCECallback(e){const t=await er(this.storage,`${this.storageKey}-code-verifier`);return!!(e.code&&t)}async signOut(e={scope:"global"}){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._signOut(e))}async _signOut({scope:e}={scope:"global"}){return await this._useSession(async t=>{var r;const{data:n,error:o}=t;if(o)return{error:o};const c=(r=n.session)===null||r===void 0?void 0:r.access_token;if(c){const{error:d}=await this.admin.signOut(c,e);if(d&&!(qi(d)&&(d.status===404||d.status===401||d.status===403)))return{error:d}}return e!=="others"&&(await this._removeSession(),await tr(this.storage,`${this.storageKey}-code-verifier`)),{error:null}})}onAuthStateChange(e){const t=Qi(),r={id:t,callback:e,unsubscribe:()=>{this._debug("#unsubscribe()","state change callback with id removed",t),this.stateChangeEmitters.delete(t)}};return this._debug("#onAuthStateChange()","registered callback with id",t),this.stateChangeEmitters.set(t,r),(async()=>(await this.initializePromise,await this._acquireLock(-1,async()=>{this._emitInitialSession(t)})))(),{data:{subscription:r}}}async _emitInitialSession(e){return await this._useSession(async t=>{var r,n;try{const{data:{session:o},error:c}=t;if(c)throw c;await((r=this.stateChangeEmitters.get(e))===null||r===void 0?void 0:r.callback("INITIAL_SESSION",o)),this._debug("INITIAL_SESSION","callback id",e,"session",o)}catch(o){await((n=this.stateChangeEmitters.get(e))===null||n===void 0?void 0:n.callback("INITIAL_SESSION",null)),this._debug("INITIAL_SESSION","callback id",e,"error",o),console.error(o)}})}async resetPasswordForEmail(e,t={}){let r=null,n=null;this.flowType==="pkce"&&([r,n]=await dt(this.storage,this.storageKey,!0));try{return await ne(this.fetch,"POST",`${this.url}/recover`,{body:{email:e,code_challenge:r,code_challenge_method:n,gotrue_meta_security:{captcha_token:t.captchaToken}},headers:this.headers,redirectTo:t.redirectTo})}catch(o){if(Z(o))return{data:null,error:o};throw o}}async getUserIdentities(){var e;try{const{data:t,error:r}=await this.getUser();if(r)throw r;return{data:{identities:(e=t.user.identities)!==null&&e!==void 0?e:[]},error:null}}catch(t){if(Z(t))return{data:null,error:t};throw t}}async linkIdentity(e){var t;try{const{data:r,error:n}=await this._useSession(async o=>{var c,d,h,g,v;const{data:b,error:T}=o;if(T)throw T;const O=await this._getUrlForProvider(`${this.url}/user/identities/authorize`,e.provider,{redirectTo:(c=e.options)===null||c===void 0?void 0:c.redirectTo,scopes:(d=e.options)===null||d===void 0?void 0:d.scopes,queryParams:(h=e.options)===null||h===void 0?void 0:h.queryParams,skipBrowserRedirect:!0});return await ne(this.fetch,"GET",O,{headers:this.headers,jwt:(v=(g=b.session)===null||g===void 0?void 0:g.access_token)!==null&&v!==void 0?v:void 0})});if(n)throw n;return Me()&&!(!((t=e.options)===null||t===void 0)&&t.skipBrowserRedirect)&&window.location.assign(r?.url),{data:{provider:e.provider,url:r?.url},error:null}}catch(r){if(Z(r))return{data:{provider:e.provider,url:null},error:r};throw r}}async unlinkIdentity(e){try{return await this._useSession(async t=>{var r,n;const{data:o,error:c}=t;if(c)throw c;return await ne(this.fetch,"DELETE",`${this.url}/user/identities/${e.identity_id}`,{headers:this.headers,jwt:(n=(r=o.session)===null||r===void 0?void 0:r.access_token)!==null&&n!==void 0?n:void 0})})}catch(t){if(Z(t))return{data:null,error:t};throw t}}async _refreshAccessToken(e){const t=`#_refreshAccessToken(${e.substring(0,5)}...)`;this._debug(t,"begin");try{const r=Date.now();return await to(async n=>(n>0&&await eo(200*Math.pow(2,n-1)),this._debug(t,"refreshing attempt",n),await ne(this.fetch,"POST",`${this.url}/token?grant_type=refresh_token`,{body:{refresh_token:e},headers:this.headers,xform:We})),(n,o)=>{const c=200*Math.pow(2,n);return o&&Ar(o)&&Date.now()+c-r<gt})}catch(r){if(this._debug(t,"error",r),Z(r))return{data:{session:null,user:null},error:r};throw r}finally{this._debug(t,"end")}}_isValidSession(e){return typeof e=="object"&&e!==null&&"access_token"in e&&"refresh_token"in e&&"expires_at"in e}async _handleProviderSignIn(e,t){const r=await this._getUrlForProvider(`${this.url}/authorize`,e,{redirectTo:t.redirectTo,scopes:t.scopes,queryParams:t.queryParams});return this._debug("#_handleProviderSignIn()","provider",e,"options",t,"url",r),Me()&&!t.skipBrowserRedirect&&window.location.assign(r),{data:{provider:e,url:r},error:null}}async _recoverAndRefresh(){var e;const t="#_recoverAndRefresh()";this._debug(t,"begin");try{const r=await er(this.storage,this.storageKey);if(this._debug(t,"session from storage",r),!this._isValidSession(r)){this._debug(t,"session is not valid"),r!==null&&await this._removeSession();return}const n=((e=r.expires_at)!==null&&e!==void 0?e:1/0)*1e3-Date.now()<Tr;if(this._debug(t,`session has${n?"":" not"} expired with margin of ${Tr}s`),n){if(this.autoRefreshToken&&r.refresh_token){const{error:o}=await this._callRefreshToken(r.refresh_token);o&&(console.error(o),Ar(o)||(this._debug(t,"refresh failed with a non-retryable error, removing the session",o),await this._removeSession()))}}else await this._notifyAllSubscribers("SIGNED_IN",r)}catch(r){this._debug(t,"error",r),console.error(r);return}finally{this._debug(t,"end")}}async _callRefreshToken(e){var t,r;if(!e)throw new Ke;if(this.refreshingDeferred)return this.refreshingDeferred.promise;const n=`#_callRefreshToken(${e.substring(0,5)}...)`;this._debug(n,"begin");try{this.refreshingDeferred=new ir;const{data:o,error:c}=await this._refreshAccessToken(e);if(c)throw c;if(!o.session)throw new Ke;await this._saveSession(o.session),await this._notifyAllSubscribers("TOKEN_REFRESHED",o.session);const d={session:o.session,error:null};return this.refreshingDeferred.resolve(d),d}catch(o){if(this._debug(n,"error",o),Z(o)){const c={session:null,error:o};return Ar(o)||await this._removeSession(),(t=this.refreshingDeferred)===null||t===void 0||t.resolve(c),c}throw(r=this.refreshingDeferred)===null||r===void 0||r.reject(o),o}finally{this.refreshingDeferred=null,this._debug(n,"end")}}async _notifyAllSubscribers(e,t,r=!0){const n=`#_notifyAllSubscribers(${e})`;this._debug(n,"begin",t,`broadcast = ${r}`);try{this.broadcastChannel&&r&&this.broadcastChannel.postMessage({event:e,session:t});const o=[],c=Array.from(this.stateChangeEmitters.values()).map(async d=>{try{await d.callback(e,t)}catch(h){o.push(h)}});if(await Promise.all(c),o.length>0){for(let d=0;d<o.length;d+=1)console.error(o[d]);throw o[0]}}finally{this._debug(n,"end")}}async _saveSession(e){this._debug("#_saveSession()",e),this.suppressGetSessionWarning=!0,await cn(this.storage,this.storageKey,e)}async _removeSession(){this._debug("#_removeSession()"),await tr(this.storage,this.storageKey),await this._notifyAllSubscribers("SIGNED_OUT",null)}_removeVisibilityChangedCallback(){this._debug("#_removeVisibilityChangedCallback()");const e=this.visibilityChangedCallback;this.visibilityChangedCallback=null;try{e&&Me()&&window?.removeEventListener&&window.removeEventListener("visibilitychange",e)}catch(t){console.error("removing visibilitychange callback failed",t)}}async _startAutoRefresh(){await this._stopAutoRefresh(),this._debug("#_startAutoRefresh()");const e=setInterval(()=>this._autoRefreshTokenTick(),gt);this.autoRefreshTicker=e,e&&typeof e=="object"&&typeof e.unref=="function"?e.unref():typeof Deno<"u"&&typeof Deno.unrefTimer=="function"&&Deno.unrefTimer(e),setTimeout(async()=>{await this.initializePromise,await this._autoRefreshTokenTick()},0)}async _stopAutoRefresh(){this._debug("#_stopAutoRefresh()");const e=this.autoRefreshTicker;this.autoRefreshTicker=null,e&&clearInterval(e)}async startAutoRefresh(){this._removeVisibilityChangedCallback(),await this._startAutoRefresh()}async stopAutoRefresh(){this._removeVisibilityChangedCallback(),await this._stopAutoRefresh()}async _autoRefreshTokenTick(){this._debug("#_autoRefreshTokenTick()","begin");try{await this._acquireLock(0,async()=>{try{const e=Date.now();try{return await this._useSession(async t=>{const{data:{session:r}}=t;if(!r||!r.refresh_token||!r.expires_at){this._debug("#_autoRefreshTokenTick()","no session");return}const n=Math.floor((r.expires_at*1e3-e)/gt);this._debug("#_autoRefreshTokenTick()",`access token expires in ${n} ticks, a tick lasts ${gt}ms, refresh threshold is ${Br} ticks`),n<=Br&&await this._callRefreshToken(r.refresh_token)})}catch(t){console.error("Auto refresh tick failed with error. This is likely a transient error.",t)}}finally{this._debug("#_autoRefreshTokenTick()","end")}})}catch(e){if(e.isAcquireTimeout||e instanceof ln)this._debug("auto refresh token tick lock not available");else throw e}}async _handleVisibilityChange(){if(this._debug("#_handleVisibilityChange()"),!Me()||!window?.addEventListener)return this.autoRefreshToken&&this.startAutoRefresh(),!1;try{this.visibilityChangedCallback=async()=>await this._onVisibilityChanged(!1),window?.addEventListener("visibilitychange",this.visibilityChangedCallback),await this._onVisibilityChanged(!0)}catch(e){console.error("_handleVisibilityChange",e)}}async _onVisibilityChanged(e){const t=`#_onVisibilityChanged(${e})`;this._debug(t,"visibilityState",document.visibilityState),document.visibilityState==="visible"?(this.autoRefreshToken&&this._startAutoRefresh(),e||(await this.initializePromise,await this._acquireLock(-1,async()=>{if(document.visibilityState!=="visible"){this._debug(t,"acquired the lock to recover the session, but the browser visibilityState is no longer visible, aborting");return}await this._recoverAndRefresh()}))):document.visibilityState==="hidden"&&this.autoRefreshToken&&this._stopAutoRefresh()}async _getUrlForProvider(e,t,r){const n=[`provider=${encodeURIComponent(t)}`];if(r?.redirectTo&&n.push(`redirect_to=${encodeURIComponent(r.redirectTo)}`),r?.scopes&&n.push(`scopes=${encodeURIComponent(r.scopes)}`),this.flowType==="pkce"){const[o,c]=await dt(this.storage,this.storageKey),d=new URLSearchParams({code_challenge:`${encodeURIComponent(o)}`,code_challenge_method:`${encodeURIComponent(c)}`});n.push(d.toString())}if(r?.queryParams){const o=new URLSearchParams(r.queryParams);n.push(o.toString())}return r?.skipBrowserRedirect&&n.push(`skip_http_redirect=${r.skipBrowserRedirect}`),`${e}?${n.join("&")}`}async _unenroll(e){try{return await this._useSession(async t=>{var r;const{data:n,error:o}=t;return o?{data:null,error:o}:await ne(this.fetch,"DELETE",`${this.url}/factors/${e.factorId}`,{headers:this.headers,jwt:(r=n?.session)===null||r===void 0?void 0:r.access_token})})}catch(t){if(Z(t))return{data:null,error:t};throw t}}async _enroll(e){try{return await this._useSession(async t=>{var r,n;const{data:o,error:c}=t;if(c)return{data:null,error:c};const d=Object.assign({friendly_name:e.friendlyName,factor_type:e.factorType},e.factorType==="phone"?{phone:e.phone}:{issuer:e.issuer}),{data:h,error:g}=await ne(this.fetch,"POST",`${this.url}/factors`,{body:d,headers:this.headers,jwt:(r=o?.session)===null||r===void 0?void 0:r.access_token});return g?{data:null,error:g}:(e.factorType==="totp"&&(!((n=h?.totp)===null||n===void 0)&&n.qr_code)&&(h.totp.qr_code=`data:image/svg+xml;utf-8,${h.totp.qr_code}`),{data:h,error:null})})}catch(t){if(Z(t))return{data:null,error:t};throw t}}async _verify(e){return this._acquireLock(-1,async()=>{try{return await this._useSession(async t=>{var r;const{data:n,error:o}=t;if(o)return{data:null,error:o};const{data:c,error:d}=await ne(this.fetch,"POST",`${this.url}/factors/${e.factorId}/verify`,{body:{code:e.code,challenge_id:e.challengeId},headers:this.headers,jwt:(r=n?.session)===null||r===void 0?void 0:r.access_token});return d?{data:null,error:d}:(await this._saveSession(Object.assign({expires_at:Math.round(Date.now()/1e3)+c.expires_in},c)),await this._notifyAllSubscribers("MFA_CHALLENGE_VERIFIED",c),{data:c,error:d})})}catch(t){if(Z(t))return{data:null,error:t};throw t}})}async _challenge(e){return this._acquireLock(-1,async()=>{try{return await this._useSession(async t=>{var r;const{data:n,error:o}=t;return o?{data:null,error:o}:await ne(this.fetch,"POST",`${this.url}/factors/${e.factorId}/challenge`,{body:{channel:e.channel},headers:this.headers,jwt:(r=n?.session)===null||r===void 0?void 0:r.access_token})})}catch(t){if(Z(t))return{data:null,error:t};throw t}})}async _challengeAndVerify(e){const{data:t,error:r}=await this._challenge({factorId:e.factorId});return r?{data:null,error:r}:await this._verify({factorId:e.factorId,challengeId:t.id,code:e.code})}async _listFactors(){const{data:{user:e},error:t}=await this.getUser();if(t)return{data:null,error:t};const r=e?.factors||[],n=r.filter(c=>c.factor_type==="totp"&&c.status==="verified"),o=r.filter(c=>c.factor_type==="phone"&&c.status==="verified");return{data:{all:r,totp:n,phone:o},error:null}}async _getAuthenticatorAssuranceLevel(){return this._acquireLock(-1,async()=>await this._useSession(async e=>{var t,r;const{data:{session:n},error:o}=e;if(o)return{data:null,error:o};if(!n)return{data:{currentLevel:null,nextLevel:null,currentAuthenticationMethods:[]},error:null};const{payload:c}=Or(n.access_token);let d=null;c.aal&&(d=c.aal);let h=d;((r=(t=n.user.factors)===null||t===void 0?void 0:t.filter(b=>b.status==="verified"))!==null&&r!==void 0?r:[]).length>0&&(h="aal2");const v=c.amr||[];return{data:{currentLevel:d,nextLevel:h,currentAuthenticationMethods:v},error:null}}))}async fetchJwk(e,t={keys:[]}){let r=t.keys.find(c=>c.kid===e);if(r||(r=this.jwks.keys.find(c=>c.kid===e),r&&this.jwks_cached_at+Mi>Date.now()))return r;const{data:n,error:o}=await ne(this.fetch,"GET",`${this.url}/.well-known/jwks.json`,{headers:this.headers});if(o)throw o;if(!n.keys||n.keys.length===0)throw new Pt("JWKS is empty");if(this.jwks=n,this.jwks_cached_at=Date.now(),r=n.keys.find(c=>c.kid===e),!r)throw new Pt("No matching signing key found in JWKS");return r}async getClaims(e,t={keys:[]}){try{let r=e;if(!r){const{data:O,error:I}=await this.getSession();if(I||!O.session)return{data:null,error:I};r=O.session.access_token}const{header:n,payload:o,signature:c,raw:{header:d,payload:h}}=Or(r);if(co(o.exp),!n.kid||n.alg==="HS256"||!("crypto"in globalThis&&"subtle"in globalThis.crypto)){const{error:O}=await this.getUser(r);if(O)throw O;return{data:{claims:o,header:n,signature:c},error:null}}const g=lo(n.alg),v=await this.fetchJwk(n.kid,t),b=await crypto.subtle.importKey("jwk",v,g,!0,["verify"]);if(!await crypto.subtle.verify(g,b,c,Gi(`${d}.${h}`)))throw new Pt("Invalid JWT signature");return{data:{claims:o,header:n,signature:c},error:null}}catch(r){if(Z(r))return{data:null,error:r};throw r}}}$t.nextInstanceID=0;const Ao=$t;class Oo extends Ao{constructor(e){super(e)}}var Po=function(s,e,t,r){function n(o){return o instanceof t?o:new t(function(c){c(o)})}return new(t||(t=Promise))(function(o,c){function d(v){try{g(r.next(v))}catch(b){c(b)}}function h(v){try{g(r.throw(v))}catch(b){c(b)}}function g(v){v.done?o(v.value):n(v.value).then(d,h)}g((r=r.apply(s,e||[])).next())})};class jo{constructor(e,t,r){var n,o,c;if(this.supabaseUrl=e,this.supabaseKey=t,!e)throw new Error("supabaseUrl is required.");if(!t)throw new Error("supabaseKey is required.");const d=$i(e),h=new URL(d);this.realtimeUrl=new URL("realtime/v1",h),this.realtimeUrl.protocol=this.realtimeUrl.protocol.replace("http","ws"),this.authUrl=new URL("auth/v1",h),this.storageUrl=new URL("storage/v1",h),this.functionsUrl=new URL("functions/v1",h);const g=`sb-${h.hostname.split(".")[0]}-auth-token`,v={db:Si,realtime:Ti,auth:Object.assign(Object.assign({},ki),{storageKey:g}),global:Ei},b=Ii(r??{},v);this.storageKey=(n=b.auth.storageKey)!==null&&n!==void 0?n:"",this.headers=(o=b.global.headers)!==null&&o!==void 0?o:{},b.accessToken?(this.accessToken=b.accessToken,this.auth=new Proxy({},{get:(T,O)=>{throw new Error(`@supabase/supabase-js: Supabase Client is configured with the accessToken option, accessing supabase.auth.${String(O)} is not possible`)}})):this.auth=this._initSupabaseAuthClient((c=b.auth)!==null&&c!==void 0?c:{},this.headers,b.global.fetch),this.fetch=ji(t,this._getAccessToken.bind(this),b.global.fetch),this.realtime=this._initRealtimeClient(Object.assign({headers:this.headers,accessToken:this._getAccessToken.bind(this)},b.realtime)),this.rest=new Hn(new URL("rest/v1",h).href,{headers:this.headers,schema:b.db.schema,fetch:this.fetch}),b.accessToken||this._listenForAuthEvents()}get functions(){return new Un(this.functionsUrl.href,{headers:this.headers,customFetch:this.fetch})}get storage(){return new wi(this.storageUrl.href,this.headers,this.fetch)}from(e){return this.rest.from(e)}schema(e){return this.rest.schema(e)}rpc(e,t={},r={}){return this.rest.rpc(e,t,r)}channel(e,t={config:{}}){return this.realtime.channel(e,t)}getChannels(){return this.realtime.getChannels()}removeChannel(e){return this.realtime.removeChannel(e)}removeAllChannels(){return this.realtime.removeAllChannels()}_getAccessToken(){var e,t;return Po(this,void 0,void 0,function*(){if(this.accessToken)return yield this.accessToken();const{data:r}=yield this.auth.getSession();return(t=(e=r.session)===null||e===void 0?void 0:e.access_token)!==null&&t!==void 0?t:null})}_initSupabaseAuthClient({autoRefreshToken:e,persistSession:t,detectSessionInUrl:r,storage:n,storageKey:o,flowType:c,lock:d,debug:h},g,v){const b={Authorization:`Bearer ${this.supabaseKey}`,apikey:`${this.supabaseKey}`};return new Oo({url:this.authUrl.href,headers:Object.assign(Object.assign({},b),g),storageKey:o,autoRefreshToken:e,persistSession:t,detectSessionInUrl:r,storage:n,flowType:c,lock:d,debug:h,fetch:v,hasCustomAuthorizationHeader:"Authorization"in this.headers})}_initRealtimeClient(e){return new ai(this.realtimeUrl.href,Object.assign(Object.assign({},e),{params:Object.assign({apikey:this.supabaseKey},e?.params)}))}_listenForAuthEvents(){return this.auth.onAuthStateChange((t,r)=>{this._handleTokenChanged(t,"CLIENT",r?.access_token)})}_handleTokenChanged(e,t,r){(e==="TOKEN_REFRESHED"||e==="SIGNED_IN")&&this.changedAccessToken!==r?this.changedAccessToken=r:e==="SIGNED_OUT"&&(this.realtime.setAuth(),t=="STORAGE"&&this.auth.signOut(),this.changedAccessToken=void 0)}}const Ro=(s,e,t)=>new jo(s,e,t),Ns=window.Telegram?.WebApp||{initDataUnsafe:{},expand:()=>console.log("expand"),enableClosingConfirmation:()=>console.log("enableClosingConfirmation"),showAlert:s=>alert(s)};let pe=null,Ae=0,qr=[],It=[];const $o="https://kggaengzxmautimlvcgh.supabase.co",Io="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImtnZ2Flbmd6eG1hdXRpbWx2Y2doIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDc2NTgzOTEsImV4cCI6MjA2MzIzNDM5MX0.2NFe8_6OnvCjGVueJuVA1cO9zsjYTttID8UR90l9T9Q",ge=Ro($o,Io);document.addEventListener("DOMContentLoaded",async()=>{const s=document.getElementById("loading-screen"),e=document.getElementById("coming-soon-screen"),t=document.querySelector(".app-container");e.style.display="none",t.style.display="none",window.Telegram?.WebApp&&(window.Telegram.WebApp.expand(),window.Telegram.WebApp.enableClosingConfirmation());const r=window.Telegram?.WebApp?.initDataUnsafe?.user;if(r)try{pe=await Uo(r),s.classList.add("hidden"),pe?.role===2?(t.style.display="flex",Co(pe),await Bo(),await or(),await ea(),await Fo(),zo(),Ko(),Go(),Qo()):(e.style.display="flex",jr())}catch(n){console.error("Initialization error:",n),s.classList.add("hidden"),e.style.display="flex",jr()}else s.classList.add("hidden"),e.style.display="flex",jr();setTimeout(()=>{s.style.display="none"},500)});function jr(){const s=`
        <div class="logo">
            <i class="fas fa-gift"></i>
            <span>GiftRush</span>
        </div>
        <h1>Скоро запуск!</h1>
        <p>Мы активно работаем над проектом, чтобы сделать его еще лучше для вас.</p>
        <div class="progress-container">
            <div class="progress-bar-open" style="width: 78%"></div>
            <span>78% готово</span>
        </div>
        <div class="features-grid">
                    <div class="feature-card">
                        <div class="feature-icon">
                            <i class="fas fa-box-open"></i>
                        </div>
                        <h3>Уникальные кейсы</h3>
                        <p>Эксклюзивные предметы и награды</p>
                    </div>
                    <div class="feature-card">
                        <div class="feature-icon">
                            <i class="fas fa-coins"></i>
                        </div>
                        <h3>Подарки и бонусы</h3>
                        <p>Выигрывайте и выводите</p>
                    </div>
                    <div class="feature-card">
                        <div class="feature-icon">
                            <i class="fas fa-users"></i>
                        </div>
                        <h3>Реферальная система</h3>
                        <p>Приглашайте друзей и получайте награды</p>
                    </div>
                    <div class="feature-card">
                        <div class="feature-icon">
                            <i class="fas fa-trophy"></i>
                        </div>
                        <h3>Достижения</h3>
                        <p>Разблокируйте уникальные награды</p>
                    </div>
                </div>
        <div class="countdown">
            <h3>До запуска осталось:</h3>
            <div class="timer">
                <div class="time-block">
                    <span class="days">07</span>
                    <span class="label">Дней</span>
                </div>
                <div class="time-block">
                    <span class="hours">12</span>
                    <span class="label">Часов</span>
                </div>
                <div class="time-block">
                    <span class="minutes">45</span>
                    <span class="label">Минут</span>
                </div>
            </div>
        </div>
        <div class="tg-channel">
            <p>Подпишитесь на наш Telegram-канал, чтобы быть в курсе новостей:</p>
            <a href="https://t.me/giftrushofficial" class="tg-channel-btn" target="_blank">
                <i class="fab fa-telegram"></i> GiftRush Official
            </a>
        </div>
    `;document.querySelector(".coming-soon-content").innerHTML=s,oa()}async function Uo(s){try{const{data:e,error:t}=await ge.from("users").select("*").eq("telegram_id",s.id).single();if(e)return e;const{data:r,error:n}=await ge.from("users").insert([{telegram_id:s.id,username:s.username||`user_${s.id}`,first_name:s.first_name,last_name:s.last_name||"",language_code:s.language_code||"ru",is_premium:s.is_premium||!1,balance:100,level:1,experience:0,referrals_count:0,referral_code:Lo(),created_at:new Date().toISOString(),updated_at:new Date().toISOString(),role:1}]).select().single();if(n)throw n;return await ge.from("transactions").insert([{user_id:r.id,type:"bonus",amount:100,description:"Начальный бонус",created_at:new Date().toISOString()}]),r}catch(e){return console.error("Error in getUserOrCreate:",e),null}}function Lo(){return Math.random().toString(36).substring(2,8).toUpperCase()}function Co(s){if(!s)return;const e=document.getElementById("user-name"),t=document.getElementById("user-balance"),r=document.getElementById("user-balance-stat"),n=document.getElementById("user-level-value");e&&(e.textContent=s.first_name||`User ${s.id}`),t&&(t.textContent=s.balance),r&&(r.textContent=s.balance),n&&(n.textContent=s.level);const o=document.getElementById("avatar-img");o&&(window.Telegram.WebApp.initDataUnsafe.user?.photo_url?o.src=window.Telegram.WebApp.initDataUnsafe.user.photo_url:o.src="https://via.placeholder.com/150");const c=document.getElementById("referral-link");if(c){const O=window.Telegram.WebApp.initDataUnsafe.user?.username||"your_bot";c.value=`https://t.me/${O}?start=ref_${s.referral_code}`}const d=document.getElementById("ref-count"),h=document.getElementById("ref-earned"),g=document.getElementById("ref-count-stat"),v=document.getElementById("ref-earned-stat");d&&(d.textContent=s.referrals_count||0),h&&(h.textContent=s.referrals_count*50||0),g&&(g.textContent=s.referrals_count||0),v&&(v.textContent=s.referrals_count*50||0);const b=document.querySelector(".progress-bar");if(b){const O=Fs(s.level),I=s.experience/O*100;b.style.width=`${I}%`}const T=document.querySelector(".stat-value");if(T){const O=Fs(s.level);T.textContent=`${s.experience}/${O} XP`}}function Fs(s){return s*500}async function Bo(){if(pe)try{const{data:s,error:e}=await ge.from("users").select("balance").eq("id",pe.id).single();if(e)throw e;s&&(Ae=s.balance,document.getElementById("user-balance").textContent=Ae,document.getElementById("user-balance-stat").textContent=Ae)}catch(s){console.error("Error loading balance:",s)}}async function or(){if(pe)try{const{data:s,error:e}=await ge.from("inventory").select(`
                id,
                item_id,
                quantity,
                obtained_at,
                items (id, name, image_url, rarity, price, withdrawable)
            `).eq("user_id",pe.id);if(e)throw e;s&&(qr=s,Mo())}catch(s){console.error("Error loading inventory:",s)}}function Mo(){const s=document.getElementById("gifts-items"),e=document.getElementById("bonus-items"),t=document.getElementById("other-items");if(s.innerHTML="",e.innerHTML="",t.innerHTML="",qr.length===0){s.innerHTML=`
            <div class="empty-inventory">
                <i class="fas fa-box-open"></i>
                <p>Ваш инвентарь пуст</p>
                <button class="btn-primary">Открыть кейс</button>
            </div>
        `;return}const r=[],n=[],o=[];qr.forEach(c=>{c.items.price>100?r.push(c):c.items.withdrawable?n.push(c):o.push(c)}),r.length>0?r.forEach(c=>{const d=Rr(c);s.appendChild(d)}):s.innerHTML=`
            <div class="empty-inventory">
                <i class="fas fa-gift"></i>
                <p>Нет подарков</p>
            </div>
        `,n.length>0?n.forEach(c=>{const d=Rr(c);e.appendChild(d)}):e.innerHTML=`
            <div class="empty-inventory">
                <i class="fas fa-star"></i>
                <p>Нет бонусных предметов</p>
            </div>
        `,o.length>0?o.forEach(c=>{const d=Rr(c);t.appendChild(d)}):t.innerHTML=`
            <div class="empty-inventory">
                <i class="fas fa-archive"></i>
                <p>Здесь пока ничего нет</p>
            </div>
        `}function Rr(s){const e=document.createElement("div");return e.className="inventory-item",e.innerHTML=`
        <img src="${s.items.image_url}" alt="${s.items.name}">
        <div class="item-name">${s.items.name}</div>
        <div class="item-rarity ${s.items.rarity}">${Ut(s.items.rarity)}</div>
    `,e.addEventListener("click",()=>{Do(s)}),e}function Ut(s){return{common:"Обычный",uncommon:"Необычный",rare:"Редкий",epic:"Эпический",legendary:"Легендарный"}[s]||s}function Do(s){const e=document.getElementById("item-modal"),t=document.getElementById("item-modal-title"),r=document.getElementById("item-modal-image"),n=document.getElementById("item-modal-description"),o=document.getElementById("item-modal-price"),c=document.getElementById("item-modal-rarity");t.textContent=s.items.name,r.src=s.items.image_url,n.textContent=`Качество: ${Ut(s.items.rarity)}`,o.textContent=s.items.price,c.textContent=Ut(s.items.rarity),c.className="item-rarity "+s.items.rarity,document.getElementById("sell-item-btn").onclick=()=>qo(s),document.getElementById("withdraw-item-btn").onclick=()=>No(s);const d=document.getElementById("withdraw-item-btn");d.style.display=s.items.withdrawable?"block":"none",e.classList.add("active")}async function qo(s){try{const{error:e}=await ge.from("inventory").delete().eq("id",s.id);if(e)throw e;const{error:t}=await ge.from("users").update({balance:Ae+s.items.price}).eq("id",pe.id);if(t)throw t;await ge.from("transactions").insert([{user_id:pe.id,type:"sell",amount:s.items.price,description:`Продажа предмета: ${s.items.name}`,created_at:new Date().toISOString()}]),Ae+=s.items.price,document.getElementById("user-balance").textContent=Ae,document.getElementById("user-balance-stat").textContent=Ae,await or(),document.getElementById("item-modal").classList.remove("active"),me(`Вы продали ${s.items.name} за ${s.items.price} монет`)}catch(e){console.error("Error selling item:",e),me("Ошибка при продаже предмета")}}async function No(s){try{if(!s.items.withdrawable){me("Этот предмет нельзя вывести");return}const{error:e}=await ge.from("withdrawals").insert([{user_id:pe.id,item_id:s.item_id,status:"pending",created_at:new Date().toISOString()}]);if(e)throw e;await ge.from("inventory").delete().eq("id",s.id),await ge.from("transactions").insert([{user_id:pe.id,type:"withdraw",amount:-s.items.price,description:`Запрос на вывод: ${s.items.name}`,created_at:new Date().toISOString()}]),await or(),document.getElementById("item-modal").classList.remove("active"),me(`Запрос на вывод ${s.items.name} отправлен. Мы свяжемся с вами для уточнения деталей.`)}catch(e){console.error("Error withdrawing item:",e),me("Ошибка при запросе на вывод")}}async function Fo(){if(pe)try{const{data:s,error:e}=await ge.from("transactions").select("*").eq("user_id",pe.id).order("created_at",{ascending:!1}).limit(5);if(e)throw e;s&&s.length>0&&Wo(s)}catch(s){console.error("Error loading transactions:",s)}}function Wo(s){const e=document.querySelector(".operations-list");e.innerHTML="",s.forEach(t=>{const r=document.createElement("div");r.className="operation-item";let n="",o="",c="";switch(t.type){case"deposit":n="deposit",o="fa-coins",c="Пополнение баланса";break;case"withdraw":n="withdraw",o="fa-wallet",c="Вывод средств";break;case"case":n="case",o="fa-box-open",c="Открытие кейса";break;case"sell":n="case",o="fa-coins",c="Продажа предмета";break;case"bonus":n="bonus",o="fa-gift",c="Бонус";break;default:n="other",o="fa-exchange-alt",c=t.type}const h=new Date(t.created_at).toLocaleDateString("ru-RU",{day:"numeric",month:"long",hour:"2-digit",minute:"2-digit"}),g=t.amount>=0?"positive":"negative",v=Math.abs(t.amount);r.innerHTML=`
            <div class="operation-icon ${n}">
                <i class="fas ${o}"></i>
            </div>
            <div class="operation-info">
                <h3>${c}</h3>
                <p>${h}</p>
            </div>
            <div class="operation-amount ${g}">
                ${t.amount>=0?"+":"-"}${v} <i class="fas fa-coins"></i>
            </div>
        `,e.appendChild(r)})}function zo(){const s=document.querySelectorAll(".nav-item"),e=document.getElementById("upgrade-notification");s.forEach(t=>{t.addEventListener("click",r=>{r.preventDefault();const n=t.getAttribute("data-tab");if(n==="upgrade-tab"){e.textContent="Раздел в разработке",e.classList.add("show"),setTimeout(()=>{e.classList.remove("show")},3e3);return}s.forEach(o=>o.classList.remove("active")),t.classList.add("active"),document.querySelectorAll(".tab-content").forEach(o=>{o.classList.remove("active")}),document.getElementById(n).classList.add("active")})})}function Ko(){const s=document.getElementById("deposit-modal"),e=document.getElementById("add-balance-btn"),t=document.getElementById("close-deposit-modal");e&&s&&t&&(e.addEventListener("click",()=>{s.classList.add("active"),fn()}),t.addEventListener("click",()=>{s.classList.remove("active")})),Ho(),Jo();const r=document.getElementById("item-modal"),n=document.getElementById("close-item-modal");r&&n&&n.addEventListener("click",()=>{r.classList.remove("active")});const o=document.getElementById("chance-modal"),c=document.getElementById("close-chance-modal");o&&c&&c.addEventListener("click",()=>{o.classList.remove("active")});const d=document.getElementById("create-promo-modal"),h=document.getElementById("close-create-promo-modal"),g=document.getElementById("create-promo-btn");g&&d&&h&&(g.addEventListener("click",()=>{d.classList.add("active")}),h.addEventListener("click",()=>{d.classList.remove("active")})),document.querySelectorAll(".modal").forEach(v=>{v.addEventListener("click",b=>{b.target===v&&v.classList.remove("active")})})}function Ho(){const s=document.querySelectorAll(".deposit-tab"),e=document.querySelectorAll(".deposit-tab-content");s.forEach(t=>{t.addEventListener("click",()=>{const r=t.getAttribute("data-tab");s.forEach(n=>n.classList.remove("active")),e.forEach(n=>n.classList.remove("active")),t.classList.add("active"),document.getElementById(`${r}-tab`).classList.add("active"),Rt()})})}function Jo(){const s=document.getElementById("deposit-amount"),e=document.getElementById("ton-amount");s&&s.addEventListener("input",Rt),e&&e.addEventListener("input",Rt);const t=document.getElementById("apply-deposit-promo-btn");t&&t.addEventListener("click",()=>{const r=document.getElementById("deposit-promo").value.trim();r&&un(r).then(n=>{n&&(Rt(),me("Промокод применен!"))})})}function Rt(){const s=document.querySelector(".deposit-tab.active").getAttribute("data-tab");let e=0,t=0;if(s==="stars")e=parseFloat(document.getElementById("deposit-amount").value)||0;else{const r=parseFloat(document.getElementById("ton-amount").value)||0;e=Math.floor(r*100),t=Math.floor(e*.2)}document.getElementById("stars-receive").textContent=e,s==="ton"&&(document.getElementById("ton-bonus").textContent=t,document.getElementById("ton-receive").textContent=e+t),document.getElementById("summary-amount").textContent=`${e} монет`,document.getElementById("summary-bonus").textContent=`${t} монет`,document.getElementById("summary-total").textContent=`${e+t} монет`}function fn(){document.getElementById("deposit-amount").value="",document.getElementById("ton-amount").value="",document.getElementById("deposit-promo").value="",document.querySelector('.deposit-tab[data-tab="stars"]').click(),Rt()}function Go(){const s=document.getElementById("confirm-deposit-btn");s&&s.addEventListener("click",Zo);const e=document.getElementById("tonconnect-btn");e&&e.addEventListener("click",async()=>{if(!window.TonConnectSDK||!window.TonConnectSDK.TonConnect){me("TonConnect SDK не загружен. Попробуйте обновить страницу.");return}const c=parseFloat(document.getElementById("ton-amount").value);if(!c||c<=0){me("Введите сумму в TON");return}const d=Math.floor(c*1e9),h=new window.TonConnectSDK.TonConnect({manifestUrl:"https://gift-rush-2-0.vercel.app/tonconnect-manifest.json"});h.account||await h.connectWallet();const v={to:"UQAthLzScLE9Ks-MhL1oZk2AnMqcs02JEdDTGypNnt-GH6jD",value:d.toString()};try{await h.sendTransaction(v),me("Платеж отправлен! Ожидаем подтверждения...")}catch{me("Платеж отменён или произошла ошибка")}});const t=document.getElementById("copy-link-btn");t&&t.addEventListener("click",()=>{document.getElementById("referral-link").select(),document.execCommand("copy"),me("Ссылка скопирована в буфер обмена")});const r=document.getElementById("apply-promo-btn");r&&r.addEventListener("click",()=>{const c=document.getElementById("promo-input").value.trim();c?un(c):me("Пожалуйста, введите промокод")});const n=document.getElementById("create-promo-btn");n&&n.addEventListener("click",()=>{document.getElementById("create-promo-modal").classList.add("active")});const o=document.querySelector(".show-more-btn");o&&o.addEventListener("click",async()=>{await Yo()}),document.querySelectorAll(".inv-filter").forEach(c=>{c.addEventListener("click",()=>{const d=c.dataset.type;document.querySelectorAll(".inv-filter").forEach(h=>h.classList.remove("active")),c.classList.add("active"),document.querySelectorAll(".inventory-container").forEach(h=>{h.classList.remove("active"),h.dataset.type===d&&h.classList.add("active")})})})}async function Yo(){if(pe)try{const s=document.querySelectorAll(".operation-item").length,{data:e,error:t}=await ge.from("transactions").select("*").eq("user_id",pe.id).order("created_at",{ascending:!1}).range(s,s+4);if(t)throw t;e&&e.length>0?Vo(e):me("Больше операций нет")}catch(s){console.error("Error loading more transactions:",s)}}function Vo(s){const e=document.querySelector(".operations-list");s.forEach(t=>{const r=document.createElement("div");r.className="operation-item";let n="",o="",c="";switch(t.type){case"deposit":n="deposit",o="fa-coins",c="Пополнение баланса";break;case"withdraw":n="withdraw",o="fa-wallet",c="Вывод средств";break;case"case":n="case",o="fa-box-open",c="Открытие кейса";break;case"sell":n="case",o="fa-coins",c="Продажа предмета";break;case"bonus":n="bonus",o="fa-gift",c="Бонус";break;default:n="other",o="fa-exchange-alt",c=t.type}const h=new Date(t.created_at).toLocaleDateString("ru-RU",{day:"numeric",month:"long",hour:"2-digit",minute:"2-digit"}),g=t.amount>=0?"positive":"negative",v=Math.abs(t.amount);r.innerHTML=`
            <div class="operation-icon ${n}">
                <i class="fas ${o}"></i>
            </div>
            <div class="operation-info">
                <h3>${c}</h3>
                <p>${h}</p>
            </div>
            <div class="operation-amount ${g}">
                ${t.amount>=0?"+":"-"}${v} <i class="fas fa-coins"></i>
            </div>
        `,e.appendChild(r)})}function Qo(){const s=document.getElementById("spin-roulette-btn");s&&s.addEventListener("click",Xo)}async function Xo(){if(!pe)return;const s=document.getElementById("spin-roulette-btn");if(!s.disabled)try{const e=new Date().toISOString().split("T")[0],{data:t,error:r}=await ge.from("daily_bonuses").select("*").eq("user_id",pe.id).gte("claimed_at",`${e}T00:00:00`).lte("claimed_at",`${e}T23:59:59`);if(r)throw r;if(t&&t.length>0){me("Вы уже получали бонус сегодня. Приходите завтра!");return}s.disabled=!0,s.innerHTML='<i class="fas fa-sync-alt fa-spin"></i> Крутим...';const n=document.querySelector(".roulette-wheel"),o=document.querySelectorAll(".roulette-item"),c=o[0].offsetWidth,d=Math.floor(Math.random()*o.length),h=o[d],g=h.getAttribute("data-type"),v=h.getAttribute("data-value"),T=-(d*c)-3*o.length*c;n.style.transition="none",n.style.transform=`translateX(${T}px)`,setTimeout(()=>{n.style.transition=`transform ${3e3/1e3}s cubic-bezier(0.17, 0.67, 0.12, 0.99)`,n.style.transform=`translateX(${-(d*c)}px)`,setTimeout(async()=>{let I="",W=0;switch(g){case"balance":W=parseInt(v),Ae+=W,I=`🎉 Вы выиграли ${W} монет!`;break;case"discount":localStorage.setItem("activeDiscount",v),I=`🎁 Вы получили скидку ${v}% на следующий кейс!`;break;case"item":const{data:D,error:ue}=await ge.from("items").select("*").eq("rarity",v).limit(1);if(ue)throw ue;if(D&&D.length>0){const _e=D[0];await ge.from("inventory").insert([{user_id:pe.id,item_id:_e.id,obtained_at:new Date().toISOString()}]),I=`🎁 Вы получили ${Ut(_e.rarity)} предмет: ${_e.name}!`,W=_e.price}break}W>0&&(await ge.from("users").update({balance:Ae}).eq("id",pe.id),document.getElementById("user-balance").textContent=Ae,document.getElementById("user-balance-stat").textContent=Ae),await ge.from("daily_bonuses").insert([{user_id:pe.id,type:g,value:v,claimed_at:new Date().toISOString()}]),W>0&&await ge.from("transactions").insert([{user_id:pe.id,type:"bonus",amount:W,description:`Ежедневный бонус: ${I}`,created_at:new Date().toISOString()}]),g==="item"&&await or(),s.disabled=!1,s.innerHTML='<i class="fas fa-sync-alt"></i> Крутить рулетку',me(I),h.classList.add("prize-winner"),setTimeout(()=>{h.classList.remove("prize-winner")},2e3)},3100)},10)}catch(e){console.error("Error spinning roulette:",e),s.disabled=!1,s.innerHTML='<i class="fas fa-sync-alt"></i> Крутить рулетку',me("Ошибка при получении бонуса")}}async function Zo(){const s=document.querySelector(".deposit-tab.active").getAttribute("data-tab"),e=s==="stars"?document.getElementById("deposit-amount"):document.getElementById("ton-amount"),t=parseFloat(e.value);if(!t||t<=0){me("Введите корректную сумму");return}let r=t;s==="ton"&&(r+=Math.floor(t*.2));const{error:n}=await ge.from("users").update({balance:Ae+r}).eq("id",pe.id);if(n){console.error("Error updating balance:",n),me("Ошибка при пополнении баланса");return}Ae+=r,document.getElementById("user-balance").textContent=Ae,document.getElementById("deposit-modal").classList.remove("active"),me(`💰 Баланс успешно пополнен на ${r} монет`),fn()}async function un(s){if(pe)try{const{data:e,error:t}=await ge.from("promo_codes").select("*").eq("code",s.toUpperCase()).eq("is_active",!0).single();if(t||!e){me("Промокод не найден или уже использован");return}const{data:r,error:n}=await ge.from("promo_code_usage").select("*").eq("user_id",pe.id).eq("promo_code_id",e.id);if(n)throw n;if(r&&r.length>0){me("Вы уже использовали этот промокод");return}const{error:o}=await ge.from("users").update({balance:Ae+e.reward_amount}).eq("id",pe.id);if(o)throw o;await ge.from("promo_code_usage").insert([{user_id:pe.id,promo_code_id:e.id,used_at:new Date().toISOString()}]),await ge.from("transactions").insert([{user_id:pe.id,type:"bonus",amount:e.reward_amount,description:`Активация промокода: ${e.code}`,created_at:new Date().toISOString()}]),Ae+=e.reward_amount,document.getElementById("user-balance").textContent=Ae,document.getElementById("user-balance-stat").textContent=Ae,document.getElementById("promo-input").value="",me(`🎉 Промокод активирован! Получено ${e.reward_amount} монет`)}catch(e){console.error("Error applying promo code:",e),me("Ошибка при активации промокода")}}async function ea(){try{console.log("Начало загрузки кейсов...");const s=document.querySelector(".cases-container");s.innerHTML=`
            <div class="case-loading">
                <div class="loading-spinner"></div>
                <p>Загрузка кейсов...</p>
            </div>
        `;const{data:e,error:t}=await ge.from("cases").select(`
                id,
                name,
                description,
                image_url,
                price,
                rarity,
                created_at,
                discount,
                popularity
            `).order("price",{ascending:!0});if(t)throw t;if(!e||e.length===0){console.warn("В базе данных нет кейсов"),s.innerHTML=`
                <div class="empty-inventory" style="grid-column: 1 / -1;">
                    <i class="fas fa-box-open"></i>
                    <p>Кейсы не найдены в базе данных</p>
                </div>
            `;return}const r=await Promise.all(e.map(async n=>{const{count:o,error:c}=await ge.from("case_items").select("*",{count:"exact",head:!0}).eq("case_id",n.id);return c?(console.error(`Error counting items for case ${n.id}:`,c),{...n,items_count:0}):{...n,items_count:o||0}}));console.log("Кейсы с количеством предметов:",r),It=r,Gr(r),na(),ra(),ta()}catch(s){console.error("Ошибка при загрузке кейсов:",s);const e=document.querySelector(".cases-container");e.innerHTML=`
            <div class="empty-inventory" style="grid-column: 1 / -1;">
                <i class="fas fa-exclamation-triangle"></i>
                <p>Ошибка загрузки кейсов</p>
                <small>${s.message}</small>
            </div>
        `,me("Ошибка загрузки кейсов. Пожалуйста, попробуйте позже.")}}function ta(){const s=document.querySelector(".case-banner"),e=document.querySelector(".banner-content h3"),t=document.querySelector(".banner-content p"),r=document.querySelector(".banner-image"),n=It.find(o=>o.discount>0)||It[0];n&&(e.textContent=n.name,t.textContent=n.description||"Ограниченная коллекция с эксклюзивными предметами",n.image_url&&(r.style.backgroundImage=`url('${n.image_url}')`),s.className="case-banner",s.classList.add(n.rarity))}function ra(){document.querySelectorAll(".category-card").forEach(s=>{s.addEventListener("click",()=>{document.querySelectorAll(".category-card").forEach(t=>{t.classList.remove("active")}),s.classList.add("active");const e=s.dataset.category;sa(e)})})}function sa(s){let e=[...It];switch(s){case"popular":e.sort((t,r)=>r.popularity-t.popularity);break;case"new":e=e.filter(t=>{const r=new Date(t.created_at),n=new Date;return n.setDate(n.getDate()-7),r>n});break;case"discount":e=e.filter(t=>t.discount>0);break;case"premium":e=e.filter(t=>t.rarity==="epic"||t.rarity==="legendary");break}Gr(e)}function Gr(s,e="all"){const t=document.querySelector(".cases-container");t.innerHTML="";const r=e==="all"?s:s.filter(n=>n.rarity===e);if(r.length===0){t.innerHTML=`
            <div class="empty-inventory" style="grid-column: 1 / -1;">
                <i class="fas fa-box-open"></i>
                <p>Кейсы не найдены</p>
            </div>
        `;return}r.forEach(n=>{const o=document.createElement("div");o.className="case-card",o.setAttribute("data-case-id",n.id),o.setAttribute("data-rarity",n.rarity),new Date-new Date(n.created_at)<3*24*60*60*1e3&&o.classList.add("new-case"),o.innerHTML=`
            <div class="case-image" style="background-image: url('${n.image_url||"https://via.placeholder.com/150"}')">
                <div class="case-badge">${n.items_count} items</div>
                <div class="case-rarity ${n.rarity}">
                    ${Ut(n.rarity)}
                </div>
            </div>
            <div class="case-info">
                <div class="case-name">${n.name}</div>
                <div class="case-price">
                    <div class="price-value">
                        ${n.price} <i class="fas fa-coins"></i>
                    </div>
                    <div class="items-count">${n.items_count} items</div>
                </div>
            </div>
        `,o.addEventListener("click",()=>{ia(n.id)}),t.appendChild(o)})}function na(){const s=document.querySelectorAll(".case-filters .filter-btn");s.forEach(e=>{e.addEventListener("click",()=>{s.forEach(r=>r.classList.remove("active")),e.classList.add("active");const t=e.getAttribute("data-filter");Gr(It,t)})})}function ia(s){const e=localStorage.getItem("activeDiscount");e&&(me(`У вас активна скидка ${e}% на этот кейс!`),localStorage.removeItem("activeDiscount")),localStorage.setItem("selectedCaseId",s),window.location.href="case.html"}function oa(){const s=new Date;s.setDate(s.getDate()+7);const e=setInterval(()=>{const r=s-new Date;if(r<0){clearInterval(e);return}const n=Math.floor(r/(1e3*60*60*24)),o=Math.floor(r%(1e3*60*60*24)/(1e3*60*60)),c=Math.floor(r%(1e3*60*60)/(1e3*60)),d=document.querySelector(".days"),h=document.querySelector(".hours"),g=document.querySelector(".minutes");d&&(d.textContent=n.toString().padStart(2,"0")),h&&(h.textContent=o.toString().padStart(2,"0")),g&&(g.textContent=c.toString().padStart(2,"0"))},1e3)}function me(s){Ns.showAlert?Ns.showAlert(s):alert(s)}
